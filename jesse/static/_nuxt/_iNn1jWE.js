import{_ as et}from"./BS6844dd.js";import{_ as tt}from"./Dipt8w1y.js";import{_ as st}from"./DHyZ2ezu.js";import{d as oe,r as x,C as y,g as a,F as J,j as m,i as p,q,aw as rt,x as u,f as C,ab as qe,k as ot,aN as nt,t as we,s as re,a8 as lt,a as at,c as E,a6 as it,w as N,B as Ve,A as de,n as ut,o as dt,K as xe,e as $,E as h,ad as ct,ae as mt,O as se,G as I,J as B,a0 as je,a7 as pt,D as Y,bn as ue,L as ft,aO as De,H as ke,N as gt,ag as yt,ac as vt,aK as bt,I as ht,ai as _t}from"./CtRP3raE.js";import{_ as kt}from"./RJVMB5kb.js";import{_ as xt}from"./Dho8CE_Q.js";import{_ as wt,r as Ae}from"./aDqtB3V4.js";import{_ as Tt}from"./BsTwEtox.js";import{_ as Ct}from"./BftU8cE_.js";import{_ as $t}from"./DummNIKF.js";import{_ as Et}from"./hZKWDH-o.js";import{T as St}from"./9VOnL4Iz.js";import{s as Ne,l as Lt,d as Rt}from"./BS9OwPT8.js";import{_ as It}from"./tk-E9QnG.js";import{_ as Vt}from"./8f4YHL2u.js";import{_ as Pe}from"./XB2synLH.js";import{_ as Be}from"./BnM2Nhbm.js";import{_ as Pt}from"./CJIcHR_m.js";import{_ as Ut}from"./BkLYdo3Q.js";import{u as Fe}from"./B71Uh9Gv.js";import{u as Ot}from"./eSCuU-pE.js";import"./qfOJj_Il.js";import"./MwrR5ziO.js";const Mt={class:"flex justify-end item-center"},jt={class:"flex justify-end"},Dt=oe({__name:"ReportLiveSession",props:{session:{}},emits:["close"],setup(F,{emit:o}){const w=o,S=x(!1),_=F,b=x({description:"",email:""}),c=()=>{w("close")},f=async()=>{if(S.value=!0,!b.value.description){re("error","Please enter a description."),S.value=!1;return}const{data:d,error:r}=await lt("/system/report-exception",{description:b.value.description,email:b.value.email,traceback:"manual report",mode:"live",attach_logs:!0,session_id:_.session},!0);if(S.value=!1,r.value&&r.value.statusCode!==200){re("error",`[${r.value.statusCode}]: ${r.value.statusText}`);return}const k=d.value;k.status==="success"?(b.value.description="",b.value.email="",re("success",k.message),c()):k.status==="error"&&re("error",k.message)};return(d,r)=>{const k=ot,V=qe,j=nt,U=we,K=rt;return a(),y(J,null,[r[5]||(r[5]=m("p",null," If you think something is wrong with your running live session, you can submit a report. By submitting this form, the logs of this session will be sent to Jesse's developers so we can see what's going on. ",-1)),r[6]||(r[6]=m("br",null,null,-1)),r[7]||(r[7]=m("p",null,[q("Your exchange API keys and strategies are safe and "),m("b",null,"are never sent to us.")],-1)),r[8]||(r[8]=m("br",null,null,-1)),p(K,{state:u(b),class:"space-y-4",onSubmit:f},{default:C(()=>[p(V,{label:"Email (optional)",help:"Enter your email address for us to know who sent the email and possibly reply back to you."},{default:C(()=>[p(k,{modelValue:u(b).email,"onUpdate:modelValue":r[0]||(r[0]=z=>u(b).email=z),placeholder:"Email address...",type:"email"},null,8,["modelValue"])]),_:1}),r[3]||(r[3]=m("br",null,null,-1)),p(V,{label:"Description:",name:"Description"},{default:C(()=>[p(j,{modelValue:u(b).description,"onUpdate:modelValue":r[1]||(r[1]=z=>u(b).description=z),rows:10,placeholder:"Describe what you think is wrong in this session..."},null,8,["modelValue"])]),_:1}),r[4]||(r[4]=m("br",null,null,-1)),m("div",Mt,[m("div",jt,[p(U,{color:"gray",variant:"ghost",class:"mr-2",label:"Cancel",onClick:r[2]||(r[2]=z=>c())}),p(U,{type:"submit",class:"w-48 flex justify-center",label:"Submit",loading:u(S),disabled:u(S)},null,8,["loading","disabled"])])])]),_:1},8,["state"])],64)}}}),At={class:"mb-16"},Nt={key:0,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600 p-4"},qt={key:2},Bt=oe({__name:"CandlesChart",props:{form:{},results:{}},setup(F){const o=at(),w=E(()=>it().params.id),S=x(!0),_=x(2),b=x(null),c=F,f=x();let d=null,r=null;const k={orderEntries:{},positionEntry:null};let V=null,j=null;const U=x({}),K=E(()=>o.value),z=E(()=>c.form.exchange),D=E(()=>{var t,i;return`${z.value}-${((t=c.results.selectedRoute)==null?void 0:t.symbol)||""}-${((i=c.results.selectedRoute)==null?void 0:i.timeframe)||""}`}),Q=E(()=>c.results.currentCandles),G=E(()=>{const t=c.results.positions.find(i=>i[0].value===c.results.selectedRoute.symbol);return t===void 0?[]:t}),X=E(()=>{var t,i;return((i=(t=G.value)==null?void 0:t[2])==null?void 0:i.value)??0}),Z=E(()=>{var i,n;const t=Number(((n=(i=G.value)==null?void 0:i[1])==null?void 0:n.value)??0);return t>0?"long":t<0?"short":"close"});N(K,t=>{ye(t)}),N(X,(t,i)=>{r!==null&&t!==i&&pe()}),N(()=>c.results.orders,()=>{r!==null&&(fe(),me())},{deep:!0});let P=null;function O(){P||(P=setTimeout(async()=>{P=null,await H()},750))}const ce=E(()=>{var i,n;const t=c.results.generalInfo||{};return[c.results.phase,c.form.exchange,(i=c.results.selectedRoute)==null?void 0:i.symbol,(n=c.results.selectedRoute)==null?void 0:n.timeframe,t.count_trades,t.count_active_orders].join("|")});N(ce,()=>{r&&["running","stopping"].includes(c.results.phase)&&O()});function me(){var T;if(!r||!((T=c.results.selectedRoute)!=null&&T.symbol))return;const t=D.value,i=U.value[t]||[],n=new Set(i.map(v=>v.order_id)),l=c.results.orders.filter(v=>v.status==="EXECUTED"&&v.executed_at&&v.symbol===c.results.selectedRoute.symbol&&!n.has(v.id));if(l.length>0){const v=l.map(e=>le(e,c.results.selectedRoute.timeframe));U.value[t]=[...i,...v],ee()}}async function H(){var i;if(!r||!((i=c.results.selectedRoute)!=null&&i.symbol))return;const t=D.value;try{const l=await de().fetchOrdersHistory({limit:500,offset:0,id_search:w.value,status_filter:"EXECUTED",symbol_filter:c.results.selectedRoute.symbol,exchange_filter:c.form.exchange||null,date_filter:"90_days",type_filter:null,side_filter:null});if(l.orders&&l.orders.length>0){const T=l.orders.filter(v=>v.executed_at).map(v=>le(v,c.results.selectedRoute.timeframe));U.value[t]=T,ee()}}catch(n){console.error("Failed to refresh executed order markers:",n)}}N(Q,(t,i)=>{r!==null&&ge(t[D.value],t[D.value])}),Ve(async()=>{j=setTimeout(async()=>{await W()},200)});async function W(){var t,i;S.value=!0,b.value=null;try{await de().fetchCandles(w.value);const n=Se(c.results.candles);if(n){S.value=!1,b.value=n,console.error("Candle data validation failed:",n);return}S.value=!1,await ut();const l=f.value;if(!l)return;Ne.width=l.clientWidth,d=St(l,Ne),d.applyOptions({watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${c.results.selectedRoute.symbol} • ${c.results.selectedRoute.timeframe}`}}),r=d.addCandlestickSeries();const T=(c.results.candles||[]).map(v=>{const e=ve(v==null?void 0:v.time);return e===null?null:{...v,time:e}}).filter(Boolean);if(r.setData(T),T.length>0){const v=T[T.length-1];V=v==null?void 0:v.time}else V=null;d.timeScale().fitContent(),r.applyOptions({priceFormat:{type:"price",precision:_.value,minMove:.01}}),ge((t=c.results.candles)==null?void 0:t[0],(i=c.results.candles)==null?void 0:i[1]),pe(),fe(),await Te(),ye(K.value)}catch(n){S.value=!1,b.value=(n==null?void 0:n.message)||"An unexpected error occurred while loading the chart",console.error("Failed to initialize candle chart:",n),ne()}}async function Te(){var i,n;if(!r||!((i=c.results.selectedRoute)!=null&&i.symbol))return;const t=D.value;if(((n=U.value[t])==null?void 0:n.length)>0){ee();return}try{const T=await de().fetchOrdersHistory({limit:500,offset:0,id_search:w.value,status_filter:"EXECUTED",symbol_filter:c.results.selectedRoute.symbol,exchange_filter:c.form.exchange||null,date_filter:"90_days",type_filter:null,side_filter:null});if(T.orders&&T.orders.length>0){const v=T.orders.filter(e=>e.executed_at).map(e=>le(e,c.results.selectedRoute.timeframe));U.value[t]=v,ee()}}catch(l){console.error("Failed to load historical executed orders:",l)}}dt(()=>{ne(),j&&(clearTimeout(j),j=null)});function ne(){d!==null&&(d.remove(),d=null),r&&(r=null),V=null}function Ce(t){const i={m:60,h:3600,d:86400,w:604800},n=t.match(/^(\d+)([mhdw])$/);return n?parseInt(n[1])*i[n[2]]:60}function $e(t,i){const n=Math.floor(t/1e3),l=Ce(i);return Math.floor(n/l)*l}function le(t,i){var l;const n=((l=t.side)==null?void 0:l.toLowerCase())||"buy";return{time:$e(t.executed_at,i),position:n==="buy"?"belowBar":"aboveBar",color:n==="buy"?"#2196F3":"#e91e63",shape:n==="buy"?"arrowUp":"arrowDown",text:n.toUpperCase(),order_id:t.id}}function ee(){if(!r)return;const t=D.value,i=U.value[t]||[],n=Array.from(new Map(i.map(l=>[l.order_id,l])).values()).sort((l,T)=>l.time-T.time).slice(-500);U.value[t]=n,r.setMarkers(n)}function pe(){const t=Z.value==="long"?"#00AB5C":"#FF497D";if(k.positionEntry&&r.removePriceLine(k.positionEntry),Number(X.value)>0){const i={price:Number(X.value),color:t,lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:"Entry Price"};k.positionEntry=r.createPriceLine(i)}}function fe(){var i,n;const t=(n=(i=G.value)==null?void 0:i[0])==null?void 0:n.value;if(t){for(const l in k.orderEntries)r.removePriceLine(k.orderEntries[l]),delete k.orderEntries[l];c.results.orders.forEach(l=>{const T=l.side==="buy"?"#00AB5C":"#FF497D",v=xe.startCase(xe.lowerCase(`${l.side} ${l.type}`));if((l.status==="ACTIVE"||l.status==="QUEUED")&&l.symbol===t){const e={price:Number(l.price),color:T,lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:v};k.orderEntries[l.id]=r.createPriceLine(e)}})}}function ge(t,i){if(!(!t||!i)&&c.results.candles.length!==0&&!b.value)try{const n=String(t.open).indexOf("."),l=n===-1?0:String(t.open).length-n-1,T=String(i.open).indexOf("."),v=T===-1?0:String(i.open).length-T-1,e=l>v?l:v;_.value=e,(_.value<0||_.value>100)&&(_.value=0),r.applyOptions({priceFormat:{type:"price",precision:_.value,minMove:Math.pow(10,-e).toFixed(e)}});const s=c.results.currentCandles[D.value];if(!s)return;const A=be(s,-1);if(A){console.warn("Received invalid candle update, skipping:",A);return}const M=ve(s.time);if(M===null||V!==null&&M<V)return;const ae={...s,time:M};r.update(ae),V=M}catch(n){console.error("Error updating candle:",n)}}function ye(t){d!==null&&d.applyOptions(t==="light"?Lt.chart:Rt.chart)}function Ee(t){c.results.selectedRoute=t,b.value=null,ne(),W()}function ve(t){if(typeof t=="number")return t;if(t&&typeof t=="object"){if("year"in t&&"month"in t&&"day"in t){const{year:i,month:n,day:l}=t;return Math.floor(Date.UTC(i,n-1,l)/1e3)}if(t instanceof Date)return Math.floor(t.getTime()/1e3)}return null}function be(t,i){if(!t||typeof t!="object")return`Candle at index ${i} is not a valid object`;const n=["time","open","high","low","close"];for(const l of n){if(!(l in t))return`Candle at index ${i} is missing required field: ${l}`;if(l==="time"){if(typeof t.time!="number"&&typeof t.time!="object")return`Candle at index ${i} has invalid time format`}else if(typeof t[l]!="number"||isNaN(t[l]))return`Candle at index ${i} has invalid ${l} value (expected number, got ${typeof t[l]})`}return null}function Se(t){if(!Array.isArray(t))return"Candle data is not an array";if(t.length===0)return null;const i=[...t.slice(0,5).map((n,l)=>l),...t.slice(-5).map((n,l)=>t.length-5+l)].filter((n,l,T)=>T.indexOf(n)===l&&n>=0&&n<t.length);for(const n of i){const l=be(t[n],n);if(l)return l}return null}async function Le(){b.value=null,await W()}return(t,i)=>{const n=$t,l=we,T=Et;return a(),y("div",At,[u(S)?(a(),y("div",Nt,[p(n,{class:"h-4 w-full mb-4"}),p(n,{class:"h-4 w-2/3 mb-4"}),p(n,{class:"h-4 w-1/2 mb-4"}),p(n,{class:"h-4 w-full mb-4"}),p(n,{class:"h-4 w-full mb-4"}),p(n,{class:"h-4 w-2/3 mb-4"}),p(n,{class:"h-4 w-full mb-4"}),p(n,{class:"h-4 w-full"})])):u(b)?(a(),$(T,{key:1,icon:"i-heroicons-exclamation-triangle",color:"amber",variant:"subtle",title:"Unable to display candle chart",description:u(b)},{actions:C(()=>[p(l,{variant:"solid",color:"white",size:"xs",icon:"i-heroicons-arrow-path",onClick:Le},{default:C(()=>i[0]||(i[0]=[q(" Retry ")])),_:1})]),_:1},8,["description"])):h("",!0),ct(m("div",{ref_key:"chartContainer",ref:f,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),[[mt,!u(S)&&!u(b)]]),c.form.routes.length>1&&!u(b)?(a(),y("div",qt,[(a(!0),y(J,null,se(c.form.routes,v=>(a(),$(l,{key:v.symbol,variant:"soft",color:"gray",disabled:t.results.selectedRoute.symbol===v.symbol&&t.results.selectedRoute.timeframe===v.timeframe,class:"mt-2 mr-2",onClick:e=>Ee(v)},{default:C(()=>[q(I(v.symbol)+" • "+I(v.timeframe),1)]),_:2},1032,["disabled","onClick"]))),128))])):h("",!0)])}}}),Ft={class:"relative"},zt={class:"flex justify-end mb-4"},Ht={key:0,class:"absolute right-4 top-12 z-10"},Jt=oe({__name:"LiveClosedTrades",props:{trades:{},sessionId:{}},emits:["trade-click","reload"],setup(F,{emit:o}){const w=F,S=o,_=x(!1),b=E(()=>{if(!w.trades.length)return[];const d=[];for(const r of w.trades)d.push([{value:r.symbol,style:"text-xs"},{value:r.type,style:B.colorBasedOnType(r.type)},{value:B.roundPrice(r.entry_price),style:"text-xs"},{value:r.exit_price?B.roundPrice(r.exit_price):"-",style:"text-xs"},{value:r.qty,style:"text-xs"},{value:r.pnl!==null?`${xe.round(r.pnl,2)} (${xe.round(r.pnl_percentage,2)}%)`:"-",style:r.pnl!==null?B.colorBasedOnNumber(r.pnl):""},{value:B.timestampToTimeOnly(r.opened_at),style:"text-xs",tooltip:B.timestampToTime(r.opened_at)},{value:r.status,style:r.status==="open"?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"}]);return d});function c(d){if(d>=0&&d<w.trades.length){const r=w.trades[d];S("trade-click",r.id)}}async function f(){_.value=!0,S("reload"),setTimeout(()=>{_.value=!1},1e3)}return(d,r)=>{const k=we,V=Pe,j=Be;return a(),y("div",Ft,[m("div",zt,[p(k,{icon:"i-heroicons-arrow-path",size:"xs",variant:"soft",color:"gray",loading:u(_),label:"Reload Trades",class:"font-bold uppercase tracking-wider text-[10px]",onClick:f},null,8,["loading"])]),u(_)?(a(),y("div",Ht,r[0]||(r[0]=[m("div",{class:"animate-spin rounded-full h-4 w-4 border-2 border-indigo-500 border-t-transparent"},null,-1)]))):h("",!0),u(b).length?(a(),$(V,{key:1,data:u(b),"header-items":["Symbol","Type","Entry","Exit","QTY","PNL","Opened","Status"],header:"",clickable:!0,onRowClick:c},null,8,["data"])):(a(),$(j,{key:2,class:"mt-4"}))])}}}),Wt=oe({__name:"LiveOrders",props:{orders:{}},emits:["order-click"],setup(F,{emit:o}){const w=F,S=o,_=E(()=>{if(!w.orders.length)return[];const c=[];for(let f=w.orders.length-1;f>=0;f--){const d=w.orders[f];c.push([{value:d.id.slice(-12),style:"text-xs",tooltip:d.id,tag:"code"},{value:B.timestampToTimeOnly(d.created_at),style:"text-xs",tooltip:B.timestampToTime(d.created_at)},{value:d.symbol,style:"text-xs"},{value:d.type,style:"text-xs"},{value:d.side,style:B.colorBasedOnSide(d.side)},{value:d.price,style:"text-xs"},{value:d.qty,style:B.colorBasedOnSide(d.side)},{value:d.status,style:"text-xs"}])}return c});function b(c){const f=w.orders.length-1-c;if(f>=0&&f<w.orders.length){const d=w.orders[f];S("order-click",d.id)}}return(c,f)=>{const d=Pe,r=Be;return u(_).length?(a(),$(d,{key:0,data:u(_),"header-items":["ID","Created","Symbol","Type","Side","Price","QTY","Status"],header:"",clickable:!0,onRowClick:b},null,8,["data"])):(a(),$(r,{key:1}))}}}),Kt={key:0,class:"flex flex-col items-center justify-center mt-[6%]"},Qt=["textContent"],Yt={class:"mt-8"},Gt={key:1,class:"mx-auto container mt-8"},Xt={key:0,"data-cy":"live-page-content"},Zt={class:"flex justify-between items-center"},es={class:"grid grid-cols-1 gap-6"},ts={class:"flex justify-between items-center"},ss={key:1},rs={key:0,class:"mb-8"},os={class:"flex justify-between items-center mb-4"},ns={class:"flex gap-2"},ls=["onClick"],as={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},is={class:"mt-12 mb-6 p-1 bg-gray-50 dark:bg-gray-900/50 border dark:border-gray-700 rounded-2xl flex items-center gap-1"},us=["onClick"],ds={key:0,class:"w-2 h-2 rounded-full shrink-0 bg-green-500"},cs={class:"truncate"},ms={key:0,class:"mt-8 lg:mt-0"},ps={key:3,class:"grid grid-cols-2 gap-4 mt-4"},fs={key:4,class:"grid grid-cols-2 gap-4 mt-4"},gs={key:1,"data-cy":"live-action-button"},ys={key:0,class:"my-8 border-2 dark:border-gray-600 rounded-full"},vs={key:1,class:"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden"},bs={class:"px-6 py-4 space-y-3"},hs={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},_s={key:2,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden"},ks={class:"px-6 py-4 space-y-3"},xs={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ws={class:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate ml-4"},Ts={key:3,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},Cs={class:"px-6 py-4 space-y-4"},$s={class:"text-sm font-bold text-gray-900 dark:text-gray-100 truncate pr-2"},Es={class:"text-sm text-gray-500 dark:text-gray-400 truncate text-center px-2"},Ss={class:"flex justify-end ml-auto"},Ls={key:4,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},Rs={class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50 flex justify-between items-center"},Is={class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},Vs={class:"px-6 py-4"},Ps={key:0,class:"text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Us={key:1,class:"text-sm text-gray-400 dark:text-gray-500 italic text-center py-2"},Os=oe({__name:"LiveTab",props:{form:{},results:{},session:{},tabs:{}},setup(F){const o=F,w=E(()=>o.results.generalInfo.title?`${o.results.generalInfo.title} - Live Session - Jesse`:"Live Session - Jesse");Fe({title:w});const S=x([]),_=x(!1),b=x(!1),c=x(!1),f=x(!1),d=x(!1),r=x(!1),k=x(!1),V=x(!1),j=x(!1),U=x(!1),K=x(null),z=x(null),D=x("positions"),Q=x(!1),G=x(null),X=x(null),Z=x("auto"),P=je(),O=de(),ce=E(()=>["running","stopping"].includes(o.results.phase)&&!o.results.exception.error),me=e=>e?B.timestampToTime(e):"-",H=x([]);async function W(){if(o.results.phase==="editing"){if(!o.form.paper_mode){const e=P.exchangeApiKeys.find(s=>s.id===o.form.exchange_api_key_id);e&&(o.form.exchange=e.exchange)}try{H.value=await je().getExchangeSupportedSymbols(o.form.exchange);for(let e=0;e<o.form.routes.length;e++)H.value.includes(o.form.routes[e].symbol)||(o.form.routes[e].symbol=H.value[0]);if(o.form.data_routes.length>0)for(let e=0;e<o.form.data_routes.length;e++)H.value.includes(o.form.data_routes[e].symbol)||(o.form.data_routes[e].symbol=H.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}}Ve(async()=>{setTimeout(async()=>{o.form.exchange&&(o.results.phase==="editing"||!H.value.length)&&await W()},200),["running","stopping","ended"].includes(o.results.phase)&&await O.fetchEquityCurve(o.session,Z.value)}),N(()=>o.form.exchange,async(e,s)=>{e!==s&&await W()}),N(()=>o.results.phase,async e=>{e==="editing"&&await W()});const Te=pt(()=>{o.results.phase==="editing"&&O.saveState(o.session)},1e3);N(()=>o.form,()=>{Te()},{deep:!0}),N(()=>o.form.exchange_api_key_id,async(e,s)=>{e!==s&&await W()}),N(Q,async e=>{if(e){const s=await O.getSessionData(o.session);s!=null&&s.session&&(G.value=s.session.title||null,X.value=s.session.description||null)}});function ne(e){o.results.generalInfo.title=e.title||null,o.results.generalInfo.description=e.description||null}const Ce=E(()=>{var R;const e=o.results.generalInfo||{},s=e.exchange||o.form.exchange||"-",A=e.started_at||((R=o.results.generalInfo)==null?void 0:R.started_at),M=e.pnl!==void 0&&e.pnl!==null&&e.pnl_perc!==void 0&&e.pnl_perc!==null,ae=e.started_balance!==void 0&&e.started_balance!==null&&e.current_balance!==void 0&&e.current_balance!==null,ie=M?e.pnl>0?"text-green-500":e.pnl<0?"text-rose-500":"":"",te=[{label:"Exchange",value:s},{label:"Current Time",value:me(e.current_time)},{label:"Debug Mode",value:e.debug_mode??o.form.debug_mode??"-"},{label:"Paper Trade",value:e.paper_mode??o.form.paper_mode??"-"},{label:"PNL",value:M?`${e.pnl} (${e.pnl_perc}%)`:"-",color:ie},{label:"Started",value:me(A)},{label:"Started/Current Balance",value:ae?`${e.started_balance} / ${e.current_balance}`:"-"},{label:"Trades",value:`${e.count_trades??0}`}],he=e.leverage_type||"spot";return he!=="spot"&&(te.push({label:"Available Margin",value:`${e.available_margin??"-"}`}),te.push({label:"Leverage",value:`${e.leverage??"-"}x (${he})`})),te}),$e=E(()=>P.notificationApiKeys.map(e=>({label:`${e.name} - ${e.driver}`,value:e.id}))),le=E(()=>Math.round(o.results.progressbar.estimated_remaining_seconds)===0?"Please wait...":`${Math.round(o.results.progressbar.estimated_remaining_seconds)} seconds remaining...`),ee=E(()=>{let e=[];const s=P.jesseSupportedTimeframes;return P.settings.live.generate_candles_from_1m||!o.form.exchange?e=s.map(A=>P.planLimits.timeframes.includes(A)?{label:A,value:A,disabled:!1}:{label:`${A} (Upgrade required)`,value:A,disabled:!0}):e=P.exchangeInfo[o.form.exchange].supported_timeframes.map(M=>P.planLimits.timeframes.includes(M)?{label:M,value:M,disabled:!1}:{label:`${M} (Upgrade required)`,value:M,disabled:!0}),e}),pe=E(()=>P.liveTradingExchangeNames.map(e=>P.planLimits.exchanges.includes(e)?{label:e,value:e,disabled:!1}:{label:`${e} (Upgrade required)`,value:e,disabled:!0})),fe=E(()=>P.exchangeApiKeys.map(e=>P.planLimits.exchanges.includes(e.exchange)?{label:`${e.exchange} - ${e.name}`,value:e.id,disabled:!1}:{label:`${e.exchange} - ${e.name} (Upgrade required)`,value:e.id,disabled:!0})),ge=O.cancel,ye=O.newLive;function Ee(e){O.start(e)}function ve(e){O.closeTab(e)}async function be(){o.results.infoLogs===""&&o.results.generalInfo.count_info_logs>0&&await O.fetchLogs(o.session),k.value=!0}async function Se(){o.results.errorLogs===""&&o.results.generalInfo.count_error_logs>0&&await O.fetchLogs(o.session),V.value=!0}function Le(){b.value=!0,navigator.clipboard.writeText(o.results.infoLogs),re("success","Logs copied successfully"),f.value=!0,setTimeout(()=>{f.value=!1},3e3)}function t(){c.value=!0,navigator.clipboard.writeText(o.results.errorLogs),re("success","Logs copied successfully"),d.value=!0,setTimeout(()=>{d.value=!1},3e3)}const i=E(()=>["basic","pro","enterprise","basic-lifetime","pro-lifetime","enterprise-lifetime","lifetime"].includes(P.plan));function n(e){K.value=e,j.value=!0}function l(e){z.value=e,U.value=!0}async function T(){const e=await O.fetchTrades(o.session);e&&(o.results.trades=e)}async function v(e){Z.value=e,await O.fetchEquityCurve(o.session,e)}return N(()=>o.results.phase,async e=>{["running","stopping","ended"].includes(e)&&await O.fetchEquityCurve(o.session,Z.value)},{immediate:!0}),(e,s)=>{const A=tt,M=st,ae=Dt,ie=ft,te=kt,he=xt,R=we,Ue=wt,Oe=gt,Re=Tt,ze=Ct,Me=yt,He=qe,Je=Bt,We=It,Ke=vt,_e=Vt,Qe=Pe,Ye=Jt,Ge=Wt,Xe=Pt,Ze=Ut;return a(),y(J,null,[p(A,{modelValue:u(j),"onUpdate:modelValue":s[0]||(s[0]=g=>Y(j)?j.value=g:null),"trade-id":u(K),onOrderClick:l},null,8,["modelValue","trade-id"]),p(M,{modelValue:u(U),"onUpdate:modelValue":s[1]||(s[1]=g=>Y(U)?U.value=g:null),"order-id":u(z)},null,8,["modelValue","order-id"]),p(ie,{modelValue:u(r),"onUpdate:modelValue":s[3]||(s[3]=g=>Y(r)?r.value=g:null),size:"small",title:"Report An Issue"},{default:C(()=>[p(ae,{session:e.session,onClose:s[2]||(s[2]=g=>r.value=!1)},null,8,["session"])]),_:1},8,["modelValue"]),p(ie,{modelValue:u(k),"onUpdate:modelValue":s[4]||(s[4]=g=>Y(k)?k.value=g:null),title:"Info Logs"},{default:C(()=>[p(te,{logs:e.results.infoLogs},null,8,["logs"])]),buttons:C(()=>[m("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:Le},[u(f)?(a(),$(u(De),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0),!u(f)&&e.results.infoLogs.length!=0?(a(),$(u(Ae),{key:1,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1},8,["modelValue"]),p(ie,{modelValue:u(V),"onUpdate:modelValue":s[5]||(s[5]=g=>Y(V)?V.value=g:null),title:"Error Logs"},{default:C(()=>[p(te,{logs:e.results.errorLogs},null,8,["logs"])]),buttons:C(()=>[m("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:t},[u(d)?(a(),$(u(De),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0),!u(d)&&e.results.errorLogs.length!=0?(a(),$(u(Ae),{key:1,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1},8,["modelValue"]),e.results.phase==="starting"?(a(),y("div",Kt,[m("div",null,[p(he,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?h("",!0):(a(),y("h3",{key:0,class:"mt-8 animate-pulse",textContent:I(u(le))},null,8,Qt)),m("div",Yt,[e.form.debug_mode?(a(),$(R,{key:0,icon:"i-heroicons-clipboard-document-list",variant:"solid",label:"View Logs",class:"flex justify-center w-64",onClick:s[6]||(s[6]=g=>k.value=!0)})):h("",!0),p(R,{color:"gray",class:"w-64 flex justify-center mt-4",ui:{color:{gray:{soft:"text-rose-500 dark:text-rose-400"}}},icon:"i-heroicons-no-symbol",variant:"soft",label:"Cancel",trailing:!1,onClick:s[7]||(s[7]=g=>u(ge)((e._.provides[ue]||e.$route).params.id))})]),e.results.exception.error?(a(),y("div",Gt,[p(Ue,{modelValue:u(_),"onUpdate:modelValue":s[8]||(s[8]=g=>Y(_)?_.value=g:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"live","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):h("",!0)])):(a(),$(Xe,{key:1},{left:C(()=>[e.results.phase==="editing"?(a(),y("div",Xt,[p(Oe,{class:"mb-4",title:"Exchange"}),e.form.paper_mode?(a(),$(Re,{key:0,modelValue:e.form.exchange,"onUpdate:modelValue":s[9]||(s[9]=g=>e.form.exchange=g),placeholder:"Select an exchange...",searchable:"",options:u(pe),"value-attribute":"value",class:"mt-2 mb-16"},null,8,["modelValue","options"])):(a(),$(Re,{key:1,modelValue:e.form.exchange_api_key_id,"onUpdate:modelValue":s[10]||(s[10]=g=>e.form.exchange_api_key_id=g),placeholder:"Select an exchange...",searchable:"",options:u(fe),"value-attribute":"value",class:"mt-2 mb-16"},{empty:C(()=>[m("div",Zt,[s[21]||(s[21]=m("span",null," No exchange API keys found. Please add at least one: ",-1)),p(R,{to:"/exchange-api-keys",icon:"i-heroicons-plus",type:"link",variant:"solid",size:"sm",label:"Add Exchange API Key"})])]),_:1},8,["modelValue","options"])),p(ze,{"total-routes-error":u(S),form:e.form,results:e.results,mode:"live",symbols:u(H),timeframes:u(ee)},null,8,["total-routes-error","form","results","symbols","timeframes"]),p(Oe,{class:"mt-16 mb-4",title:"Options"}),m("div",es,[p(Me,{modelValue:e.form.debug_mode,"onUpdate:modelValue":s[11]||(s[11]=g=>e.form.debug_mode=g),title:"Debug Mode",description:"Logs more details, helpful for debugging."},null,8,["modelValue"]),p(Me,{modelValue:e.form.paper_mode,"onUpdate:modelValue":s[12]||(s[12]=g=>e.form.paper_mode=g),title:"Paper Trade",disabled:!u(i),"disabled-guide":u(i)?"":"Premium plan required",description:"Trade in real-time using actual exchange data with PAPER money."},null,8,["modelValue","disabled","disabled-guide"]),p(He,{label:"Notifications:",help:"Select a notification driver to receive notifications"},{default:C(()=>[p(Re,{modelValue:e.form.notification_api_key_id,"onUpdate:modelValue":s[13]||(s[13]=g=>e.form.notification_api_key_id=g),placeholder:"Select a notification driver",options:u($e),"value-attribute":"value"},{empty:C(()=>[m("div",ts,[s[22]||(s[22]=m("span",null," No notification API keys found. Please add at least one: ",-1)),p(R,{to:"/notification-api-keys",icon:"i-heroicons-plus",type:"link",variant:"solid",size:"sm",label:"Add Notification API Key"})])]),_:1},8,["modelValue","options"])]),_:1})])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("div",ss,[e.results.exception.error?(a(),y("div",rs,[p(Ue,{title:e.results.exception.error,content:e.results.exception.traceback,mode:"live","debug-mode":e.form.debug_mode},null,8,["title","content","debug-mode"])])):h("",!0),u(ce)?(a(),$(Je,{key:1,results:e.results,form:e.form,exchange:e.form.exchange},null,8,["results","form","exchange"])):h("",!0),["running","stopping","ended"].includes(e.results.phase)?(a(),y("div",{key:2,class:ke(u(ce)?"mt-12":"mt-0")},[m("div",os,[s[23]||(s[23]=m("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100"},"Equity Curve",-1)),m("div",ns,[(a(),y(J,null,se(["1m","5m","15m","1h","1d","auto"],g=>m("button",{key:g,class:ke(["px-3 py-1.5 text-xs font-semibold rounded-lg transition-colors duration-200",[u(Z)===g?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]]),onClick:L=>v(g)},I(g.toUpperCase()),11,ls)),64))])]),e.results.charts.equity_curve.length===0?(a(),y("div",as," No equity data yet. It should appear shortly after the session starts (usually within ~1 minute). ")):(a(),$(We,{key:1,data:e.results.charts.equity_curve},null,8,["data"]))],2)):h("",!0),m("div",is,[(a(!0),y(J,null,se([{id:"positions",label:"Positions",count:e.results.generalInfo.open_positions,icon:"i-heroicons-chart-bar"},{id:"trades",label:"Trades",count:e.results.generalInfo.count_trades,icon:"i-heroicons-arrows-right-left"},{id:"orders",label:"Orders",count:e.results.generalInfo.count_active_orders,icon:"i-heroicons-list-bullet"}],g=>(a(),y("button",{key:g.id,class:ke(["flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-xs font-bold rounded-xl select-none h-10 group focus:outline-none transition-colors duration-200",[u(D)===g.id?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-600":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700/50 border border-transparent"]]),onClick:L=>D.value=g.id},[g.id==="positions"&&g.count>0?(a(),y("div",ds)):(a(),$(Ke,{key:1,name:g.icon,class:"w-4 h-4 shrink-0"},null,8,["name"])),m("span",cs,I(g.label.toUpperCase()),1),g.count>0?(a(),$(_e,{key:2,color:"gray",variant:"solid",size:"xs",class:"ml-1 px-1.5 py-0 min-w-[1.25rem] flex justify-center text-[10px] font-black rounded-md"},{default:C(()=>[q(I(g.count),1)]),_:2},1024)):h("",!0)],10,us))),128))]),m("div",null,[u(D)==="positions"?(a(),$(Qe,{key:0,data:e.results.positions,"header-items":["Symbol","QTY","Entry","Price","Liq Price","PNL"],header:""},null,8,["data"])):h("",!0),u(D)==="trades"?(a(),$(Ye,{key:1,trades:e.results.trades,"session-id":e.session,onTradeClick:n,onReload:T},null,8,["trades","session-id"])):h("",!0),u(D)==="orders"?(a(),$(Ge,{key:2,orders:e.results.orders,onOrderClick:l},null,8,["orders"])):h("",!0)])])):h("",!0)]),right:C(()=>{var g;return[m("div",null,[["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("div",ms,[e.results.phase==="ended"||e.results.phase==="error"?(a(),$(R,{key:0,class:"w-full flex justify-center",variant:"solid",icon:"i-heroicons-plus",label:"New session",onClick:s[14]||(s[14]=L=>u(ye)((e._.provides[ue]||e.$route).params.id))})):(a(),$(R,{key:1,class:"w-full flex justify-center",variant:"soft",color:"gray",icon:"i-heroicons-no-symbol",label:e.results.phase==="stopping"?"Terminating...":"Terminate",ui:{color:{gray:{soft:"text-rose-500 dark:text-rose-400"}}},onClick:s[15]||(s[15]=L=>u(O).openStopConfirmModal((e._.provides[ue]||e.$route).params.id))},null,8,["label"])),["running","stopping","ended","error"].includes(e.results.phase)?(a(),$(R,{key:2,class:"w-full flex justify-center mt-4",variant:"soft",color:"gray",icon:"i-heroicons-flag",label:"Report",onClick:s[16]||(s[16]=L=>r.value=!0)})):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("div",ps,[p(R,{color:"gray",variant:"soft",icon:"i-heroicons-clipboard-document-list",class:"flex justify-center",onClick:be},{trailing:C(()=>[p(_e,{color:"gray",variant:"solid",size:"xs",class:"ml-1"},{default:C(()=>[q(I(e.results.generalInfo.count_info_logs),1)]),_:1})]),default:C(()=>[s[24]||(s[24]=q(" Logs "))]),_:1}),p(R,{color:"gray",variant:"soft",icon:"i-heroicons-exclamation-triangle",class:"flex justify-center",onClick:Se},{trailing:C(()=>[p(_e,{color:e.results.generalInfo.count_error_logs>0?"rose":"gray",variant:"solid",size:"xs",class:"ml-1"},{default:C(()=>[q(I(e.results.generalInfo.count_error_logs),1)]),_:1},8,["color"])]),default:C(()=>[s[25]||(s[25]=q(" Errors "))]),_:1})])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("div",fs,[p(R,{to:`/live/orders-history?id=${e.session}`,color:"gray",variant:"soft",icon:"i-heroicons-list-bullet",class:"flex justify-center"},{default:C(()=>s[26]||(s[26]=[q(" Orders ")])),_:1},8,["to"]),p(R,{to:`/live/trades-history?id=${e.session}`,color:"gray",variant:"soft",icon:"i-heroicons-arrows-right-left",class:"flex justify-center"},{default:C(()=>s[27]||(s[27]=[q(" Trades ")])),_:1},8,["to"])])):h("",!0)])):(a(),y("div",gs,[p(R,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",label:"Start",trailing:!1,onClick:s[17]||(s[17]=L=>Ee((e._.provides[ue]||e.$route).params.id))}),Object.keys(e.tabs).length>1?(a(),$(R,{key:0,class:"w-full md:hidden flex justify-center mt-2",icon:"i-heroicons-x-mark",variant:"soft",color:"gray",label:"Close Tab",trailing:!1,onClick:s[18]||(s[18]=L=>ve((e._.provides[ue]||e.$route).params.id))})):h("",!0)]))]),["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("hr",ys)):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("div",vs,[s[28]||(s[28]=m("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[m("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Session Info")],-1)),m("dl",bs,[(a(!0),y(J,null,se(u(Ce),L=>(a(),y("div",{key:L.label,class:"flex justify-between items-center"},[m("dt",hs,I(L.label)+":",1),m("dd",{class:ke(["text-sm font-semibold truncate ml-4",L.color||"text-gray-900 dark:text-gray-100"])},I(L.value),3)]))),128))])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)&&((g=e.results.watchlist[`${o.form.exchange}-${e.results.selectedRoute.symbol}-${e.results.selectedRoute.timeframe}`])!=null&&g.length)?(a(),y("div",_s,[s[29]||(s[29]=m("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[m("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Watch List")],-1)),m("dl",ks,[(a(!0),y(J,null,se(e.results.watchlist[`${o.form.exchange}-${e.results.selectedRoute.symbol}-${e.results.selectedRoute.timeframe}`],(L,Ie)=>(a(),y("div",{key:Ie,class:"flex justify-between items-center"},[m("dt",xs,I(L[0])+":",1),m("dd",ws,I(L[1]),1)]))),128))])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)&&e.results.routes.length?(a(),y("div",Ts,[s[30]||(s[30]=m("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[m("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Routes")],-1)),m("div",Cs,[(a(!0),y(J,null,se(e.results.routes,(L,Ie)=>(a(),y("div",{key:Ie,class:"grid grid-cols-3 items-center"},[m("div",$s,I(L[2].value),1),m("div",Es,I(L[0].value),1),m("div",Ss,[p(_e,{color:"gray",variant:"soft",size:"xs"},{default:C(()=>[q(I(L[1].value),1)]),_:2},1024)])]))),128))])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),y("div",Ls,[m("div",Rs,[m("h3",Is,I(e.results.generalInfo.title||"Session Notes"),1),p(R,{variant:"link",color:"gray",icon:"i-heroicons-pencil-square",size:"xs",onClick:s[19]||(s[19]=L=>Q.value=!0)})]),m("div",Vs,[e.results.generalInfo.description?(a(),y("div",Ps,I(e.results.generalInfo.description),1)):(a(),y("div",Us," No notes yet. Click the edit button to add notes. "))])])):h("",!0)]}),_:1})),p(Ze,{modelValue:u(Q),"onUpdate:modelValue":s[20]||(s[20]=g=>Y(Q)?Q.value=g:null),"session-id":e.session,"initial-title":u(G),"initial-description":u(X),onSaved:ne},null,8,["modelValue","session-id","initial-title","initial-description"])],64)}}}),Ms={class:"w-full"},lr=oe({__name:"[id]",setup(F){Fe({title:"Live/Paper trading - Jesse"});const o=de(),w=E(()=>o.tabs),S=bt(),_=E(()=>S.params.id),b=E(()=>w.value[_.value]);Ve(async()=>{if(!b.value){if(o.recentlyClosedTabIds.includes(_.value))return;!await o.ensureTab(_.value)&&Object.keys(w.value).length===0&&await o.addTab()}}),N(_,f=>{if(!f||w.value[f]||!o.recentlyClosedTabIds.includes(f))return;const d=Object.keys(w.value)[0];if(d){ht(`/live/${d}`);return}o.addTab()},{immediate:!0}),_t(()=>{var r,k;const f=b.value;if(!f)return;const d=(r=f.form.routes)==null?void 0:r[0];!f.results.selectedRoute||Object.keys(f.results.selectedRoute).length===0?d&&(f.results.selectedRoute=d):d&&c(f.results.selectedRoute,d)&&(f.results.selectedRoute=d),f.form.exchange===""&&(f.form.exchange=((k=f.results.generalInfo)==null?void 0:k.exchange)||"")});function c(f,d){return!f||!d?!1:f.symbol===d.symbol&&f.timeframe===d.timeframe&&f.strategy===d.strategy}return Ot({w:()=>{const f=S.params.id;f&&o.requestCloseOrStopTab(f)},ArrowLeft:()=>o.goToPrevTab(_.value),ArrowRight:()=>o.goToNextTab(_.value)}),(f,d)=>{const r=et,k=Os;return a(),y(J,null,[m("div",Ms,[p(r,{"current-tab":b.value?b.value.id:null,tabs:w.value,onClose:u(o).closeTab,onCancel:u(o).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),b.value?(a(),$(k,{key:0,form:b.value.form,results:b.value.results,session:_.value,tabs:w.value},null,8,["form","results","session","tabs"])):h("",!0)],64)}}});export{lr as default};
