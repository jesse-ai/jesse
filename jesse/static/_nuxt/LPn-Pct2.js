import{ac as le,aj as J,y as ie,d as ee,z as g,g as i,j as r,Z as u,G as B,i as c,aw as te,I as T,J as z,A as R,e as D,ab as M,L as j,a0 as re,q as de,t as G,ae,af as ce,ag as K,c as C,bg as ue,E as W,bh as P,bi as Z,a4 as ge,P as me,r as F,H as pe,f as S,k as ye,v as fe,am as Q,an as X,a1 as he,W as q,s as A}from"./BZBcjETW.js";import{_ as be}from"./B-2SFkko.js";import{_ as ve}from"./CroKzFWd.js";import{_ as ne}from"./_97VUG9M.js";const ke={wrapper:"relative overflow-x-auto",base:"min-w-full table-fixed",divide:"divide-y divide-gray-300 dark:divide-gray-700",thead:"relative",tbody:"divide-y divide-gray-200 dark:divide-gray-800",tr:{base:"",selected:"bg-gray-50 dark:bg-gray-800/50",active:"hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer"},th:{base:"text-left rtl:text-right",padding:"px-4 py-3.5",color:"text-gray-900 dark:text-white",font:"font-semibold",size:"text-sm"},td:{base:"whitespace-nowrap",padding:"px-4 py-4",color:"text-gray-500 dark:text-gray-400",font:"",size:"text-sm"},checkbox:{padding:"ps-4"},loadingState:{wrapper:"flex flex-col items-center justify-center flex-1 px-6 py-14 sm:px-14",label:"text-sm text-center text-gray-900 dark:text-white",icon:"w-6 h-6 mx-auto text-gray-400 dark:text-gray-500 mb-4 animate-spin"},emptyState:{wrapper:"flex flex-col items-center justify-center flex-1 px-6 py-14 sm:px-14",label:"text-sm text-center text-gray-900 dark:text-white",icon:"w-6 h-6 mx-auto text-gray-400 dark:text-gray-500 mb-4"},progress:{wrapper:"absolute inset-x-0 -bottom-[0.5px] p-0"},default:{sortAscIcon:"i-heroicons-bars-arrow-up-20-solid",sortDescIcon:"i-heroicons-bars-arrow-down-20-solid",sortButton:{icon:"i-heroicons-arrows-up-down-20-solid",trailing:!0,square:!0,color:"gray",variant:"ghost",class:"-m-1.5"},progress:{color:"primary",animation:"carousel"},loadingState:{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},emptyState:{icon:"i-heroicons-circle-stack-20-solid",label:"No items."}}};function Se(e){return e?e[0].toUpperCase()+e.slice(1):""}const V=le(J.ui.strategy,J.ui.table,ke);function Ce(e,l){return e===l}function Y(e,l,w){return e===l?0:w==="asc"?e<l?-1:1:e>l?-1:1}const we=ee({components:{UIcon:ae,UButton:G,UProgress:ne,UCheckbox:te},inheritAttrs:!1,props:{modelValue:{type:Array,default:null},by:{type:[String,Function],default:()=>Ce},rows:{type:Array,default:()=>[]},columns:{type:Array,default:null},columnAttribute:{type:String,default:"label"},sort:{type:Object,default:()=>({})},sortMode:{type:String,default:"auto"},sortButton:{type:Object,default:()=>V.default.sortButton},sortAscIcon:{type:String,default:()=>V.default.sortAscIcon},sortDescIcon:{type:String,default:()=>V.default.sortDescIcon},loading:{type:Boolean,default:!1},loadingState:{type:Object,default:()=>V.default.loadingState},emptyState:{type:Object,default:()=>V.default.emptyState},progress:{type:Object,default:()=>V.default.progress},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","update:sort"],setup(e,{emit:l,attrs:w}){const{ui:h,attrs:$}=ce("table",K(e,"ui"),V,K(e,"class")),x=C(()=>e.columns??Object.keys(e.rows[0]??{}).map(t=>({key:t,label:Se(t),sortable:!1,class:void 0,sort:Y}))),a=ue(e,"sort",l,{passive:!0,defaultValue:W({},e.sort,{column:null,direction:"asc"})}),I={column:a.value.column,direction:null},L=C(()=>{var k;if(!((k=a.value)!=null&&k.column)||e.sortMode==="manual")return e.rows;const{column:t,direction:m}=a.value;return e.rows.slice().sort((O,d)=>{var H;const _=P(O,t),oe=P(d,t);return(((H=x.value.find(se=>se.key===t))==null?void 0:H.sort)??Y)(_,oe,m)})}),y=C({get(){return e.modelValue},set(t){l("update:modelValue",t)}}),o=C(()=>y.value&&y.value.length>0&&y.value.length<e.rows.length),b=C(()=>e.emptyState===null?null:{...h.value.default.emptyState,...e.emptyState}),f=C(()=>e.loadingState===null?null:{...h.value.default.loadingState,...e.loadingState});function U(t,m){if(typeof e.by=="string"){const k=e.by;return(t==null?void 0:t[k])===(m==null?void 0:m[k])}return e.by(t,m)}function v(t){return e.modelValue?y.value.some(m=>U(Z(m),Z(t))):!1}function n(t){if(a.value.column===t.key){const m=!t.direction||t.direction==="asc"?"desc":"asc";a.value.direction===m?a.value=W({},I,{column:null,direction:"asc"}):a.value={column:a.value.column,direction:a.value.direction==="asc"?"desc":"asc"}}else a.value={column:t.key,direction:t.direction||"asc"}}function s(t){w.onSelect&&w.onSelect(t)}function p(){e.rows.forEach(t=>{v(t)||y.value.push(t)})}function E(t){t.target.checked?p():y.value=[]}function N(t,m,k=""){return P(t,m,k)}return{ui:h,attrs:$,sort:a,columns:x,rows:L,selected:y,indeterminate:o,emptyState:b,loadingState:f,isSelected:v,onSort:n,onSelect:s,onChange:E,getRowData:N}}}),$e={key:1},xe={key:0},Ve={key:0},Ue=["colspan"],_e={key:1},Ae=["colspan"],Be=["onClick"];function je(e,l,w,h,$,x){const a=te,I=G,L=ne,y=ae;return i(),g("div",M({class:e.ui.wrapper},e.attrs),[r("table",{class:u([e.ui.base,e.ui.divide])},[r("thead",{class:u(e.ui.thead)},[r("tr",{class:u(e.ui.tr.base)},[e.modelValue?(i(),g("th",{key:0,scope:"col",class:u(e.ui.checkbox.padding)},[c(a,{"model-value":e.indeterminate||e.selected.length===e.rows.length,indeterminate:e.indeterminate,"aria-label":"Select all",onChange:e.onChange},null,8,["model-value","indeterminate","onChange"])],2)):B("",!0),(i(!0),g(T,null,z(e.columns,(o,b)=>(i(),g("th",{key:b,scope:"col",class:u([e.ui.th.base,e.ui.th.padding,e.ui.th.color,e.ui.th.font,e.ui.th.size,o.class])},[R(e.$slots,`${o.key}-header`,{column:o,sort:e.sort,onSort:e.onSort},()=>[o.sortable?(i(),D(I,M({key:0,ref_for:!0},{...e.ui.default.sortButton||{},...e.sortButton},{icon:!e.sort.column||e.sort.column!==o.key?e.sortButton.icon||e.ui.default.sortButton.icon:e.sort.direction==="asc"?e.sortAscIcon:e.sortDescIcon,label:o[e.columnAttribute],onClick:f=>e.onSort(o)}),null,16,["icon","label","onClick"])):(i(),g("span",$e,j(o[e.columnAttribute]),1))])],2))),128))],2),e.loading&&e.progress?(i(),g("tr",xe,[r("td",{colspan:0,class:u(e.ui.progress.wrapper)},[c(L,M({...e.ui.default.progress||{},...e.progress},{size:"2xs"}),null,16)],2)])):B("",!0)],2),r("tbody",{class:u(e.ui.tbody)},[e.loadingState&&e.loading&&!e.rows.length?(i(),g("tr",Ve,[r("td",{colspan:e.columns.length+(e.modelValue?1:0)},[R(e.$slots,"loading-state",{},()=>[r("div",{class:u(e.ui.loadingState.wrapper)},[e.loadingState.icon?(i(),D(y,{key:0,name:e.loadingState.icon,class:u(e.ui.loadingState.icon),"aria-hidden":"true"},null,8,["name","class"])):B("",!0),r("p",{class:u(e.ui.loadingState.label)},j(e.loadingState.label),3)],2)])],8,Ue)])):e.emptyState&&!e.rows.length?(i(),g("tr",_e,[r("td",{colspan:e.columns.length+(e.modelValue?1:0)},[R(e.$slots,"empty-state",{},()=>[r("div",{class:u(e.ui.emptyState.wrapper)},[e.emptyState.icon?(i(),D(y,{key:0,name:e.emptyState.icon,class:u(e.ui.emptyState.icon),"aria-hidden":"true"},null,8,["name","class"])):B("",!0),r("p",{class:u(e.ui.emptyState.label)},j(e.emptyState.label),3)],2)])],8,Ae)])):(i(!0),g(T,{key:2},z(e.rows,(o,b)=>(i(),g("tr",{key:b,class:u([e.ui.tr.base,e.isSelected(o)&&e.ui.tr.selected,e.$attrs.onSelect&&e.ui.tr.active,o==null?void 0:o.class]),onClick:()=>e.onSelect(o)},[e.modelValue?(i(),g("td",{key:0,class:u(e.ui.checkbox.padding)},[c(a,{modelValue:e.selected,"onUpdate:modelValue":l[0]||(l[0]=f=>e.selected=f),value:o,"aria-label":"Select row",onClick:l[1]||(l[1]=re(()=>{},["stop"]))},null,8,["modelValue","value"])],2)):B("",!0),(i(!0),g(T,null,z(e.columns,(f,U)=>{var v;return i(),g("td",{key:U,class:u([e.ui.td.base,e.ui.td.padding,e.ui.td.color,e.ui.td.font,e.ui.td.size,(v=o[f.key])==null?void 0:v.class])},[R(e.$slots,`${f.key}-data`,{column:f,row:o,index:b,getRowData:n=>e.getRowData(o,f.key,n)},()=>[de(j(e.getRowData(o,f.key)),1)])],2)}),128))],10,Be))),128))],2)],2)],16)}const De=ie(we,[["render",je]]),Ie={class:"container my-8 pb-24"},Le={class:"flex justify-between items-center mb-6"},Ee={class:"flex gap-4 mb-6"},Re={class:"flex flex-col items-center justify-center py-12 gap-4"},Fe={key:0},Ne={class:"flex flex-col items-center gap-2"},Oe={key:1},Te={class:"flex items-center gap-2"},ze={class:"p-4 space-y-4"},Me={class:"flex justify-end gap-2"},Ke=ee({__name:"manage",setup(e){const l=ge(),w=me(),h=F(!1),$=F(!1),x=F(new Set),a=F({exchange:"",symbol:""}),I=[{key:"exchange",label:"Exchange"},{key:"symbol",label:"Symbol"},{key:"start_date",label:"Start Date"},{key:"end_date",label:"End Date"},{key:"actions",label:"Actions"}],L=C(()=>{let n=l.existingCandles;return a.value.exchange&&(n=n.filter(s=>s.exchange.toLowerCase().includes(a.value.exchange.toLowerCase()))),a.value.symbol&&(n=n.filter(s=>s.symbol.toLowerCase().includes(a.value.symbol.toLowerCase()))),n}),y=C(()=>h.value||$.value),o=n=>`${n.exchange}-${n.symbol}`;async function b(){A("success","Fetching latest candle details. This process might take from a few seconds up to a few minutes depending on the database size."),$.value=!0;try{await l.fetchExistingCandles()}finally{$.value=!1,A("success","Candles information updated successfully")}}async function f(n){const s=o(n);x.value.add(s);try{await l.deleteCandles(n.exchange,n.symbol),A("success","Candles deleted successfully")}catch{A("error","Failed to delete candles")}finally{x.value.delete(s)}}async function U(n){try{await l.updateCandles(n.exchange,n.symbol,n.start_date),A("success",`Started updating candles for ${n.symbol} on ${n.exchange}`)}catch{A("error","Failed to start candle update")}}const v=n=>w.backtestingExchangeNames.includes(n);return pe(async()=>{if(!l.existingCandles.length){h.value=!0;try{await l.fetchExistingCandles()}finally{h.value=!1}}}),(n,s)=>{const p=G,E=ye,N=be,t=he,m=ve,k=De,O=fe;return i(),g("div",Ie,[r("div",Le,[c(p,{class:"shadow-sm",icon:"i-heroicons-arrow-left",variant:"outline",to:"/candles",label:"Back"}),c(p,{class:"shadow-sm",icon:"i-heroicons-arrow-path",loading:$.value,label:"Refresh",onClick:b},null,8,["loading"])]),r("div",Ee,[c(E,{modelValue:a.value.exchange,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value.exchange=d),class:"w-64",icon:"i-heroicons-magnifying-glass",placeholder:"Filter by Exchange",ui:{icon:{trailing:{pointer:""}}}},{trailing:S(()=>[Q(c(p,{color:"gray",variant:"link",icon:"i-heroicons-x-mark-20-solid",padded:!1,onClick:s[0]||(s[0]=d=>a.value.exchange="")},null,512),[[X,a.value.exchange!==""]])]),_:1},8,["modelValue"]),c(E,{modelValue:a.value.symbol,"onUpdate:modelValue":s[3]||(s[3]=d=>a.value.symbol=d),icon:"i-heroicons-magnifying-glass",placeholder:"Filter by Symbol",class:"w-64",ui:{icon:{trailing:{pointer:""}}}},{trailing:S(()=>[Q(c(p,{color:"gray",variant:"link",icon:"i-heroicons-x-mark-20-solid",padded:!1,onClick:s[2]||(s[2]=d=>a.value.symbol="")},null,512),[[X,a.value.symbol!==""]])]),_:1},8,["modelValue"])]),h.value?(i(),D(N,{key:0,icon:"i-heroicons-information-circle",color:"gray",title:"Loading candles...",description:"This process might take from a few seconds up to a few minutes.",class:"mb-6"})):B("",!0),c(O,null,{default:S(()=>[c(k,{rows:L.value,columns:I,loading:y.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading candles..."},progress:{color:"primary",animation:"carousel"}},{"empty-state":S(()=>[r("div",Re,[q(l).existingCandles.length===0?(i(),g("div",Fe,[s[5]||(s[5]=r("span",{class:"text-gray-500 dark:text-gray-400 mb-4 block"}," Click the button below to fetch existing candles from the database ",-1)),r("div",Ne,[c(p,{icon:"i-heroicons-arrow-path",label:"Fetch Candles",onClick:b}),s[4]||(s[4]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"}," Note: This process might take a few minutes depending on the database size ",-1))])])):(i(),g("div",Oe,s[6]||(s[6]=[r("span",{class:"text-gray-500 dark:text-gray-400"}," No candles found matching your filters ",-1)])))])]),"actions-data":S(({row:d})=>[r("div",Te,[v(d.exchange)?(i(),D(p,{key:1,color:"teal",variant:"soft",icon:"i-heroicons-arrow-path",size:"xs",label:"Update",loading:q(l).isSymbolUpdating(d.exchange,d.symbol),disabled:!v(d.exchange),onClick:_=>U(d)},null,8,["loading","disabled","onClick"])):(i(),D(t,{key:0,text:"This exchange doesn't support backtesting"},{default:S(()=>[c(p,{color:"teal",variant:"soft",icon:"i-heroicons-arrow-path",size:"xs",label:"Update",loading:q(l).isSymbolUpdating(d.exchange,d.symbol),disabled:!v(d.exchange),onClick:_=>U(d)},null,8,["loading","disabled","onClick"])]),_:2},1024)),c(m,{popper:{placement:"bottom-end"}},{panel:S(({close:_})=>[r("div",ze,[r("p",null,'Are you sure you want to delete all candles for "'+j(d.symbol)+'" on "'+j(d.exchange)+'"?',1),r("div",Me,[c(p,{color:"gray",variant:"soft",label:"Cancel",onClick:_},null,8,["onClick"]),c(p,{color:"red",variant:"soft",label:"Delete",onClick:()=>{f(d),_()}},null,8,["onClick"])])])]),default:S(()=>[c(p,{color:"red",variant:"soft",icon:"i-heroicons-trash",size:"xs",loading:x.value.has(o(d)),label:"Delete"},null,8,["loading"])]),_:2},1024)])]),_:1},8,["rows","loading"])]),_:1})])}}});export{Ke as default};
