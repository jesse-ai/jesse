import{d as $,m as k,u as B,r as m,a as O,c as b,w as p,n as L,o as S,b as j,s as z,h as I,e as K,f as s,_ as R,g as q,i as n,j as o,k as A,l as H,p as W,q as F,t as G,v as J,x as P,y as Q,z as X}from"./CU_MfyYc.js";import{_ as Y}from"./DK27pemE.js";const Z=W(Y),ee={class:"flex items-center justify-between"},te={class:"space-y-4"},oe={class:"flex justify-end gap-3"},le=$({__name:"BacktestNotesModal",props:k({sessionId:{},initialTitle:{},initialDescription:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:k(["saved"],["update:modelValue"]),setup(y,{emit:h}){const a=y,V=h,i=B(y,"modelValue"),r=m(a.initialTitle||""),d=m(a.initialDescription||""),v=m(!1),u=m(),C=O(),g=b(()=>C.value==="light"?"vs-light":"vs-dark"),T={automaticLayout:!0,minimap:{enabled:!1},fontSize:15,lineHeight:21,wordWrap:"on"},x=b(()=>r.value!==(a.initialTitle||"")||d.value!==(a.initialDescription||""));p(g,t=>{var e,c;(c=(e=u.value)==null?void 0:e.$editor)==null||c.updateOptions({theme:t})}),p(()=>a.initialTitle,t=>{r.value=t||""}),p(()=>a.initialDescription,t=>{d.value=t||""}),p(i,async t=>{t?(await L(),setTimeout(()=>{var e;(e=u.value)!=null&&e.$editor&&(u.value.$editor.updateOptions({theme:g.value}),u.value.$editor.addCommand(2051,()=>{_()}))},100),window.addEventListener("keydown",f)):window.removeEventListener("keydown",f)}),S(()=>{window.removeEventListener("keydown",f)});function f(t){(t.metaKey||t.ctrlKey)&&t.key==="Enter"&&(t.preventDefault(),_())}async function _(){if(x.value){v.value=!0;try{await j().updateSessionNotes(a.sessionId,r.value,d.value),z("success","Notes saved successfully"),V("saved",{title:r.value,description:d.value}),i.value=!1}catch(t){I(t)}finally{v.value=!1}}}return(t,e)=>{const c=J,D=A,E=Z,N=H,w=G,U=X,M=R;return q(),K(M,{modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value=l),ui:{width:"sm:max-w-3xl"}},{default:s(()=>[n(U,null,{header:s(()=>[o("div",ee,[e[5]||(e[5]=o("h3",{class:"text-lg font-semibold"},"Add Title & Notes",-1)),n(c,{text:"Close",popper:{arrow:!0,offsetDistance:10}},{default:s(()=>[o("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none transition-all duration-300",onClick:e[0]||(e[0]=l=>i.value=!1)},[n(P(Q),{class:"h-5 w-5","aria-hidden":"true"})])]),_:1})])]),footer:s(()=>[o("div",oe,[n(w,{color:"gray",variant:"ghost",label:"Cancel",onClick:e[3]||(e[3]=l=>i.value=!1)}),n(w,{color:"primary",label:"Save",icon:"i-heroicons-check",disabled:!x.value,loading:v.value,onClick:_},null,8,["disabled","loading"])])]),default:s(()=>[o("div",te,[o("div",null,[e[6]||(e[6]=o("label",{class:"block text-sm font-medium mb-2"},"Title",-1)),n(D,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),placeholder:"Enter a title for this backtest",maxlength:"255",size:"lg"},null,8,["modelValue"])]),o("div",null,[e[8]||(e[8]=o("label",{class:"block text-sm font-medium mb-2"},"Description",-1)),n(N,null,{default:s(()=>[n(E,{ref_key:"descriptionEditorRef",ref:u,modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l),lang:"markdown",options:T,class:"border border-gray-200 dark:border-gray-800 rounded",style:{height:"400px"}},{default:s(()=>e[7]||(e[7]=[F(" Loading editor... ")])),_:1},8,["modelValue"])]),_:1})])])]),_:1})]),_:1},8,["modelValue"])}}});export{le as _};
