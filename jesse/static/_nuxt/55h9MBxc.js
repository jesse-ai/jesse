import{_ as tt}from"./D5TVA8bG.js";import{_ as st}from"./BBK6Zz--.js";import{_ as rt}from"./CE3vDUkH.js";import{d as ne,r as x,C as v,g as a,F as W,j as p,i as m,q as B,aw as ot,x as u,f as C,ab as Be,k as nt,aN as lt,t as we,s as oe,a8 as at,a as it,c as E,a6 as ut,w as q,B as Pe,A as de,n as dt,o as ct,K as xe,e as $,E as h,ad as mt,ae as pt,O as re,G as I,J as F,a0 as De,a7 as ft,D as G,bn as ue,L as gt,aO as Ae,H as ke,N as yt,ag as vt,ac as bt,aK as ht,I as _t,ai as kt}from"./DqOwpkBS.js";import{_ as xt}from"./CfX_5Lr5.js";import{_ as wt}from"./GkNmqWfM.js";import{_ as Tt,r as Ne}from"./CIgOo4zO.js";import{_ as Ct}from"./B_pA9n8i.js";import{_ as $t}from"./BCxOPoFh.js";import{_ as Et}from"./BQa5vPmZ.js";import{_ as St}from"./Xe5QT0q_.js";import{T as Lt}from"./9VOnL4Iz.js";import{s as qe,l as Rt,d as Vt}from"./BS9OwPT8.js";import{_ as It}from"./Cul2yqTt.js";import{_ as Pt}from"./n_Em2vSK.js";import{_ as Ue}from"./B28eTbtd.js";import{_ as Fe}from"./DLGiYoOZ.js";import{_ as Ut}from"./D5UsGNli.js";import{_ as Ot}from"./BUq_i-u4.js";import{u as ze}from"./B8dasSS2.js";import{u as Mt}from"./B8JYoF7V.js";import"./BIJgsyhf.js";import"./B9gej7JI.js";const jt={class:"flex justify-end item-center"},Dt={class:"flex justify-end"},At=ne({__name:"ReportLiveSession",props:{session:{}},emits:["close"],setup(z,{emit:o}){const w=o,S=x(!1),_=z,b=x({description:"",email:""}),c=()=>{w("close")},f=async()=>{if(S.value=!0,!b.value.description){oe("error","Please enter a description."),S.value=!1;return}const{data:d,error:r}=await at("/system/report-exception",{description:b.value.description,email:b.value.email,traceback:"manual report",mode:"live",attach_logs:!0,session_id:_.session},!0);if(S.value=!1,r.value&&r.value.statusCode!==200){oe("error",`[${r.value.statusCode}]: ${r.value.statusText}`);return}const k=d.value;k.status==="success"?(b.value.description="",b.value.email="",oe("success",k.message),c()):k.status==="error"&&oe("error",k.message)};return(d,r)=>{const k=nt,P=Be,D=lt,O=we,Q=ot;return a(),v(W,null,[r[5]||(r[5]=p("p",null," If you think something is wrong with your running live session, you can submit a report. By submitting this form, the logs of this session will be sent to Jesse's developers so we can see what's going on. ",-1)),r[6]||(r[6]=p("br",null,null,-1)),r[7]||(r[7]=p("p",null,[B("Your exchange API keys and strategies are safe and "),p("b",null,"are never sent to us.")],-1)),r[8]||(r[8]=p("br",null,null,-1)),m(Q,{state:u(b),class:"space-y-4",onSubmit:f},{default:C(()=>[m(P,{label:"Email (optional)",help:"Enter your email address for us to know who sent the email and possibly reply back to you."},{default:C(()=>[m(k,{modelValue:u(b).email,"onUpdate:modelValue":r[0]||(r[0]=H=>u(b).email=H),placeholder:"Email address...",type:"email"},null,8,["modelValue"])]),_:1}),r[3]||(r[3]=p("br",null,null,-1)),m(P,{label:"Description:",name:"Description"},{default:C(()=>[m(D,{modelValue:u(b).description,"onUpdate:modelValue":r[1]||(r[1]=H=>u(b).description=H),rows:10,placeholder:"Describe what you think is wrong in this session..."},null,8,["modelValue"])]),_:1}),r[4]||(r[4]=p("br",null,null,-1)),p("div",jt,[p("div",Dt,[m(O,{color:"gray",variant:"ghost",class:"mr-2",label:"Cancel",onClick:r[2]||(r[2]=H=>c())}),m(O,{type:"submit",class:"w-48 flex justify-center",label:"Submit",loading:u(S),disabled:u(S)},null,8,["loading","disabled"])])])]),_:1},8,["state"])],64)}}}),Nt={class:"mb-16"},qt={key:0,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600 p-4"},Bt={key:2},Ft=ne({__name:"CandlesChart",props:{form:{},results:{}},setup(z){const o=it(),w=E(()=>ut().params.id),S=x(!0),_=x(2),b=x(null),c=z,f=x();let d=null,r=null;const k={orderEntries:{},positionEntry:null};let P=null,D=null;const O=x({}),Q=E(()=>o.value),H=E(()=>c.form.exchange),A=E(()=>{var t,i;return`${H.value}-${((t=c.results.selectedRoute)==null?void 0:t.symbol)||""}-${((i=c.results.selectedRoute)==null?void 0:i.timeframe)||""}`}),Y=E(()=>c.results.currentCandles),X=E(()=>{const t=c.results.positions.find(i=>i[0].value===c.results.selectedRoute.symbol);return t===void 0?[]:t}),Z=E(()=>{var t,i;return((i=(t=X.value)==null?void 0:t[2])==null?void 0:i.value)??0}),ee=E(()=>{var i,n;const t=Number(((n=(i=X.value)==null?void 0:i[1])==null?void 0:n.value)??0);return t>0?"long":t<0?"short":"close"});q(Q,t=>{ye(t)}),q(Z,(t,i)=>{r!==null&&t!==i&&pe()}),q(()=>c.results.orders,()=>{r!==null&&(fe(),me())},{deep:!0});let U=null;function M(){U||(U=setTimeout(async()=>{U=null,await J()},750))}const ce=E(()=>{var i,n;const t=c.results.generalInfo||{};return[c.results.phase,c.form.exchange,(i=c.results.selectedRoute)==null?void 0:i.symbol,(n=c.results.selectedRoute)==null?void 0:n.timeframe,t.count_trades,t.count_active_orders].join("|")});q(ce,()=>{r&&["running","stopping"].includes(c.results.phase)&&M()});function me(){var T;if(!r||!((T=c.results.selectedRoute)!=null&&T.symbol))return;const t=A.value,i=O.value[t]||[],n=new Set(i.map(y=>y.order_id)),l=c.results.orders.filter(y=>y.status==="EXECUTED"&&y.executed_at&&y.symbol===c.results.selectedRoute.symbol&&!n.has(y.id));if(l.length>0){const y=l.map(R=>ae(R,c.results.selectedRoute.timeframe));O.value[t]=[...i,...y],te()}}async function J(){var i;if(!r||!((i=c.results.selectedRoute)!=null&&i.symbol))return;const t=A.value;try{const l=await de().fetchOrdersHistory({limit:500,offset:0,id_search:w.value,status_filter:"EXECUTED",symbol_filter:c.results.selectedRoute.symbol,exchange_filter:c.form.exchange||null,date_filter:"90_days",type_filter:null,side_filter:null});if(l.orders&&l.orders.length>0){const T=l.orders.filter(y=>y.executed_at).map(y=>ae(y,c.results.selectedRoute.timeframe));O.value[t]=T,te()}}catch(n){console.error("Failed to refresh executed order markers:",n)}}q(Y,(t,i)=>{r!==null&&ge(t[A.value],t[A.value])}),Pe(async()=>{D=setTimeout(async()=>{await K()},200)});async function K(){var t,i;S.value=!0,b.value=null;try{await de().fetchCandles(w.value);const n=Se(c.results.candles);if(n){S.value=!1,b.value=n,console.error("Candle data validation failed:",n);return}S.value=!1,await dt();const l=f.value;if(!l)return;qe.width=l.clientWidth,d=Lt(l,qe),d.applyOptions({watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${c.results.selectedRoute.symbol} • ${c.results.selectedRoute.timeframe}`}}),r=d.addCandlestickSeries();const T=(c.results.candles||[]).map(y=>{const R=ve(y==null?void 0:y.time);return R===null?null:{...y,time:R}}).filter(Boolean);if(r.setData(T),T.length>0){const y=T[T.length-1];P=y==null?void 0:y.time}else P=null;d.timeScale().fitContent(),r.applyOptions({priceFormat:{type:"price",precision:_.value,minMove:.01}}),ge((t=c.results.candles)==null?void 0:t[0],(i=c.results.candles)==null?void 0:i[1]),pe(),fe(),await Te(),ye(Q.value)}catch(n){S.value=!1,b.value=(n==null?void 0:n.message)||"An unexpected error occurred while loading the chart",console.error("Failed to initialize candle chart:",n),le()}}async function Te(){var i,n;if(!r||!((i=c.results.selectedRoute)!=null&&i.symbol))return;const t=A.value;if(((n=O.value[t])==null?void 0:n.length)>0){te();return}try{const T=await de().fetchOrdersHistory({limit:500,offset:0,id_search:w.value,status_filter:"EXECUTED",symbol_filter:c.results.selectedRoute.symbol,exchange_filter:c.form.exchange||null,date_filter:"90_days",type_filter:null,side_filter:null});if(T.orders&&T.orders.length>0){const y=T.orders.filter(R=>R.executed_at).map(R=>ae(R,c.results.selectedRoute.timeframe));O.value[t]=y,te()}}catch(l){console.error("Failed to load historical executed orders:",l)}}ct(()=>{le(),D&&(clearTimeout(D),D=null)});function le(){d!==null&&(d.remove(),d=null),r&&(r=null),P=null}function Ce(t){const i={m:60,h:3600,d:86400,w:604800},n=t.match(/^(\d+)([mhdw])$/);return n?parseInt(n[1])*i[n[2]]:60}function $e(t,i){const n=Math.floor(t/1e3),l=Ce(i);return Math.floor(n/l)*l}function ae(t,i){var l;const n=((l=t.side)==null?void 0:l.toLowerCase())||"buy";return{time:$e(t.executed_at,i),position:n==="buy"?"belowBar":"aboveBar",color:n==="buy"?"#2196F3":"#e91e63",shape:n==="buy"?"arrowUp":"arrowDown",text:n.toUpperCase(),order_id:t.id}}function te(){if(!r)return;const t=A.value,i=O.value[t]||[],n=Array.from(new Map(i.map(l=>[l.order_id,l])).values()).sort((l,T)=>l.time-T.time).slice(-500);O.value[t]=n,r.setMarkers(n)}function pe(){const t=ee.value==="long"?"#00AB5C":"#FF497D";if(k.positionEntry&&r.removePriceLine(k.positionEntry),Number(Z.value)>0){const i={price:Number(Z.value),color:t,lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:"Entry Price"};k.positionEntry=r.createPriceLine(i)}}function fe(){var i,n;const t=(n=(i=X.value)==null?void 0:i[0])==null?void 0:n.value;if(t){for(const l in k.orderEntries)r.removePriceLine(k.orderEntries[l]),delete k.orderEntries[l];c.results.orders.forEach(l=>{const T=l.side==="buy"?"#00AB5C":"#FF497D",y=xe.startCase(xe.lowerCase(`${l.side} ${l.type}`));if((l.status==="ACTIVE"||l.status==="QUEUED")&&l.symbol===t){const R={price:Number(l.price),color:T,lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:y};k.orderEntries[l.id]=r.createPriceLine(R)}})}}function ge(t,i){if(!(!t||!i)&&c.results.candles.length!==0&&!b.value)try{const n=String(t.open).indexOf("."),l=n===-1?0:String(t.open).length-n-1,T=String(i.open).indexOf("."),y=T===-1?0:String(i.open).length-T-1,R=l>y?l:y;_.value=R,(_.value<0||_.value>100)&&(_.value=0),r.applyOptions({priceFormat:{type:"price",precision:_.value,minMove:Math.pow(10,-R).toFixed(R)}});const e=c.results.currentCandles[A.value];if(!e)return;const s=be(e,-1);if(s){console.warn("Received invalid candle update, skipping:",s);return}const j=ve(e.time);if(j===null||P!==null&&j<P)return;const N={...e,time:j};r.update(N),P=j}catch(n){console.error("Error updating candle:",n)}}function ye(t){d!==null&&d.applyOptions(t==="light"?Rt.chart:Vt.chart)}function Ee(t){c.results.selectedRoute=t,b.value=null,le(),K()}function ve(t){if(typeof t=="number")return t;if(t&&typeof t=="object"){if("year"in t&&"month"in t&&"day"in t){const{year:i,month:n,day:l}=t;return Math.floor(Date.UTC(i,n-1,l)/1e3)}if(t instanceof Date)return Math.floor(t.getTime()/1e3)}return null}function be(t,i){if(!t||typeof t!="object")return`Candle at index ${i} is not a valid object`;const n=["time","open","high","low","close"];for(const l of n){if(!(l in t))return`Candle at index ${i} is missing required field: ${l}`;if(l==="time"){if(typeof t.time!="number"&&typeof t.time!="object")return`Candle at index ${i} has invalid time format`}else if(typeof t[l]!="number"||isNaN(t[l]))return`Candle at index ${i} has invalid ${l} value (expected number, got ${typeof t[l]})`}return null}function Se(t){if(!Array.isArray(t))return"Candle data is not an array";if(t.length===0)return null;const i=[...t.slice(0,5).map((n,l)=>l),...t.slice(-5).map((n,l)=>t.length-5+l)].filter((n,l,T)=>T.indexOf(n)===l&&n>=0&&n<t.length);for(const n of i){const l=be(t[n],n);if(l)return l}return null}async function Le(){b.value=null,await K()}return(t,i)=>{const n=Et,l=we,T=St;return a(),v("div",Nt,[u(S)?(a(),v("div",qt,[m(n,{class:"h-4 w-full mb-4"}),m(n,{class:"h-4 w-2/3 mb-4"}),m(n,{class:"h-4 w-1/2 mb-4"}),m(n,{class:"h-4 w-full mb-4"}),m(n,{class:"h-4 w-full mb-4"}),m(n,{class:"h-4 w-2/3 mb-4"}),m(n,{class:"h-4 w-full mb-4"}),m(n,{class:"h-4 w-full"})])):u(b)?(a(),$(T,{key:1,icon:"i-heroicons-exclamation-triangle",color:"amber",variant:"subtle",title:"Unable to display candle chart",description:u(b)},{actions:C(()=>[m(l,{variant:"solid",color:"white",size:"xs",icon:"i-heroicons-arrow-path",onClick:Le},{default:C(()=>i[0]||(i[0]=[B(" Retry ")])),_:1})]),_:1},8,["description"])):h("",!0),mt(p("div",{ref_key:"chartContainer",ref:f,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),[[pt,!u(S)&&!u(b)]]),c.form.routes.length>1&&!u(b)?(a(),v("div",Bt,[(a(!0),v(W,null,re(c.form.routes,y=>(a(),$(l,{key:y.symbol,variant:"soft",color:"gray",disabled:t.results.selectedRoute.symbol===y.symbol&&t.results.selectedRoute.timeframe===y.timeframe,class:"mt-2 mr-2",onClick:R=>Ee(y)},{default:C(()=>[B(I(y.symbol)+" • "+I(y.timeframe),1)]),_:2},1032,["disabled","onClick"]))),128))])):h("",!0)])}}}),zt={class:"flex justify-end mb-4"},Ht=ne({__name:"LiveClosedTrades",props:{trades:{},sessionId:{}},emits:["trade-click","reload"],setup(z,{emit:o}){const w=z,S=o,_=x(!1),b=E(()=>{if(!w.trades.length)return[];const d=[];for(const r of w.trades)d.push([{value:r.symbol,style:"text-xs"},{value:r.type,style:F.colorBasedOnType(r.type)},{value:F.roundPrice(r.entry_price),style:"text-xs"},{value:r.exit_price?F.roundPrice(r.exit_price):"-",style:"text-xs"},{value:r.qty,style:"text-xs"},{value:r.pnl!==null?`${xe.round(r.pnl,2)} (${xe.round(r.pnl_percentage,2)}%)`:"-",style:r.pnl!==null?F.colorBasedOnNumber(r.pnl):""},{value:F.timestampToTimeOnly(r.opened_at),style:"text-xs",tooltip:F.timestampToTime(r.opened_at)},{value:r.status,style:r.status==="open"?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"}]);return d});function c(d){if(d>=0&&d<w.trades.length){const r=w.trades[d];S("trade-click",r.id)}}async function f(){_.value=!0,S("reload"),setTimeout(()=>{_.value=!1},1e3)}return(d,r)=>{const k=we,P=Ue,D=Fe;return a(),v("div",null,[p("div",zt,[m(k,{icon:"i-heroicons-arrow-path",size:"xs",variant:"soft",color:"gray",loading:u(_),label:"Reload Trades",class:"font-bold uppercase tracking-wider text-[10px]",onClick:f},null,8,["loading"])]),u(b).length?(a(),$(P,{key:0,data:u(b),"header-items":["Symbol","Type","Entry","Exit","QTY","PNL","Opened","Status"],header:"",clickable:!0,onRowClick:c},null,8,["data"])):(a(),$(D,{key:1,class:"mt-4"}))])}}}),Jt=ne({__name:"LiveOrders",props:{orders:{}},emits:["order-click"],setup(z,{emit:o}){const w=z,S=o,_=E(()=>{if(!w.orders.length)return[];const c=[];for(let f=w.orders.length-1;f>=0;f--){const d=w.orders[f];c.push([{value:d.id.slice(-12),style:"text-xs",tooltip:d.id,tag:"code"},{value:F.timestampToTimeOnly(d.created_at),style:"text-xs",tooltip:F.timestampToTime(d.created_at)},{value:d.symbol,style:"text-xs"},{value:d.type,style:"text-xs"},{value:d.side,style:F.colorBasedOnSide(d.side)},{value:d.price,style:"text-xs"},{value:d.qty,style:F.colorBasedOnSide(d.side)},{value:d.status,style:"text-xs"}])}return c});function b(c){const f=w.orders.length-1-c;if(f>=0&&f<w.orders.length){const d=w.orders[f];S("order-click",d.id)}}return(c,f)=>{const d=Ue,r=Fe;return u(_).length?(a(),$(d,{key:0,data:u(_),"header-items":["ID","Created","Symbol","Type","Side","Price","QTY","Status"],header:"",clickable:!0,onRowClick:b},null,8,["data"])):(a(),$(r,{key:1}))}}}),Wt={key:0,class:"flex flex-col items-center justify-center mt-[6%]"},Kt=["textContent"],Qt={class:"mt-8"},Yt={key:1,class:"mx-auto container mt-8"},Gt={key:0,"data-cy":"live-page-content"},Xt={class:"flex justify-between items-center"},Zt={class:"grid grid-cols-1 gap-6"},es={class:"flex justify-between items-center"},ts={key:1},ss={key:0,class:"mb-8"},rs={class:"flex justify-between items-center mb-4"},os={class:"flex gap-2"},ns=["onClick"],ls={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},as={class:"mt-12 mb-6 p-1 bg-gray-50 dark:bg-gray-900/50 border dark:border-gray-700 rounded-2xl flex items-center gap-1"},is=["onClick"],us={key:0,class:"w-2 h-2 rounded-full shrink-0 bg-green-500"},ds={class:"truncate"},cs={key:0,class:"mt-8 lg:mt-0"},ms={key:3,class:"grid grid-cols-2 gap-4 mt-4"},ps={key:4,class:"grid grid-cols-2 gap-4 mt-4"},fs={key:1,"data-cy":"live-action-button"},gs={key:0,class:"my-8 border-2 dark:border-gray-600 rounded-full"},ys={key:1,class:"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden"},vs={class:"px-6 py-4 space-y-3"},bs={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},hs={key:2,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden"},_s={class:"px-6 py-4 space-y-3"},ks={class:"text-sm font-medium text-gray-500 dark:text-gray-400 shrink-0"},xs={class:"text-sm font-semibold text-gray-900 dark:text-gray-100 sm:text-right whitespace-pre-wrap overflow-x-auto max-w-full"},ws={key:3,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},Ts={class:"px-6 py-4 space-y-4"},Cs={class:"text-sm font-bold text-gray-900 dark:text-gray-100 truncate pr-2"},$s={class:"text-sm text-gray-500 dark:text-gray-400 truncate text-center px-2"},Es={class:"flex justify-end ml-auto"},Ss={key:4,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},Ls={class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50 flex justify-between items-center"},Rs={class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},Vs={class:"px-6 py-4"},Is={key:0,class:"text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Ps={key:1,class:"text-sm text-gray-400 dark:text-gray-500 italic text-center py-2"},Us=ne({__name:"LiveTab",props:{form:{},results:{},session:{},tabs:{}},setup(z){const o=z,w=E(()=>o.results.generalInfo.title?`${o.results.generalInfo.title} - Live Session - Jesse`:"Live Session - Jesse");ze({title:w});const S=x([]),_=x(!1),b=x(!1),c=x(!1),f=x(!1),d=x(!1),r=x(!1),k=x(!1),P=x(!1),D=x(!1),O=x(!1),Q=x(null),H=x(null),A=x("positions"),Y=x(!1),X=x(null),Z=x(null),ee=x("auto"),U=De(),M=de(),ce=E(()=>["running","stopping"].includes(o.results.phase)&&!o.results.exception.error),me=e=>e?F.timestampToTime(e):"-",J=x([]);async function K(){if(o.results.phase==="editing"){if(!o.form.paper_mode){const e=U.exchangeApiKeys.find(s=>s.id===o.form.exchange_api_key_id);e&&(o.form.exchange=e.exchange)}try{J.value=await De().getExchangeSupportedSymbols(o.form.exchange);for(let e=0;e<o.form.routes.length;e++)J.value.includes(o.form.routes[e].symbol)||(o.form.routes[e].symbol=J.value[0]);if(o.form.data_routes.length>0)for(let e=0;e<o.form.data_routes.length;e++)J.value.includes(o.form.data_routes[e].symbol)||(o.form.data_routes[e].symbol=J.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}}Pe(async()=>{setTimeout(async()=>{o.form.exchange&&(o.results.phase==="editing"||!J.value.length)&&await K()},200),["running","stopping","ended"].includes(o.results.phase)&&await M.fetchEquityCurve(o.session,ee.value)}),q(()=>o.form.exchange,async(e,s)=>{e!==s&&await K()}),q(()=>o.results.phase,async e=>{e==="editing"&&await K()});const Te=ft(()=>{o.results.phase==="editing"&&M.saveState(o.session)},1e3);q(()=>o.form,()=>{Te()},{deep:!0}),q(()=>o.form.exchange_api_key_id,async(e,s)=>{e!==s&&await K()}),q(Y,async e=>{if(e){const s=await M.getSessionData(o.session);s!=null&&s.session&&(X.value=s.session.title||null,Z.value=s.session.description||null)}});function le(e){o.results.generalInfo.title=e.title||null,o.results.generalInfo.description=e.description||null}const Ce=E(()=>{var V;const e=o.results.generalInfo||{},s=e.exchange||o.form.exchange||"-",j=e.started_at||((V=o.results.generalInfo)==null?void 0:V.started_at),N=e.pnl!==void 0&&e.pnl!==null&&e.pnl_perc!==void 0&&e.pnl_perc!==null,Re=e.started_balance!==void 0&&e.started_balance!==null&&e.current_balance!==void 0&&e.current_balance!==null,ie=N?e.pnl>0?"text-green-500":e.pnl<0?"text-rose-500":"":"",se=[{label:"Exchange",value:s},{label:"Current Time",value:me(e.current_time)},{label:"Debug Mode",value:e.debug_mode??o.form.debug_mode??"-"},{label:"Paper Trade",value:e.paper_mode??o.form.paper_mode??"-"},{label:"PNL",value:N?`${e.pnl} (${e.pnl_perc}%)`:"-",color:ie},{label:"Started",value:me(j)},{label:"Started/Current Balance",value:Re?`${e.started_balance} / ${e.current_balance}`:"-"},{label:"Trades",value:`${e.count_trades??0}`}],he=e.leverage_type||"spot";return he!=="spot"&&(se.push({label:"Available Margin",value:`${e.available_margin??"-"}`}),se.push({label:"Leverage",value:`${e.leverage??"-"}x (${he})`})),se}),$e=E(()=>U.notificationApiKeys.map(e=>({label:`${e.name} - ${e.driver}`,value:e.id}))),ae=E(()=>Math.round(o.results.progressbar.estimated_remaining_seconds)===0?"Please wait...":`${Math.round(o.results.progressbar.estimated_remaining_seconds)} seconds remaining...`),te=E(()=>{let e=[];const s=U.jesseSupportedTimeframes;return U.settings.live.generate_candles_from_1m||!o.form.exchange?e=s.map(j=>U.planLimits.timeframes.includes(j)?{label:j,value:j,disabled:!1}:{label:`${j} (Upgrade required)`,value:j,disabled:!0}):e=U.exchangeInfo[o.form.exchange].supported_timeframes.map(N=>U.planLimits.timeframes.includes(N)?{label:N,value:N,disabled:!1}:{label:`${N} (Upgrade required)`,value:N,disabled:!0}),e}),pe=E(()=>U.liveTradingExchangeNames.map(e=>U.planLimits.exchanges.includes(e)?{label:e,value:e,disabled:!1}:{label:`${e} (Upgrade required)`,value:e,disabled:!0})),fe=E(()=>U.exchangeApiKeys.map(e=>U.planLimits.exchanges.includes(e.exchange)?{label:`${e.exchange} - ${e.name}`,value:e.id,disabled:!1}:{label:`${e.exchange} - ${e.name} (Upgrade required)`,value:e.id,disabled:!0})),ge=M.cancel,ye=M.newLive;function Ee(e){M.start(e)}function ve(e){M.closeTab(e)}async function be(){o.results.infoLogs===""&&o.results.generalInfo.count_info_logs>0&&await M.fetchLogs(o.session),k.value=!0}async function Se(){o.results.errorLogs===""&&o.results.generalInfo.count_error_logs>0&&await M.fetchLogs(o.session),P.value=!0}function Le(){b.value=!0,navigator.clipboard.writeText(o.results.infoLogs),oe("success","Logs copied successfully"),f.value=!0,setTimeout(()=>{f.value=!1},3e3)}function t(){c.value=!0,navigator.clipboard.writeText(o.results.errorLogs),oe("success","Logs copied successfully"),d.value=!0,setTimeout(()=>{d.value=!1},3e3)}const i=E(()=>["basic","pro","enterprise","basic-lifetime","pro-lifetime","enterprise-lifetime","lifetime"].includes(U.plan));function n(e){Q.value=e,D.value=!0}function l(e){H.value=e,O.value=!0}function T(e){A.value=e,e==="trades"&&y()}async function y(){const e=await M.fetchTrades(o.session);e&&(o.results.trades=e)}async function R(e){ee.value=e,await M.fetchEquityCurve(o.session,e)}return q(()=>o.results.phase,async e=>{["running","stopping","ended"].includes(e)&&await M.fetchEquityCurve(o.session,ee.value)},{immediate:!0}),(e,s)=>{const j=st,N=rt,Re=At,ie=gt,se=xt,he=wt,V=we,Oe=Tt,Me=yt,Ve=Ct,He=$t,je=vt,Je=Be,We=Ft,Ke=It,Qe=bt,_e=Pt,Ye=Ue,Ge=Ht,Xe=Jt,Ze=Ut,et=Ot;return a(),v(W,null,[m(j,{modelValue:u(D),"onUpdate:modelValue":s[0]||(s[0]=g=>G(D)?D.value=g:null),"trade-id":u(Q),onOrderClick:l},null,8,["modelValue","trade-id"]),m(N,{modelValue:u(O),"onUpdate:modelValue":s[1]||(s[1]=g=>G(O)?O.value=g:null),"order-id":u(H)},null,8,["modelValue","order-id"]),m(ie,{modelValue:u(r),"onUpdate:modelValue":s[3]||(s[3]=g=>G(r)?r.value=g:null),size:"small",title:"Report An Issue"},{default:C(()=>[m(Re,{session:e.session,onClose:s[2]||(s[2]=g=>r.value=!1)},null,8,["session"])]),_:1},8,["modelValue"]),m(ie,{modelValue:u(k),"onUpdate:modelValue":s[4]||(s[4]=g=>G(k)?k.value=g:null),title:"Info Logs"},{default:C(()=>[m(se,{logs:e.results.infoLogs},null,8,["logs"])]),buttons:C(()=>[p("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:Le},[u(f)?(a(),$(u(Ae),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0),!u(f)&&e.results.infoLogs.length!=0?(a(),$(u(Ne),{key:1,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1},8,["modelValue"]),m(ie,{modelValue:u(P),"onUpdate:modelValue":s[5]||(s[5]=g=>G(P)?P.value=g:null),title:"Error Logs"},{default:C(()=>[m(se,{logs:e.results.errorLogs},null,8,["logs"])]),buttons:C(()=>[p("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:t},[u(d)?(a(),$(u(Ae),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0),!u(d)&&e.results.errorLogs.length!=0?(a(),$(u(Ne),{key:1,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1},8,["modelValue"]),e.results.phase==="starting"?(a(),v("div",Wt,[p("div",null,[m(he,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?h("",!0):(a(),v("h3",{key:0,class:"mt-8 animate-pulse",textContent:I(u(ae))},null,8,Kt)),p("div",Qt,[e.form.debug_mode?(a(),$(V,{key:0,icon:"i-heroicons-clipboard-document-list",variant:"solid",label:"View Logs",class:"flex justify-center w-64",onClick:s[6]||(s[6]=g=>k.value=!0)})):h("",!0),m(V,{color:"gray",class:"w-64 flex justify-center mt-4",ui:{color:{gray:{soft:"text-rose-500 dark:text-rose-400"}}},icon:"i-heroicons-no-symbol",variant:"soft",label:"Cancel",trailing:!1,onClick:s[7]||(s[7]=g=>u(ge)((e._.provides[ue]||e.$route).params.id))})]),e.results.exception.error?(a(),v("div",Yt,[m(Oe,{modelValue:u(_),"onUpdate:modelValue":s[8]||(s[8]=g=>G(_)?_.value=g:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"live","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):h("",!0)])):(a(),$(Ze,{key:1},{left:C(()=>[e.results.phase==="editing"?(a(),v("div",Gt,[m(Me,{class:"mb-4",title:"Exchange"}),e.form.paper_mode?(a(),$(Ve,{key:0,modelValue:e.form.exchange,"onUpdate:modelValue":s[9]||(s[9]=g=>e.form.exchange=g),placeholder:"Select an exchange...",searchable:"",options:u(pe),"value-attribute":"value",class:"mt-2 mb-16"},null,8,["modelValue","options"])):(a(),$(Ve,{key:1,modelValue:e.form.exchange_api_key_id,"onUpdate:modelValue":s[10]||(s[10]=g=>e.form.exchange_api_key_id=g),placeholder:"Select an exchange...",searchable:"",options:u(fe),"value-attribute":"value",class:"mt-2 mb-16"},{empty:C(()=>[p("div",Xt,[s[21]||(s[21]=p("span",null," No exchange API keys found. Please add at least one: ",-1)),m(V,{to:"/exchange-api-keys",icon:"i-heroicons-plus",type:"link",variant:"solid",size:"sm",label:"Add Exchange API Key"})])]),_:1},8,["modelValue","options"])),m(He,{"total-routes-error":u(S),form:e.form,results:e.results,mode:"live",symbols:u(J),timeframes:u(te)},null,8,["total-routes-error","form","results","symbols","timeframes"]),m(Me,{class:"mt-16 mb-4",title:"Options"}),p("div",Zt,[m(je,{modelValue:e.form.debug_mode,"onUpdate:modelValue":s[11]||(s[11]=g=>e.form.debug_mode=g),title:"Debug Mode",description:"Logs more details, helpful for debugging."},null,8,["modelValue"]),m(je,{modelValue:e.form.paper_mode,"onUpdate:modelValue":s[12]||(s[12]=g=>e.form.paper_mode=g),title:"Paper Trade",disabled:!u(i),"disabled-guide":u(i)?"":"Premium plan required",description:"Trade in real-time using actual exchange data with PAPER money."},null,8,["modelValue","disabled","disabled-guide"]),m(Je,{label:"Notifications:",help:"Select a notification driver to receive notifications"},{default:C(()=>[m(Ve,{modelValue:e.form.notification_api_key_id,"onUpdate:modelValue":s[13]||(s[13]=g=>e.form.notification_api_key_id=g),placeholder:"Select a notification driver",options:u($e),"value-attribute":"value"},{empty:C(()=>[p("div",es,[s[22]||(s[22]=p("span",null," No notification API keys found. Please add at least one: ",-1)),m(V,{to:"/notification-api-keys",icon:"i-heroicons-plus",type:"link",variant:"solid",size:"sm",label:"Add Notification API Key"})])]),_:1},8,["modelValue","options"])]),_:1})])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("div",ts,[e.results.exception.error?(a(),v("div",ss,[m(Oe,{title:e.results.exception.error,content:e.results.exception.traceback,mode:"live","debug-mode":e.form.debug_mode},null,8,["title","content","debug-mode"])])):h("",!0),u(ce)?(a(),$(We,{key:1,results:e.results,form:e.form,exchange:e.form.exchange},null,8,["results","form","exchange"])):h("",!0),["running","stopping","ended"].includes(e.results.phase)?(a(),v("div",{key:2,class:ke(u(ce)?"mt-12":"mt-0")},[p("div",rs,[s[23]||(s[23]=p("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100"},"Equity Curve",-1)),p("div",os,[(a(),v(W,null,re(["1m","5m","15m","1h","1d","auto"],g=>p("button",{key:g,class:ke(["px-3 py-1.5 text-xs font-semibold rounded-lg transition-colors duration-200",[u(ee)===g?"bg-primary-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]]),onClick:L=>R(g)},I(g.toUpperCase()),11,ns)),64))])]),e.results.charts.equity_curve.length===0?(a(),v("div",ls," No equity data yet. It should appear shortly after the session starts (usually within ~1 minute). ")):(a(),$(Ke,{key:1,data:e.results.charts.equity_curve},null,8,["data"]))],2)):h("",!0),p("div",as,[(a(!0),v(W,null,re([{id:"positions",label:"Positions",count:e.results.generalInfo.open_positions,icon:"i-heroicons-chart-bar"},{id:"trades",label:"Trades",count:e.results.generalInfo.count_trades,icon:"i-heroicons-arrows-right-left"},{id:"orders",label:"Orders",count:e.results.generalInfo.count_active_orders,icon:"i-heroicons-list-bullet"}],g=>(a(),v("button",{key:g.id,class:ke(["flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-xs font-bold rounded-xl select-none h-10 group focus:outline-none transition-colors duration-200",[u(A)===g.id?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-600":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700/50 border border-transparent"]]),onClick:L=>T(g.id)},[g.id==="positions"&&g.count>0?(a(),v("div",us)):(a(),$(Qe,{key:1,name:g.icon,class:"w-4 h-4 shrink-0"},null,8,["name"])),p("span",ds,I(g.label.toUpperCase()),1),g.count>0?(a(),$(_e,{key:2,color:"gray",variant:"solid",size:"xs",class:"ml-1 px-1.5 py-0 min-w-[1.25rem] flex justify-center text-[10px] font-black rounded-md"},{default:C(()=>[B(I(g.count),1)]),_:2},1024)):h("",!0)],10,is))),128))]),p("div",null,[u(A)==="positions"?(a(),$(Ye,{key:0,data:e.results.positions,"header-items":["Symbol","QTY","Entry","Price","Liq Price","PNL"],header:""},null,8,["data"])):h("",!0),u(A)==="trades"?(a(),$(Ge,{key:1,trades:e.results.trades,"session-id":e.session,onTradeClick:n,onReload:y},null,8,["trades","session-id"])):h("",!0),u(A)==="orders"?(a(),$(Xe,{key:2,orders:e.results.orders,onOrderClick:l},null,8,["orders"])):h("",!0)])])):h("",!0)]),right:C(()=>{var g;return[p("div",null,[["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("div",cs,[e.results.phase==="ended"||e.results.phase==="error"?(a(),$(V,{key:0,class:"w-full flex justify-center",variant:"solid",icon:"i-heroicons-plus",label:"New session",onClick:s[14]||(s[14]=L=>u(ye)((e._.provides[ue]||e.$route).params.id))})):(a(),$(V,{key:1,class:"w-full flex justify-center",variant:"soft",color:"gray",icon:"i-heroicons-no-symbol",label:e.results.phase==="stopping"?"Terminating...":"Terminate",ui:{color:{gray:{soft:"text-rose-500 dark:text-rose-400"}}},onClick:s[15]||(s[15]=L=>u(M).openStopConfirmModal((e._.provides[ue]||e.$route).params.id))},null,8,["label"])),["running","stopping","ended","error"].includes(e.results.phase)?(a(),$(V,{key:2,class:"w-full flex justify-center mt-4",variant:"soft",color:"gray",icon:"i-heroicons-flag",label:"Report",onClick:s[16]||(s[16]=L=>r.value=!0)})):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("div",ms,[m(V,{color:"gray",variant:"soft",icon:"i-heroicons-clipboard-document-list",class:"flex justify-center",onClick:be},{trailing:C(()=>[m(_e,{color:"gray",variant:"solid",size:"xs",class:"ml-1"},{default:C(()=>[B(I(e.results.generalInfo.count_info_logs),1)]),_:1})]),default:C(()=>[s[24]||(s[24]=B(" Logs "))]),_:1}),m(V,{color:"gray",variant:"soft",icon:"i-heroicons-exclamation-triangle",class:"flex justify-center",onClick:Se},{trailing:C(()=>[m(_e,{color:e.results.generalInfo.count_error_logs>0?"rose":"gray",variant:"solid",size:"xs",class:"ml-1"},{default:C(()=>[B(I(e.results.generalInfo.count_error_logs),1)]),_:1},8,["color"])]),default:C(()=>[s[25]||(s[25]=B(" Errors "))]),_:1})])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("div",ps,[m(V,{to:`/live/orders-history?id=${e.session}`,color:"gray",variant:"soft",icon:"i-heroicons-list-bullet",class:"flex justify-center"},{default:C(()=>s[26]||(s[26]=[B(" Orders ")])),_:1},8,["to"]),m(V,{to:`/live/trades-history?id=${e.session}`,color:"gray",variant:"soft",icon:"i-heroicons-arrows-right-left",class:"flex justify-center"},{default:C(()=>s[27]||(s[27]=[B(" Trades ")])),_:1},8,["to"])])):h("",!0)])):(a(),v("div",fs,[m(V,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",label:"Start",trailing:!1,onClick:s[17]||(s[17]=L=>Ee((e._.provides[ue]||e.$route).params.id))}),Object.keys(e.tabs).length>1?(a(),$(V,{key:0,class:"w-full md:hidden flex justify-center mt-2",icon:"i-heroicons-x-mark",variant:"soft",color:"gray",label:"Close Tab",trailing:!1,onClick:s[18]||(s[18]=L=>ve((e._.provides[ue]||e.$route).params.id))})):h("",!0)]))]),["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("hr",gs)):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("div",ys,[s[28]||(s[28]=p("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[p("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Session Info")],-1)),p("dl",vs,[(a(!0),v(W,null,re(u(Ce),L=>(a(),v("div",{key:L.label,class:"flex justify-between items-center"},[p("dt",bs,I(L.label)+":",1),p("dd",{class:ke(["text-sm font-semibold truncate ml-4",L.color||"text-gray-900 dark:text-gray-100"])},I(L.value),3)]))),128))])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)&&((g=e.results.watchlist[`${o.form.exchange}-${e.results.selectedRoute.symbol}-${e.results.selectedRoute.timeframe}`])!=null&&g.length)?(a(),v("div",hs,[s[29]||(s[29]=p("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[p("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Watch List")],-1)),p("dl",_s,[(a(!0),v(W,null,re(e.results.watchlist[`${o.form.exchange}-${e.results.selectedRoute.symbol}-${e.results.selectedRoute.timeframe}`],(L,Ie)=>(a(),v("div",{key:Ie,class:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-1"},[p("dt",ks,I(L[0])+":",1),p("dd",xs,I(L[1]),1)]))),128))])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)&&e.results.routes.length?(a(),v("div",ws,[s[30]||(s[30]=p("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[p("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Routes")],-1)),p("div",Ts,[(a(!0),v(W,null,re(e.results.routes,(L,Ie)=>(a(),v("div",{key:Ie,class:"grid grid-cols-3 items-center"},[p("div",Cs,I(L[2].value),1),p("div",$s,I(L[0].value),1),p("div",Es,[m(_e,{color:"gray",variant:"soft",size:"xs"},{default:C(()=>[B(I(L[1].value),1)]),_:2},1024)])]))),128))])])):h("",!0),["running","stopping","ended","error"].includes(e.results.phase)?(a(),v("div",Ss,[p("div",Ls,[p("h3",Rs,I(e.results.generalInfo.title||"Session Notes"),1),m(V,{variant:"link",color:"gray",icon:"i-heroicons-pencil-square",size:"xs",onClick:s[19]||(s[19]=L=>Y.value=!0)})]),p("div",Vs,[e.results.generalInfo.description?(a(),v("div",Is,I(e.results.generalInfo.description),1)):(a(),v("div",Ps," No notes yet. Click the edit button to add notes. "))])])):h("",!0)]}),_:1})),m(et,{modelValue:u(Y),"onUpdate:modelValue":s[20]||(s[20]=g=>G(Y)?Y.value=g:null),"session-id":e.session,"initial-title":u(X),"initial-description":u(Z),onSaved:le},null,8,["modelValue","session-id","initial-title","initial-description"])],64)}}}),Os={class:"w-full"},nr=ne({__name:"[id]",setup(z){ze({title:"Live/Paper trading - Jesse"});const o=de(),w=E(()=>o.tabs),S=ht(),_=E(()=>S.params.id),b=E(()=>w.value[_.value]);Pe(async()=>{if(!b.value){if(o.recentlyClosedTabIds.includes(_.value))return;!await o.ensureTab(_.value)&&Object.keys(w.value).length===0&&await o.addTab()}}),q(_,f=>{if(!f||w.value[f]||!o.recentlyClosedTabIds.includes(f))return;const d=Object.keys(w.value)[0];if(d){_t(`/live/${d}`);return}o.addTab()},{immediate:!0}),kt(()=>{var r,k;const f=b.value;if(!f)return;const d=(r=f.form.routes)==null?void 0:r[0];!f.results.selectedRoute||Object.keys(f.results.selectedRoute).length===0?d&&(f.results.selectedRoute=d):d&&c(f.results.selectedRoute,d)&&(f.results.selectedRoute=d),f.form.exchange===""&&(f.form.exchange=((k=f.results.generalInfo)==null?void 0:k.exchange)||"")});function c(f,d){return!f||!d?!1:f.symbol===d.symbol&&f.timeframe===d.timeframe&&f.strategy===d.strategy}return Mt({w:()=>{const f=S.params.id;f&&o.requestCloseOrStopTab(f)},ArrowLeft:()=>o.goToPrevTab(_.value),ArrowRight:()=>o.goToNextTab(_.value)}),(f,d)=>{const r=tt,k=Us;return a(),v(W,null,[p("div",Os,[m(r,{"current-tab":b.value?b.value.id:null,tabs:w.value,onClose:u(o).closeTab,onCancel:u(o).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),b.value?(a(),$(k,{key:0,form:b.value.form,results:b.value.results,session:_.value,tabs:w.value},null,8,["form","results","session","tabs"])):h("",!0)],64)}}});export{nr as default};
