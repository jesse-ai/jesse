import{_ as me}from"./Cii_wpd3.js";import{d as ve,a6 as fe,a4 as pe,A as _e,c as k,r as u,J as ye,B as he,w as N,a7 as ge,a8 as P,h as S,C as V,j as l,i as t,x as a,E as z,e as be,D as _,F as we,O as xe,f as A,t as ke,k as Se,a9 as Ve,aa as Ce,_ as Te,g as h,ab as Le,I as O,s as B}from"./B4BPTRlB.js";import{_ as Ue}from"./0VzfMacR.js";import{_ as Me}from"./CiusKEQr.js";import{_ as qe}from"./8G6_QxL-.js";import{u as De}from"./C1hERgHN.js";import"./5fD26zkw.js";import"./BBSocZrR.js";import"./C0-a_pR3.js";import"./BPE2cDSt.js";import"./BusspaHq.js";const Ne={class:"w-full"},Pe={class:"container mx-auto px-4 pt-16 pb-6 max-w-7xl"},Re={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},Fe={class:"flex items-center gap-3"},$e={class:"flex flex-col gap-3 sm:flex-row sm:items-center"},je={key:0,class:"space-y-4"},ze={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Ae={class:"divide-y divide-gray-200 dark:divide-gray-700"},Be={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},Oe={class:"col-span-3"},He={class:"col-span-2"},Ee={class:"col-span-1 text-center"},Je={class:"col-span-2 text-center"},Ge={class:"col-span-2"},We={class:"col-span-2 flex justify-end gap-2"},Ke={class:"md:hidden space-y-3"},Qe={class:"flex items-start justify-between"},Xe={class:"flex-1"},Ye={class:"flex items-center justify-between"},Ze={class:"flex items-center justify-between"},Ie={class:"flex gap-1"},es={key:1,class:"space-y-4"},ss={key:0,class:"flex justify-center"},ls={key:2,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center"},ts={class:"p-6"},as={class:"mb-6"},os={class:"flex justify-end gap-3"},R=50,hs=ve({__name:"history",setup(ns){De({title:"Sessions History - Jesse"});const m=fe(),U=pe(),y=_e(),H=k(()=>y.tabs),r=u([]),C=u(!1),T=u(null),M=u(!1),F=u(!1),$=u(!0),d=u(0),q=u(!1),c=u(null),g=u(!1),j=u(!1),b=u(30),w=k({get:()=>m.query.title||"",set:s=>{const e={...m.query};s?e.title=s:delete e.title,U.push({query:e})}}),v=k({get:()=>m.query.status||"all",set:s=>{const e={...m.query};s==="all"?delete e.status:e.status=s,U.push({query:e})}}),f=k({get:()=>m.query.mode||"all",set:s=>{const e={...m.query};s==="all"?delete e.mode:e.mode=s,U.push({query:e})}}),p=k({get:()=>m.query.dateRange||"all_time",set:s=>{const e={...m.query};s==="all_time"?delete e.dateRange:e.dateRange=s,U.push({query:e})}}),E=[{label:"All Statuses",value:"all"},{label:"Running",value:"running"},{label:"Stopped",value:"stopped"},{label:"Terminated",value:"terminated"}],J=[{label:"All Modes",value:"all"},{label:"Live Trading",value:"livetrade"},{label:"Paper Trading",value:"papertrade"}],G=[{label:"All Time",value:"all_time"},{label:"Last 7 Days",value:"7_days"},{label:"Last 30 Days",value:"30_days"},{label:"Last 90 Days",value:"90_days"}],W=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"3 months",value:90},{label:"6 months",value:180},{label:"1 year",value:365},{label:"2 years",value:730},{label:"All existing sessions",value:-1}],K=k(()=>r.value.map(s=>({...s,updated_at:ye.timestampToReadableDateTime(s.updated_at)})));he(()=>{setTimeout(()=>{x()},20)});const Q=ge(()=>{d.value=0,x()},300);N(w,()=>{Q()}),N(v,()=>{d.value=0,x()}),N(f,()=>{d.value=0,x()}),N(p,()=>{d.value=0,x()});async function x(){var s;M.value=!0;try{const i=(await P("/live/sessions",{limit:R,offset:0,title_search:w.value||null,status_filter:v.value==="all"?null:v.value,mode_filter:f.value==="all"?null:f.value,date_filter:p.value==="all_time"?null:p.value},!0)).data.value;r.value=(i==null?void 0:i.sessions)||[],d.value=r.value.length,$.value=((s=i==null?void 0:i.sessions)==null?void 0:s.length)===R}catch(e){S(e)}finally{M.value=!1}}async function X(){F.value=!0;try{const e=(await P("/live/sessions",{limit:R,offset:d.value,title_search:w.value||null,status_filter:v.value==="all"?null:v.value,mode_filter:f.value==="all"?null:f.value,date_filter:p.value==="all_time"?null:p.value},!0)).data.value,i=(e==null?void 0:e.sessions)||[];r.value=[...r.value,...i],d.value+=i.length,$.value=i.length===R}catch(s){S(s)}finally{F.value=!1}}function Y(s){le(s.rawSession)}async function Z(s){if(y.tabs[s]){await O(`/live/${s}`);return}await y.loadSession(s)&&(await y.ensureTab(s),await O(`/live/${s}`))}function I(s){T.value=s,C.value=!0}async function ee(){T.value&&(await se(T.value),r.value=r.value.filter(s=>s.id!==T.value),d.value-=1),C.value=!1,T.value=null}async function se(s){if(y.tabs[s]){B("error","Cannot delete a session that is currently open in a tab. Close the tab first.");return}try{const e=await P(`/live/sessions/${s}/remove`,{},!0);if(e.error.value){S(e.error.value);return}B("success","Session deleted successfully")}catch(e){S(e)}}function le(s){c.value=s,q.value=!0}async function te(){j.value=!0;try{const s=await P("/live/purge-sessions",{days_old:b.value===-1?null:b.value},!0);if(s.error.value){S(s.error.value);return}const e=s.data.value;B("success",`Successfully purged ${e.deleted_count} session(s)`),g.value=!1,d.value=0,await x()}catch(s){S(s)}finally{j.value=!1}}function ae(){g.value=!1,b.value=30}function oe(s){if(c.value){const e=r.value.find(i=>i.id===c.value.id);e&&(e.title=s.title,e.description=s.description,c.value.title=s.title,c.value.description=s.description)}}return(s,e)=>{const i=me,L=ke,ne=Se,D=Ve,o=Ue,ie=Me,ue=Ce,re=qe,de=Le,ce=Te;return h(),V("div",null,[l("div",Ne,[t(i,{"current-tab":null,tabs:a(H),onClose:a(y).closeTab,onCancel:a(y).cancel},null,8,["tabs","onClose","onCancel"])]),l("div",Pe,[l("div",Re,[l("div",Fe,[e[9]||(e[9]=l("h1",{class:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white"}," Sessions History ",-1)),t(L,{icon:"i-heroicons-trash",color:"red",variant:"soft",size:"sm",label:"Purge",onClick:e[0]||(e[0]=n=>g.value=!0)})]),l("div",$e,[t(ne,{modelValue:a(w),"onUpdate:modelValue":e[1]||(e[1]=n=>_(w)?w.value=n:null),placeholder:"Search by title...",icon:"i-heroicons-magnifying-glass",size:"sm",class:"w-full sm:w-64"},null,8,["modelValue"]),t(D,{modelValue:a(v),"onUpdate:modelValue":e[2]||(e[2]=n=>_(v)?v.value=n:null),options:E,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),t(D,{modelValue:a(f),"onUpdate:modelValue":e[3]||(e[3]=n=>_(f)?f.value=n:null),options:J,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),t(D,{modelValue:a(p),"onUpdate:modelValue":e[4]||(e[4]=n=>_(p)?p.value=n:null),options:G,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"])])]),a(M)?(h(),V("div",je,[l("div",ze,[l("div",Ae,[(h(),V(we,null,xe(5,n=>l("div",{key:n,class:"p-4"},[l("div",Be,[l("div",Oe,[t(o,{class:"h-4 w-full mb-2"}),t(o,{class:"h-3 w-2/3"})]),l("div",He,[t(o,{class:"h-4 w-full mb-2"}),t(o,{class:"h-3 w-2/3"})]),l("div",Ee,[t(o,{class:"h-6 w-16 mx-auto"})]),l("div",Je,[t(o,{class:"h-6 w-20 mx-auto"})]),l("div",Ge,[t(o,{class:"h-4 w-full"})]),l("div",We,[t(o,{class:"h-8 w-8"}),t(o,{class:"h-8 w-8"}),t(o,{class:"h-8 w-8"})])]),l("div",Ke,[l("div",Qe,[l("div",Xe,[t(o,{class:"h-4 w-3/4 mb-2"}),t(o,{class:"h-3 w-1/2"})]),t(o,{class:"h-6 w-16 ml-2"})]),l("div",Ye,[t(o,{class:"h-4 w-24"}),t(o,{class:"h-4 w-16"})]),l("div",Ze,[t(o,{class:"h-3 w-32"}),l("div",Ie,[t(o,{class:"h-8 w-8"}),t(o,{class:"h-8 w-8"}),t(o,{class:"h-8 w-8"})])])])])),64))])])])):a(r).length?(h(),V("div",es,[t(ie,{sessions:a(K),"show-history-actions":!0,onNotes:Y,onLoad:Z,onDelete:I},null,8,["sessions"]),a($)?(h(),V("div",ss,[t(L,{label:"Load More",variant:"soft",color:"gray",loading:a(F),onClick:X},null,8,["loading"])])):z("",!0)])):!a(M)&&a(r).length===0?(h(),V("div",ls,e[10]||(e[10]=[l("div",{class:"text-gray-400 dark:text-gray-500"},[l("i",{class:"i-heroicons-clock h-12 w-12 mx-auto mb-4"}),l("p",{class:"text-lg"},"No live trading history found"),l("p",{class:"text-sm mt-2"},"Start a live session or change filters to see items in your history")],-1)]))):z("",!0),t(ue,{modelValue:a(C),"onUpdate:modelValue":e[5]||(e[5]=n=>_(C)?C.value=n:null),title:"Delete Live Session",description:"Are you sure you want to delete this live session? This action cannot be undone.",type:"info"},{default:A(()=>[t(L,{variant:"solid",color:"red",block:"",class:"sm:w-auto",label:"Delete",onClick:ee})]),_:1},8,["modelValue"]),a(c)?(h(),be(re,{key:3,modelValue:a(q),"onUpdate:modelValue":e[6]||(e[6]=n=>_(q)?q.value=n:null),"session-id":a(c).id,"initial-title":a(c).title,"initial-description":a(c).description,onSaved:oe},null,8,["modelValue","session-id","initial-title","initial-description"])):z("",!0),t(ce,{modelValue:a(g),"onUpdate:modelValue":e[8]||(e[8]=n=>_(g)?g.value=n:null)},{default:A(()=>[l("div",ts,[e[13]||(e[13]=l("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Purge Live Sessions ",-1)),l("div",as,[e[11]||(e[11]=l("div",{class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4"},[l("div",{class:"flex items-start gap-3"},[l("i",{class:"i-heroicons-exclamation-triangle text-red-600 dark:text-red-400 text-xl flex-shrink-0 mt-0.5"}),l("div",{class:"text-sm text-red-800 dark:text-red-200"},[l("p",{class:"font-semibold mb-1"}," Warning: This action is permanent! "),l("p",null,"Deleted sessions cannot be recovered. Please select carefully.")])])],-1)),t(de,{label:"Delete sessions older than:",class:"mb-4"},{default:A(()=>[t(D,{modelValue:a(b),"onUpdate:modelValue":e[7]||(e[7]=n=>_(b)?b.value=n:null),options:W,size:"md"},null,8,["modelValue"])]),_:1}),e[12]||(e[12]=l("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," This will permanently delete all live sessions that match your criteria. ",-1))]),l("div",os,[t(L,{color:"gray",variant:"ghost",label:"Cancel",onClick:ae}),t(L,{color:"red",label:"Purge Sessions",loading:a(j),onClick:te},null,8,["loading"])])])]),_:1},8,["modelValue"])])])}}});export{hs as default};
