import{d as J,a4 as G,P as H,r as d,c as k,w as Q,H as K,z as g,j as r,i,G as m,W as _,I as A,J as R,t as X,g as o,f as x,q as B,k as Y,e as c,L as Z,$ as C,a1 as ee,s as y}from"./BZBcjETW.js";import{_ as te}from"./BAhmbuaU.js";import{_ as ne}from"./DMf59DGq.js";import{_ as ae}from"./B-2SFkko.js";import{_ as se}from"./_97VUG9M.js";import{u as oe}from"./D-92rLZE.js";const le={class:"container my-8 pb-24 flex flex-col min-h-screen"},ie={class:"pb-12 flex-grow"},re={class:"flex justify-between items-center mb-4"},ce={class:"flex gap-2"},ue={class:"flex flex-col lg:flex-row gap-4 items-center"},de={class:"flex flex-col sm:flex-row gap-2 sm:gap-0"},me={class:"flex-grow flex justify-center"},pe={class:"flex items-center gap-2 justify-end"},ve=J({__name:"index",setup(ge){oe({title:"Import Candles - Jesse"});const a=G(),S=H(),h=d([]),u=d(""),f=d([]),V=k(()=>S.backtestingExchangeNames),E=k(()=>a.forms.some(e=>!e.executing)),I=k(()=>a.forms.some(e=>e.executing)),b=d(new Set),v=d(new Set);function M(){const e=a.forms[a.forms.length-1];a.forms.push({id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}function T(e){const t=a.forms.indexOf(e);a.forms.splice(t+1,0,{id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}async function j(e){b.value.add(e.id),e.executing&&await w(e.id);const t=a.forms.indexOf(e);a.forms.length>1&&a.forms.splice(t,1),b.value.delete(e.id)}async function U(e){const t=await S.getExchangeSupportedSymbols(e.exchange);f.value=t,t.includes(e.symbol)||(e.symbol=t[0]),z(u.value)}function z(e){if(e.length==0||!f.value.length){h.value=[];return}const t=[];for(const s of f.value){if(t.length>50)break;s.toLowerCase().startsWith(e.toLowerCase())&&t.push(s)}h.value=t}Q(()=>u.value,e=>{z(e)});function $(e){const t=a.forms.find(s=>s.id===e);t&&q(t)&&a.start(e)}function q(e){return e.exchange?e.symbol?e.symbol.includes("-")?e.start_date?!0:(y("error","Start date parameter cannot be empty"),!1):(y("error",'Symbol parameter must contain "-" character!'),!1):(y("error","Symbol parameter cannot be empty"),!1):(y("error","Exchange parameter cannot be empty"),!1)}K(()=>{a.forms[0].exchange||(a.forms[0].exchange=V.value[0]),setTimeout(()=>{U(a.forms[0])},100)});async function w(e){v.value.add(e),await a.cancel(e),v.value.delete(e)}async function L(){const e=a.forms.filter(t=>!t.executing);await Promise.all(e.map(t=>$(t.id)))}async function P(){const e=a.forms.filter(t=>t.executing||t.waiting);await Promise.all(e.map(t=>w(t.id)))}return(e,t)=>{const s=X,F=te,W=Y,D=ne,N=ee,p=ae,O=se;return o(),g("div",le,[r("div",ie,[r("div",re,[i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-plus",size:"lg",variant:"solid",label:"Add",onClick:M}),r("div",ce,[_(a).forms.length>1?(o(),g(A,{key:0},[i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-arrow-down-tray",size:"lg",variant:"outline",label:"Import All",disabled:!E.value,onClick:L},null,8,["disabled"]),i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-x-mark",variant:"outline",size:"lg",color:"rose",label:"Cancel All",disabled:!I.value,onClick:P},null,8,["disabled"])],64)):m("",!0),i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-wrench",size:"lg",variant:"outline",color:"gray",label:"Manage",to:"/candles/manage"})])]),(o(!0),g(A,null,R(_(a).forms,n=>(o(),g("div",{key:n.id,class:"mt-4 border rounded-lg p-4 bg-white dark:border-gray-900 dark:bg-gray-800"},[r("div",ue,[r("div",de,[i(F,{modelValue:n.exchange,"onUpdate:modelValue":l=>n.exchange=l,class:"w-full sm:w-48",ui:{base:"sm:rounded-r-none",input:"rounded-lg sm:rounded-r-none sm:rounded-l-lg"},searchable:"",size:"lg",options:V.value,placeholder:"Select exchange...",onChange:()=>U(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),i(F,{modelValue:n.symbol,"onUpdate:modelValue":l=>n.symbol=l,query:u.value,"onUpdate:query":t[0]||(t[0]=l=>u.value=l),"clear-search-on-close":"",class:"w-full sm:w-64",ui:{base:"sm:rounded-none",input:"rounded-lg sm:rounded-none"},searchable:"",size:"lg",options:h.value,placeholder:"Select symbol...",onChange:t[1]||(t[1]=l=>u.value="")},{empty:x(()=>t[2]||(t[2]=[B("Start typing...")])),_:2},1032,["modelValue","onUpdate:modelValue","query","options"]),i(W,{modelValue:n.start_date,"onUpdate:modelValue":l=>n.start_date=l,type:"date",size:"lg",class:"w-full sm:w-48",ui:{base:"sm:rounded-l-none",input:"rounded-lg sm:rounded-l-none sm:rounded-r-lg"}},null,8,["modelValue","onUpdate:modelValue"])]),r("div",me,[n.executing?(o(),c(D,{key:0,color:"blue",variant:"subtle"},{default:x(()=>[B(Z(_(C).remainingTimeText(n.progressbar.estimated_remaining_seconds)),1)]),_:2},1024)):m("",!0)]),r("div",pe,[n.executing?(o(),c(s,{key:1,size:"sm",variant:"soft",color:"rose",label:"Cancel",icon:"i-heroicons-x-mark",loading:v.value.has(n.id),onClick:l=>w(n.id)},null,8,["loading","onClick"])):(o(),c(s,{key:0,size:"sm",variant:"soft",label:"Import",color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:l=>$(n.id)},null,8,["onClick"])),i(N,{text:"Duplicate"},{default:x(()=>[i(s,{size:"sm",variant:"link",color:"gray",icon:"i-heroicons-document-duplicate",onClick:l=>T(n)},null,8,["onClick"])]),_:2},1024),_(a).forms.length>1?(o(),c(N,{key:2,text:"Delete"},{default:x(()=>[i(s,{size:"sm",variant:"link",color:"rose",icon:"i-heroicons-trash",loading:b.value.has(n.id),onClick:l=>j(n)},null,8,["loading","onClick"])]),_:2},1024)):m("",!0)])]),r("div",null,[n.alert.type==="info"?(o(),c(p,{key:0,class:"mt-4",color:"gray",variant:"soft",icon:"i-heroicons-information-circle",title:n.alert.message},null,8,["title"])):m("",!0),n.waiting?(o(),c(p,{key:1,class:"mt-4",color:"yellow",variant:"soft",icon:"i-heroicons-clock",title:`Queued: Waiting for the current '${n.exchange}' import to finish...`},null,8,["title"])):n.executing?(o(),c(O,{key:2,value:n.progressbar.current,indicator:"",class:"w-full mt-4"},null,8,["value"])):n.exception.error?(o(),c(p,{key:3,class:"mt-4",color:"red",variant:"soft",icon:"i-heroicons-exclamation-triangle",title:n.exception.error},null,8,["title"])):n.alert.type==="success"?(o(),c(p,{key:4,class:"mt-4",color:"green",variant:"soft",icon:"i-heroicons-check-circle",title:n.alert.message},null,8,["title"])):m("",!0)])]))),128)),t[3]||(t[3]=r("div",{class:"h-24 md:h-32"},null,-1))])])}}});export{ve as default};
