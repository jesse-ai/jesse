import{a5 as H,a6 as O,a as X,h as T,a7 as Y,a8 as Z,a9 as ee,j as z,aa as te,ab as ae,o as s,c as _,x as ne,e as A,t as D,ac as oe,J as se,G as le,r as b,k as re,l as ie,b as d,d as i,D as w,F as M,E as f,n as ce,K as j,y as de,w as S,v as c,N as C,S as ue,$ as ge}from"./Dg-Ek6CB.js";import{_ as me}from"./B_UDeon3.js";import{_ as pe}from"./QfQegNp2.js";import{_ as ye}from"./zX0r2qeA.js";import{u as xe}from"./DhTiGYW7.js";const be={base:"inline-flex items-center",rounded:"rounded-md",font:"font-medium",size:{xs:"text-xs px-1.5 py-0.5",sm:"text-xs px-2 py-1",md:"text-sm px-2 py-1",lg:"text-sm px-2.5 py-1.5"},color:{white:{solid:"ring-1 ring-inset ring-gray-300 dark:ring-gray-700 text-gray-900 dark:text-white bg-white dark:bg-gray-900"},gray:{solid:"ring-1 ring-inset ring-gray-300 dark:ring-gray-700 text-gray-700 dark:text-gray-200 bg-gray-50 dark:bg-gray-800"},black:{solid:"text-white dark:text-gray-900 bg-gray-900 dark:bg-white"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{size:"sm",variant:"solid",color:"primary"}},g=H(O.ui.strategy,O.ui.badge,be),fe=T({inheritAttrs:!1,props:{size:{type:String,default:()=>g.default.size,validator(o){return Object.keys(g.size).includes(o)}},color:{type:String,default:()=>g.default.color,validator(o){return[...O.ui.colors,...Object.keys(g.color)].includes(o)}},variant:{type:String,default:()=>g.default.variant,validator(o){return[...Object.keys(g.variant),...Object.values(g.color).flatMap(t=>Object.keys(t))].includes(o)}},label:{type:[String,Number],default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(o){const{ui:t,attrs:x}=Y("badge",Z(o,"ui"),g),{size:m,rounded:u}=ee({ui:t,props:o}),p=z(()=>{var h,v;const y=((v=(h=t.value.color)==null?void 0:h[o.color])==null?void 0:v[o.variant])||t.value.variant[o.variant];return te(ae(t.value.base,t.value.font,u.value,t.value.size[m.value],y==null?void 0:y.replaceAll("{color}",o.color)),o.class)});return{attrs:x,badgeClass:p}}});function _e(o,t,x,m,u,p){return s(),_("span",oe({class:o.badgeClass},o.attrs),[ne(o.$slots,"default",{},()=>[A(D(o.label),1)])],16)}const he=X(fe,[["render",_e]]),ve={class:"container my-8 pb-24 flex flex-col min-h-screen"},ke={class:"pb-12 flex-grow"},we={class:"flex justify-between items-center mb-4"},Se={class:"flex gap-2"},Ce={class:"flex flex-col sm:flex-row gap-4 items-center"},ze={class:"flex flex-col sm:flex-row gap-2 sm:gap-0"},Ve={class:"flex-grow flex justify-center"},Ue={class:"flex items-center gap-2 justify-end"},$e=d("div",{class:"h-24 md:h-32"},null,-1),Be=T({__name:"index",setup(o){xe({title:"Import Candles - Jesse"});const t=se(),x=le(),m=b([]),u=b(""),p=b([]),y=z(()=>x.backtestingExchangeNames),h=z(()=>t.forms.some(e=>!e.executing)),v=z(()=>t.forms.some(e=>e.executing)),V=b(new Set),U=b(new Set);function P(){const e=t.forms[t.forms.length-1];t.forms.push({id:j.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}function q(e){const a=t.forms.indexOf(e);t.forms.splice(a+1,0,{id:j.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}async function J(e){V.value.add(e.id),e.executing&&await $(e.id);const a=t.forms.indexOf(e);t.forms.length>1&&t.forms.splice(a,1),V.value.delete(e.id)}async function F(e){const a=await x.getExchangeSupportedSymbols(e.exchange);p.value=a,a.includes(e.symbol)||(e.symbol=a[0]),N(u.value)}function N(e){if(e.length==0||!p.value.length){m.value=[];return}const a=[];for(const l of p.value){if(a.length>50)break;l.toLowerCase().startsWith(e.toLowerCase())&&a.push(l)}m.value=a}re(()=>u.value,e=>{N(e)});function B(e){const a=t.forms.find(l=>l.id===e);a&&L(a)&&t.start(e)}function L(e){return e.exchange?e.symbol?e.symbol.includes("-")?e.start_date?!0:(C("error","Start date parameter cannot be empty"),!1):(C("error",'Symbol parameter must contain "-" character!'),!1):(C("error","Symbol parameter cannot be empty"),!1):(C("error","Exchange parameter cannot be empty"),!1)}ie(()=>{t.forms[0].exchange||(t.forms[0].exchange=y.value[0]),setTimeout(()=>{F(t.forms[0])},100)});async function $(e){U.value.add(e),await t.cancel(e),U.value.delete(e)}async function W(){const e=t.forms.filter(a=>!a.executing);await Promise.all(e.map(a=>B(a.id)))}async function G(){const e=t.forms.filter(a=>a.executing||a.waiting);await Promise.all(e.map(a=>$(a.id)))}return(e,a)=>{const l=de,E=me,K=ue,Q=he,I=ge,k=pe,R=ye;return s(),_("div",ve,[d("div",ke,[d("div",we,[i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-plus",size:"lg",variant:"solid",label:"Add",onClick:P}),d("div",Se,[w(t).forms.length>1?(s(),_(M,{key:0},[i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-arrow-down-tray",size:"lg",variant:"outline",label:"Import All",disabled:!h.value,onClick:W},null,8,["disabled"]),i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-x-mark",variant:"outline",size:"lg",color:"rose",label:"Cancel All",disabled:!v.value,onClick:G},null,8,["disabled"])],64)):f("",!0),i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-wrench",size:"lg",variant:"outline",color:"gray",label:"Manage",to:"/candles/manage"})])]),(s(!0),_(M,null,ce(w(t).forms,n=>(s(),_("div",{key:n.id,class:"mt-4 border rounded-lg p-4 bg-white dark:border-gray-900 dark:bg-gray-800"},[d("div",Ce,[d("div",ze,[i(E,{modelValue:n.exchange,"onUpdate:modelValue":r=>n.exchange=r,class:"w-full sm:w-48",ui:{base:"sm:rounded-r-none",input:"rounded-lg sm:rounded-r-none sm:rounded-l-lg"},searchable:"",size:"lg",options:y.value,placeholder:"Select exchange...",onChange:()=>F(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),i(E,{modelValue:n.symbol,"onUpdate:modelValue":r=>n.symbol=r,query:u.value,"onUpdate:query":a[0]||(a[0]=r=>u.value=r),"clear-search-on-close":"",class:"w-full sm:w-64",ui:{base:"sm:rounded-none",input:"rounded-lg sm:rounded-none"},searchable:"",size:"lg",options:m.value,placeholder:"Select symbol...",onChange:a[1]||(a[1]=r=>u.value="")},{empty:S(()=>[A("Start typing...")]),_:2},1032,["modelValue","onUpdate:modelValue","query","options"]),i(K,{modelValue:n.start_date,"onUpdate:modelValue":r=>n.start_date=r,type:"date",size:"lg",class:"w-full sm:w-48",ui:{base:"sm:rounded-l-none",input:"rounded-lg sm:rounded-l-none sm:rounded-r-lg"}},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Ve,[n.executing?(s(),c(Q,{key:0,color:"blue",variant:"subtle"},{default:S(()=>[A(D(w(j).remainingTimeText(n.progressbar.estimated_remaining_seconds)),1)]),_:2},1024)):f("",!0)]),d("div",Ue,[n.executing?(s(),c(l,{key:1,size:"sm",variant:"soft",color:"rose",label:"Cancel",icon:"i-heroicons-x-mark",loading:U.value.has(n.id),onClick:r=>$(n.id)},null,8,["loading","onClick"])):(s(),c(l,{key:0,size:"sm",variant:"soft",label:"Import",color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:r=>B(n.id)},null,8,["onClick"])),i(I,{text:"Duplicate"},{default:S(()=>[i(l,{size:"sm",variant:"link",color:"gray",icon:"i-heroicons-document-duplicate",onClick:r=>q(n)},null,8,["onClick"])]),_:2},1024),w(t).forms.length>1?(s(),c(I,{key:2,text:"Delete"},{default:S(()=>[i(l,{size:"sm",variant:"link",color:"rose",icon:"i-heroicons-trash",loading:V.value.has(n.id),onClick:r=>J(n)},null,8,["loading","onClick"])]),_:2},1024)):f("",!0)])]),d("div",null,[n.alert.type==="info"?(s(),c(k,{key:0,class:"mt-4",color:"gray",variant:"soft",icon:"i-heroicons-information-circle",title:n.alert.message},null,8,["title"])):f("",!0),n.waiting?(s(),c(k,{key:1,class:"mt-4",color:"yellow",variant:"soft",icon:"i-heroicons-clock",title:`Queued: Waiting for the current '${n.exchange}' import to finish...`},null,8,["title"])):n.executing?(s(),c(R,{key:2,value:n.progressbar.current,indicator:"",class:"w-full mt-4"},null,8,["value"])):n.exception.error?(s(),c(k,{key:3,class:"mt-4",color:"red",variant:"soft",icon:"i-heroicons-exclamation-triangle",title:n.exception.error},null,8,["title"])):n.alert.type==="success"?(s(),c(k,{key:4,class:"mt-4",color:"green",variant:"soft",icon:"i-heroicons-check-circle",title:n.alert.message},null,8,["title"])):f("",!0)])]))),128)),$e])])}}});export{Be as default};
