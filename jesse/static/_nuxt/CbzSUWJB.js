import{_ as ue}from"./DovzfPz3.js";import{d as G,r as m,c as z,J as me,C,i as s,f as p,x as o,D as V,g as x,j as t,v as _e,t as I,G as N,H as pe,a6 as fe,a4 as ve,b as ge,B as ye,w as L,a7 as he,a8 as q,h as T,E as H,e as xe,F as be,O as ke,k as we,a9 as Se,aa as $e,_ as Ce,ab as Ve,s as O}from"./CCP630y_.js";import{_ as Ue}from"./CpK6rpRM.js";import{_ as Be}from"./vlmPAk7D.js";import{_ as De}from"./DDQFqpHC.js";import{_ as Ne}from"./Dhd8fpMD.js";import{u as Te}from"./Dmfbhh7F.js";import"./DIRnqvt5.js";import"./DnshXE1x.js";import"./Cl-5yHJR.js";const Me={class:"bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-sm"},je={class:"flex flex-col"},ze={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Re={class:"text-xs text-gray-500 dark:text-gray-400"},qe={class:"flex flex-col"},Fe={class:"text-sm text-gray-700 dark:text-gray-300"},Pe={class:"text-xs text-gray-500 dark:text-gray-400"},Ae={class:"flex justify-center"},Le={key:1,class:"text-sm text-gray-400"},He={class:"flex justify-center"},Oe={class:"text-sm text-gray-500 dark:text-gray-400"},Ee={class:"flex items-center justify-end gap-1"},Ge=G({__name:"BacktestSessionsTable",props:{sessions:{}},emits:["notes","load","delete"],setup(E){const b=E,U=m({column:"updated_at",direction:"desc"}),B=[{key:"strategy",label:"Strategy"},{key:"session",label:"Session"},{key:"net_profit",label:"Net Profit %",sortable:!0,class:"text-center"},{key:"status",label:"Status",class:"text-center"},{key:"updated_at",label:"Date",sortable:!0},{key:"actions",label:"",class:"w-32 text-right"}],P=z(()=>b.sessions.map(n=>{var f,k,y,h,u,l,c,w,D,S,$,v,g,R;return{id:n.id,title:n.title,strategy:(h=(y=(k=(f=n.state)==null?void 0:f.form)==null?void 0:k.routes)==null?void 0:y[0])==null?void 0:h.strategy,exchange:(l=(u=n.state)==null?void 0:u.form)==null?void 0:l.exchange,symbol:(S=(D=(w=(c=n.state)==null?void 0:c.form)==null?void 0:w.routes)==null?void 0:D[0])==null?void 0:S.symbol,timeframe:(R=(g=(v=($=n.state)==null?void 0:$.form)==null?void 0:v.routes)==null?void 0:g[0])==null?void 0:R.timeframe,net_profit_percentage:n.net_profit_percentage,status:n.status,updated_at:me.timestampToReadableDateTime(n.updated_at),rawSession:n}}));function _(n){switch(n==null?void 0:n.toLowerCase()){case"running":return"blue";case"finished":return"green";case"stopped":return"red";case"cancelled":return"gray";default:return"gray"}}return(n,f)=>{const k=Be,y=I,h=_e,u=De;return x(),C("div",Me,[s(u,{sort:o(U),"onUpdate:sort":f[0]||(f[0]=l=>V(U)?U.value=l:null),rows:o(P),columns:B,class:"w-full",ui:{td:{base:"whitespace-nowrap"},th:{base:"whitespace-nowrap"}}},{"strategy-data":p(({row:l})=>[t("div",je,[t("span",ze,N(l.title||l.strategy||"Unknown Strategy"),1),t("span",Re,N(l.exchange||"Unknown Exchange"),1)])]),"session-data":p(({row:l})=>[t("div",qe,[t("span",Fe,N(l.symbol||"N/A"),1),t("span",Pe,N(l.timeframe||"N/A"),1)])]),"net_profit-data":p(({row:l})=>[t("div",Ae,[l.net_profit_percentage!==null&&l.net_profit_percentage!==void 0?(x(),C("span",{key:0,class:pe([l.net_profit_percentage>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400","text-sm font-semibold"])},N(l.net_profit_percentage.toFixed(2))+"% ",3)):(x(),C("span",Le,"N/A"))])]),"status-data":p(({row:l})=>[t("div",He,[s(k,{color:_(l.status),label:l.status,variant:"soft",size:"xs"},null,8,["color","label"])])]),"updated_at-data":p(({row:l})=>[t("span",Oe,N(l.updated_at),1)]),"actions-data":p(({row:l})=>[t("div",Ee,[s(h,{text:"Add Note"},{default:p(()=>[s(y,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-pencil-square",onClick:c=>n.$emit("notes",l.rawSession)},null,8,["onClick"])]),_:2},1024),s(h,{text:"Load Session"},{default:p(()=>[s(y,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-arrow-right",onClick:c=>n.$emit("load",l.id)},null,8,["onClick"])]),_:2},1024),s(h,{text:"Delete"},{default:p(()=>[s(y,{size:"xs",variant:"ghost",color:"red",icon:"i-heroicons-trash",onClick:c=>n.$emit("delete",l.id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["sort","rows"])])}}}),Ie={class:"w-full"},Je={class:"container mx-auto px-4 pt-16 pb-6 max-w-7xl"},We={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},Ke={class:"flex items-center gap-3"},Qe={class:"flex flex-col gap-3 sm:flex-row sm:items-center"},Xe={key:0,class:"space-y-4"},Ye={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Ze={class:"divide-y divide-gray-200 dark:divide-gray-700"},et={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},tt={class:"col-span-3"},st={class:"col-span-2"},at={class:"col-span-2 text-center"},lt={class:"col-span-2 text-center"},ot={class:"col-span-2"},nt={class:"col-span-1 flex justify-end gap-2"},it={class:"md:hidden space-y-3"},rt={class:"flex items-start justify-between"},ct={class:"flex-1"},dt={class:"flex items-center justify-between"},ut={class:"flex items-center justify-between"},mt={class:"flex gap-1"},_t={key:1,class:"space-y-4"},pt={key:0,class:"flex justify-center"},ft={key:2,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center"},vt={class:"p-6"},gt={class:"mb-6"},yt={class:"flex justify-end gap-3"},F=50,Bt=G({__name:"history",setup(E){Te({title:"Backtest History - Jesse"});const b=fe(),U=ve(),B=ge(),P=z(()=>B.tabs),_=m([]),n=m(!1),f=m(null),k=m(!1),y=m(!1),h=m(!0),u=m(0),l=m(!1),c=m(null),w=m(!1),D=m(!1),S=m(30),$=z({get:()=>b.query.title||"",set:a=>{const e={...b.query};a?e.title=a:delete e.title,U.push({query:e})}}),v=z({get:()=>b.query.status||"all",set:a=>{const e={...b.query};a==="all"?delete e.status:e.status=a,U.push({query:e})}}),g=z({get:()=>b.query.dateRange||"all_time",set:a=>{const e={...b.query};a==="all_time"?delete e.dateRange:e.dateRange=a,U.push({query:e})}}),R=[{label:"All Statuses",value:"all"},{label:"Running",value:"running"},{label:"Finished",value:"finished"},{label:"Stopped",value:"stopped"},{label:"Cancelled",value:"cancelled"}],J=[{label:"All Time",value:"all_time"},{label:"Last 7 Days",value:"7_days"},{label:"Last 30 Days",value:"30_days"},{label:"Last 90 Days",value:"90_days"}],W=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"3 months",value:90},{label:"6 months",value:180},{label:"1 year",value:365},{label:"2 years",value:730},{label:"All existing sessions",value:-1}];ye(()=>{setTimeout(()=>{M()},20)});const K=he(()=>{u.value=0,M()},300);L($,()=>{K()}),L(v,()=>{u.value=0,M()}),L(g,()=>{u.value=0,M()});async function M(){var a;k.value=!0;try{const d=(await q("/backtest/sessions",{limit:F,offset:0,title_search:$.value||null,status_filter:v.value==="all"?null:v.value,date_filter:g.value==="all_time"?null:g.value},!0)).data.value;_.value=(d==null?void 0:d.sessions)||[],u.value=_.value.length,h.value=((a=d==null?void 0:d.sessions)==null?void 0:a.length)===F}catch(e){T(e)}finally{k.value=!1}}async function Q(){y.value=!0;try{const e=(await q("/backtest/sessions",{limit:F,offset:u.value,title_search:$.value||null,status_filter:v.value==="all"?null:v.value,date_filter:g.value==="all_time"?null:g.value},!0)).data.value,d=(e==null?void 0:e.sessions)||[];_.value=[..._.value,...d],u.value+=d.length,h.value=d.length===F}catch(a){T(a)}finally{y.value=!1}}async function X(a){await B.loadSession(a)}function Y(a){f.value=a,n.value=!0}async function Z(){f.value&&(await ee(f.value),_.value=_.value.filter(a=>a.id!==f.value),u.value-=1),n.value=!1,f.value=null}async function ee(a){if(B.tabs[a]){O("error","Cannot delete a session that is currently open in a tab. Close the tab first.");return}try{const e=await q(`/backtest/sessions/${a}/remove`,{},!0);if(e.error.value){T(e.error.value);return}O("success","Session deleted successfully")}catch(e){T(e)}}function te(a){c.value=a,l.value=!0}async function se(){D.value=!0;try{const a=await q("/backtest/purge-sessions",{days_old:S.value===-1?null:S.value},!0);if(a.error.value){T(a.error.value);return}const e=a.data.value;O("success",`Successfully purged ${e.deleted_count} session(s)`),w.value=!1,u.value=0,await M()}catch(a){T(a)}finally{D.value=!1}}function ae(){w.value=!1,S.value=30}function le(a){if(c.value){const e=_.value.find(d=>d.id===c.value.id);e&&(e.title=a.title,e.description=a.description,c.value.title=a.title,c.value.description=a.description)}}return(a,e)=>{const d=ue,j=I,oe=we,A=Se,i=Ue,ne=Ge,ie=$e,re=Ne,ce=Ve,de=Ce;return x(),C("div",null,[t("div",Ie,[s(d,{"current-tab":null,tabs:o(P),onClose:e[0]||(e[0]=r=>o(B).closeTab(r,o(b).path)),onCancel:o(B).cancel},null,8,["tabs","onCancel"])]),t("div",Je,[t("div",We,[t("div",Ke,[e[9]||(e[9]=t("h1",{class:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white"}," Backtest History ",-1)),s(j,{icon:"i-heroicons-trash",color:"red",variant:"soft",size:"sm",label:"Purge",onClick:e[1]||(e[1]=r=>w.value=!0)})]),t("div",Qe,[s(oe,{modelValue:o($),"onUpdate:modelValue":e[2]||(e[2]=r=>V($)?$.value=r:null),placeholder:"Search by title...",icon:"i-heroicons-magnifying-glass",size:"sm",class:"w-full sm:w-64"},null,8,["modelValue"]),s(A,{modelValue:o(v),"onUpdate:modelValue":e[3]||(e[3]=r=>V(v)?v.value=r:null),options:R,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),s(A,{modelValue:o(g),"onUpdate:modelValue":e[4]||(e[4]=r=>V(g)?g.value=r:null),options:J,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"])])]),o(k)?(x(),C("div",Xe,[t("div",Ye,[t("div",Ze,[(x(),C(be,null,ke(5,r=>t("div",{key:r,class:"p-4"},[t("div",et,[t("div",tt,[s(i,{class:"h-4 w-full mb-2"}),s(i,{class:"h-3 w-2/3"})]),t("div",st,[s(i,{class:"h-4 w-full mb-2"}),s(i,{class:"h-3 w-2/3"})]),t("div",at,[s(i,{class:"h-4 w-16 mx-auto"})]),t("div",lt,[s(i,{class:"h-6 w-20 mx-auto"})]),t("div",ot,[s(i,{class:"h-4 w-full"})]),t("div",nt,[s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"})])]),t("div",it,[t("div",rt,[t("div",ct,[s(i,{class:"h-4 w-3/4 mb-2"}),s(i,{class:"h-3 w-1/2"})]),s(i,{class:"h-6 w-16 ml-2"})]),t("div",dt,[s(i,{class:"h-4 w-24"}),s(i,{class:"h-4 w-16"})]),t("div",ut,[s(i,{class:"h-3 w-32"}),t("div",mt,[s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"})])])])])),64))])])])):o(_).length?(x(),C("div",_t,[s(ne,{sessions:o(_),onNotes:te,onLoad:X,onDelete:Y},null,8,["sessions"]),o(h)?(x(),C("div",pt,[s(j,{label:"Load More",variant:"soft",color:"gray",loading:o(y),onClick:Q},null,8,["loading"])])):H("",!0)])):!o(k)&&o(_).length===0?(x(),C("div",ft,e[10]||(e[10]=[t("div",{class:"text-gray-400 dark:text-gray-500"},[t("i",{class:"i-heroicons-clock h-12 w-12 mx-auto mb-4"}),t("p",{class:"text-lg"},"No backtest history found"),t("p",{class:"text-sm mt-2"},"Run a backtest or change filters to see items in backtest your history")],-1)]))):H("",!0),s(ie,{modelValue:o(n),"onUpdate:modelValue":e[5]||(e[5]=r=>V(n)?n.value=r:null),title:"Delete Backtest Session",description:"Are you sure you want to delete this backtest session? This action cannot be undone.",type:"info"},{default:p(()=>[s(j,{variant:"solid",color:"red",block:"",class:"sm:w-auto",label:"Delete",onClick:Z})]),_:1},8,["modelValue"]),o(c)?(x(),xe(re,{key:3,modelValue:o(l),"onUpdate:modelValue":e[6]||(e[6]=r=>V(l)?l.value=r:null),"session-id":o(c).id,"initial-title":o(c).title,"initial-description":o(c).description,onSaved:le},null,8,["modelValue","session-id","initial-title","initial-description"])):H("",!0),s(de,{modelValue:o(w),"onUpdate:modelValue":e[8]||(e[8]=r=>V(w)?w.value=r:null)},{default:p(()=>[t("div",vt,[e[13]||(e[13]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Purge Backtest Sessions ",-1)),t("div",gt,[e[11]||(e[11]=t("div",{class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4"},[t("div",{class:"flex items-start gap-3"},[t("i",{class:"i-heroicons-exclamation-triangle text-red-600 dark:text-red-400 text-xl flex-shrink-0 mt-0.5"}),t("div",{class:"text-sm text-red-800 dark:text-red-200"},[t("p",{class:"font-semibold mb-1"}," Warning: This action is permanent! "),t("p",null,"Deleted sessions cannot be recovered. Please select carefully.")])])],-1)),s(ce,{label:"Delete sessions older than:",class:"mb-4"},{default:p(()=>[s(A,{modelValue:o(S),"onUpdate:modelValue":e[7]||(e[7]=r=>V(S)?S.value=r:null),options:W,size:"md"},null,8,["modelValue"])]),_:1}),e[12]||(e[12]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," This will permanently delete all backtest sessions that match your criteria. ",-1))]),t("div",yt,[s(j,{color:"gray",variant:"ghost",label:"Cancel",onClick:ae}),s(j,{color:"red",label:"Purge Sessions",loading:o(D),onClick:se},null,8,["loading"])])])]),_:1},8,["modelValue"])])])}}});export{Bt as default};
