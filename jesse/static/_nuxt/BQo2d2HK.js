import{d as J,a5 as G,a0 as Q,r as d,c as w,w as H,B as K,C as g,j as r,i,E as m,x as _,F as N,O as R,t as X,g as s,f as x,q as A,k as Y,e as c,G as Z,J as C,v as ee,s as y}from"./CtRP3raE.js";import{_ as te}from"./BsTwEtox.js";import{_ as ne}from"./8f4YHL2u.js";import{_ as ae}from"./hZKWDH-o.js";import{_ as oe}from"./BtsPTqgu.js";import{u as se}from"./B71Uh9Gv.js";const le={class:"container mx-auto px-4 pt-16 pb-6 max-w-7xl"},ie={class:"pb-12"},re={class:"flex justify-between items-center mb-4"},ce={class:"flex gap-2"},ue={class:"flex flex-col lg:flex-row gap-4 items-center"},de={class:"flex flex-col sm:flex-row gap-2 sm:gap-0"},me={class:"flex-grow flex justify-center"},pe={class:"flex items-center gap-2 justify-end"},ve=J({__name:"index",setup(ge){se({title:"Import Candles - Jesse"});const a=G(),S=Q(),f=d([]),u=d(""),h=d([]),V=w(()=>S.backtestingExchangeNames),I=w(()=>a.forms.some(e=>!e.executing)),M=w(()=>a.forms.some(e=>e.executing)),b=d(new Set),v=d(new Set);function T(){const e=a.forms[a.forms.length-1];a.forms.push({id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}function j(e){const t=a.forms.indexOf(e);a.forms.splice(t+1,0,{id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}async function q(e){b.value.add(e.id),e.executing&&await k(e.id);const t=a.forms.indexOf(e);a.forms.length>1&&a.forms.splice(t,1),b.value.delete(e.id)}async function U(e){const t=await S.getExchangeSupportedSymbols(e.exchange);h.value=t,t.includes(e.symbol)||(e.symbol=t[0]),F(u.value)}function F(e){if(e.length==0||!h.value.length){f.value=[];return}const t=[];for(const o of h.value){if(t.length>50)break;o.toLowerCase().startsWith(e.toLowerCase())&&t.push(o)}f.value=t}H(()=>u.value,e=>{F(e)});function $(e){const t=a.forms.find(o=>o.id===e);t&&z(t)&&a.start(e)}function z(e){return e.exchange?e.symbol?e.symbol.includes("-")?e.start_date?!0:(y("error","Start date parameter cannot be empty"),!1):(y("error",'Symbol parameter must contain "-" character!'),!1):(y("error","Symbol parameter cannot be empty"),!1):(y("error","Exchange parameter cannot be empty"),!1)}K(()=>{a.forms[0].exchange||(a.forms[0].exchange=V.value[0]),setTimeout(()=>{U(a.forms[0])},100)});async function k(e){v.value.add(e),await a.cancel(e),v.value.delete(e)}async function O(){const e=a.forms.filter(t=>!t.executing);await Promise.all(e.map(t=>$(t.id)))}async function D(){const e=a.forms.filter(t=>t.executing||t.waiting);await Promise.all(e.map(t=>k(t.id)))}return(e,t)=>{const o=X,B=te,L=Y,P=ne,E=ee,p=ae,W=oe;return s(),g("div",le,[r("div",ie,[r("div",re,[i(o,{icon:"i-heroicons-plus",variant:"solid",label:"Add",onClick:T}),r("div",ce,[_(a).forms.length>1?(s(),g(N,{key:0},[i(o,{icon:"i-heroicons-arrow-down-tray",variant:"soft",label:"Import All",disabled:!I.value,onClick:O},null,8,["disabled"]),i(o,{icon:"i-heroicons-x-mark",variant:"soft",color:"rose",label:"Cancel All",disabled:!M.value,onClick:D},null,8,["disabled"])],64)):m("",!0),i(o,{icon:"i-heroicons-wrench",variant:"soft",color:"gray",label:"Manage",to:"/candles/manage"})])]),(s(!0),g(N,null,R(_(a).forms,n=>(s(),g("div",{key:n.id,class:"mt-4 border rounded-lg p-4 bg-white dark:border-gray-900 dark:bg-gray-800"},[r("div",ue,[r("div",de,[i(B,{modelValue:n.exchange,"onUpdate:modelValue":l=>n.exchange=l,class:"w-full sm:w-48",ui:{base:"sm:rounded-r-none",input:"rounded-lg sm:rounded-r-none sm:rounded-l-lg"},searchable:"",options:V.value,placeholder:"Select exchange...",onChange:()=>U(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),i(B,{modelValue:n.symbol,"onUpdate:modelValue":l=>n.symbol=l,query:u.value,"onUpdate:query":t[0]||(t[0]=l=>u.value=l),"clear-search-on-close":"",class:"w-full sm:w-64",ui:{base:"sm:rounded-none",input:"rounded-lg sm:rounded-none"},searchable:"",options:f.value,placeholder:"Select symbol...",onChange:t[1]||(t[1]=l=>u.value="")},{empty:x(()=>t[2]||(t[2]=[A("Start typing...")])),_:2},1032,["modelValue","onUpdate:modelValue","query","options"]),i(L,{modelValue:n.start_date,"onUpdate:modelValue":l=>n.start_date=l,type:"date",class:"w-full sm:w-48",ui:{base:"sm:rounded-l-none",input:"rounded-lg sm:rounded-l-none sm:rounded-r-lg"}},null,8,["modelValue","onUpdate:modelValue"])]),r("div",me,[n.executing?(s(),c(P,{key:0,color:"blue",variant:"subtle"},{default:x(()=>[A(Z(_(C).remainingTimeText(n.progressbar.estimated_remaining_seconds)),1)]),_:2},1024)):m("",!0)]),r("div",pe,[n.executing?(s(),c(o,{key:1,size:"sm",variant:"soft",color:"rose",label:"Cancel",icon:"i-heroicons-x-mark",loading:v.value.has(n.id),onClick:l=>k(n.id)},null,8,["loading","onClick"])):(s(),c(o,{key:0,size:"sm",variant:"soft",label:"Import",color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:l=>$(n.id)},null,8,["onClick"])),i(E,{text:"Duplicate"},{default:x(()=>[i(o,{size:"sm",variant:"link",color:"gray",icon:"i-heroicons-document-duplicate",onClick:l=>j(n)},null,8,["onClick"])]),_:2},1024),_(a).forms.length>1?(s(),c(E,{key:2,text:"Delete"},{default:x(()=>[i(o,{size:"sm",variant:"link",color:"rose",icon:"i-heroicons-trash",loading:b.value.has(n.id),onClick:l=>q(n)},null,8,["loading","onClick"])]),_:2},1024)):m("",!0)])]),r("div",null,[n.alert.type==="info"?(s(),c(p,{key:0,class:"mt-4",color:"gray",variant:"soft",icon:"i-heroicons-information-circle",title:n.alert.message},null,8,["title"])):m("",!0),n.waiting?(s(),c(p,{key:1,class:"mt-4",color:"yellow",variant:"soft",icon:"i-heroicons-clock",title:`Queued: Waiting for the current '${n.exchange}' import to finish...`},null,8,["title"])):n.executing?(s(),c(W,{key:2,value:n.progressbar.current,indicator:"",class:"w-full mt-4"},null,8,["value"])):n.exception.error?(s(),c(p,{key:3,class:"mt-4",color:"red",variant:"soft",icon:"i-heroicons-exclamation-triangle",title:n.exception.error},null,8,["title"])):n.alert.type==="success"?(s(),c(p,{key:4,class:"mt-4",color:"green",variant:"soft",icon:"i-heroicons-check-circle",title:n.alert.message},null,8,["title"])):m("",!0)])]))),128)),t[3]||(t[3]=r("div",{class:"h-24 md:h-32"},null,-1))])])}}});export{ve as default};
