import{_ as nt}from"./DovzfPz3.js";import{_ as it}from"./ExDL9tKA.js";import{d as re,r as w,c as M,w as W,n as qe,bi as dt,C as d,g as a,e as F,E as k,i as l,H as Z,j as t,G as y,F as A,O as se,t as Ve,u as Se,f as L,z as He,R as Pe,v as We,x as r,y as ut,_ as Ue,m as $e,a as Je,q as pe,l as ct,p as ft,s as Q,h as mt,I as Ce,J as te,K as fe,aq as ze,bs as gt,aO as Ge,D as ie,a6 as Ye,bt as ee,B as Me,o as pt,a0 as Ee,bu as vt,b as Qe,a5 as yt,a7 as bt,aM as ht,bv as wt,L as kt,bn as me,N as xt,k as _t,aN as $t,M as Ct,bq as Vt,aH as St,ag as Tt}from"./CCP630y_.js";import{_ as jt}from"./BdYXMUsO.js";import{r as Lt,_ as Rt}from"./Cu2RuALj.js";import{_ as Et}from"./TJg2Rzel.js";import{_ as Ut}from"./BObakFqi.js";import{_ as Mt}from"./C1YxTtKs.js";import{_ as Ot}from"./DB-7Vy6V.js";import{_ as It}from"./CpK6rpRM.js";import{_ as Bt}from"./vlmPAk7D.js";import{a as Nt}from"./DBMazrd-.js";import{_ as Pt}from"./Dhd8fpMD.js";import{_ as zt}from"./Cl-5yHJR.js";import{T as De}from"./9VOnL4Iz.js";import{s as _e,l as Fe,d as Ae}from"./BS9OwPT8.js";import{u as Ze}from"./Dmfbhh7F.js";import{u as Dt}from"./ByTHOC9c.js";import"./DIRnqvt5.js";const Ft={class:"w-full h-full flex flex-col"},At={key:0,class:"flex justify-center items-center py-8"},qt={class:"w-full relative"},Ht={key:0,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},Wt={key:3,class:"mt-4 flex justify-center"},ge=1e3,Jt=re({__name:"Logs",props:{logs:{},sections:{},totalLogs:{}},setup(B){const n=B,_=w(""),p=w(!1),g=w(!1),u=w([]),f=w(null),s=w(1),c=w(!1),$=w(ge),E=M(()=>c.value?u.value:u.value.slice(0,$.value));W(()=>n.logs,async m=>{m&&(p.value=!0,await qe(),setTimeout(()=>{u.value=m.slice(0,ge),s.value=1,c.value=m.length<=ge,p.value=!1},0),setTimeout(()=>{_.value=n.logs.join(`
`)},0))},{immediate:!0}),W(s,()=>{$.value=s.value*ge});function b(m){const v=m.target;v.scrollHeight-v.scrollTop<=v.clientHeight+50&&C()}async function C(){g.value||c.value||(g.value=!0,setTimeout(()=>{const m=s.value*ge,v=(s.value+1)*ge;if(m<n.logs.length){const T=n.logs.slice(m,v);u.value=[...u.value,...T],s.value++,c.value=v>=n.logs.length}else c.value=!0;g.value=!1},0))}return(m,v)=>{const T=dt("ULoading"),J=it,q=Ve;return a(),d("div",Ft,[p.value?(a(),d("div",At,[l(T,{size:"lg"})])):u.value.length?(a(),d("div",{key:2,ref_key:"logContainer",ref:f,class:Z([c.value?"h-[calc(100vh-120px)]":"h-[calc(100vh-180px)]","w-full overflow-y-scroll rounded border dark:border-gray-600 bg-gray-50 dark:bg-gray-700 px-4 sm:px-6 py-2"]),onScroll:b},[t("div",qt,[c.value?(a(),d("pre",Ht,"          "+y(_.value)+`
        `,1)):(a(!0),d(A,{key:1},se(E.value,(N,R)=>(a(),d("pre",{key:0+R,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},y(N),1))),128))])],34)):(a(),F(J,{key:1})),u.value.length&&!c.value?(a(),d("div",Wt,[l(q,{loading:g.value,class:"w-full flex justify-center",label:`(loaded ${u.value.length} / ${n.logs.length}) Load All Logs`,onClick:v[0]||(v[0]=N=>c.value=!0)},null,8,["loading","label"])])):k("",!0)])}}}),Gt={class:"flex items-center justify-between"},Yt=re({__name:"FullscreenModal",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(B){const n=Se(B,"modelValue");return(_,p)=>{const g=We,u=He,f=Ue;return a(),F(f,{modelValue:n.value,"onUpdate:modelValue":p[1]||(p[1]=s=>n.value=s),fullscreen:""},{default:L(()=>[l(u,{ui:{base:"h-full flex flex-col",rounded:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",body:{base:"grow"}}},{header:L(()=>[t("div",Gt,[t("div",null,[Pe(_.$slots,"title")]),l(g,{text:"Close",popper:{arrow:!0,offsetDistance:10}},{default:L(()=>[t("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none transition-all duration-300",onClick:p[0]||(p[0]=s=>n.value=!1)},[l(r(ut),{class:"h-6 w-6","aria-hidden":"true"})])]),_:1})])]),default:L(()=>[Pe(_.$slots,"default")]),_:3})]),_:3},8,["modelValue"])}}}),Qt=ft(zt),Zt={class:"flex items-center justify-between"},Xt={class:"flex flex-col space-y-4"},Kt={key:0,class:"flex flex-wrap gap-2"},es={class:"flex flex-col"},ts={class:"flex items-center justify-between mb-2"},ss={class:"flex gap-2"},os=re({__name:"BacktestStrategyCodeModal",props:$e({routes:{},exchange:{},strategyCodes:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const n=B,_=Se(B,"modelValue"),p=w(""),g=w(null),u=w(""),f=w(),s=Je(),c=M(()=>s.value==="light"?"vs-light":"vs-dark"),$=M(()=>({automaticLayout:!0,minimap:{enabled:!1},fontSize:14,lineHeight:21,readOnly:!0}));W(c,m=>{var v,T;(T=(v=f.value)==null?void 0:v.$editor)==null||T.updateOptions({theme:m})}),W(_,async m=>{m&&n.routes.length>0&&(await qe(),setTimeout(()=>{var v;(v=f.value)!=null&&v.$editor&&f.value.$editor.updateOptions({theme:c.value}),E(n.routes[0])},50))}),W(()=>n.strategyCodes,m=>{m&&p.value&&(u.value=m[p.value]||"# No strategy code snapshot available for this route")},{deep:!0,immediate:!0});function E(m){var T;const v=`${n.exchange}-${m.symbol}`;p.value=v,g.value=m,u.value=((T=n.strategyCodes)==null?void 0:T[v])||"# No strategy code snapshot available for this route"}async function b(){try{await navigator.clipboard.writeText(u.value),Q("success","Strategy code copied to clipboard")}catch(m){mt(m)}}function C(){var m;(m=g.value)!=null&&m.strategy?Ce(`/strategies/${g.value.strategy}`):Q("error","No strategy selected")}return(m,v)=>{const T=Ve,J=Qt,q=ct,N=He,R=Ue;return a(),F(R,{modelValue:_.value,"onUpdate:modelValue":v[2]||(v[2]=x=>_.value=x),ui:{width:"sm:max-w-5xl"}},{default:L(()=>[l(N,null,{header:L(()=>[t("div",Zt,[v[3]||(v[3]=t("h3",{class:"text-lg font-semibold"},"Strategy Code Snapshot",-1)),l(T,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark",size:"sm",onClick:v[0]||(v[0]=x=>_.value=!1)})])]),default:L(()=>[t("div",Xt,[m.routes.length>1?(a(),d("div",Kt,[(a(!0),d(A,null,se(m.routes,x=>(a(),F(T,{key:`${m.exchange}-${x.symbol}`,variant:"soft",color:"gray",disabled:p.value===`${m.exchange}-${x.symbol}`,onClick:G=>E(x)},{default:L(()=>[pe(y(x.strategy)+" • "+y(x.symbol),1)]),_:2},1032,["disabled","onClick"]))),128))])):k("",!0),t("div",es,[t("div",ts,[v[4]||(v[4]=t("label",{class:"block text-sm font-medium"},null,-1)),t("div",ss,[l(T,{icon:"i-heroicons-clipboard-document",label:"Copy",variant:"soft",color:"gray",size:"sm",onClick:b}),l(T,{icon:"i-heroicons-pencil-square",label:"Go to Strategy Editor",variant:"soft",color:"primary",size:"sm",onClick:C})])]),l(q,null,{default:L(()=>[l(J,{ref_key:"codeEditorRef",ref:f,modelValue:u.value,"onUpdate:modelValue":v[1]||(v[1]=x=>u.value=x),lang:"python",options:$.value,class:"border border-gray-200 dark:border-gray-800 rounded",style:{height:"500px"}},{default:L(()=>v[5]||(v[5]=[pe(" Loading editor... ")])),_:1},8,["modelValue","options"])]),_:1})])])]),_:1})]),_:1},8,["modelValue"])}}}),rs={class:"w-16 overflow-hidden"},ls={class:"w-8 overflow-hidden"},as={key:0,class:"w-full transition-all overflow-hidden duration-300 bg-gray-50 dark:bg-gray-800"},ns=["onClick"],is={class:"w-16 overflow-hidden text-center"},ds={class:"w-12 overflow-hidden text-center"},us={class:"w-8 overflow-hidden text-center"},cs={class:"p-4"},fs={class:"mt-4"},ms={class:"w-full text-sm"},gs={class:"w-full"},ps={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},vs={class:"w-full flex justify-between py-2 px-4"},ys={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},bs={class:"w-full flex justify-between py-2 px-4"},hs={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ws={class:"w-full flex justify-between py-2 px-4"},ks={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},xs={class:"w-full flex justify-between py-2 px-4"},_s={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},$s={class:"w-full"},Cs={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Vs={class:"w-full flex justify-between py-2 px-4"},Ss={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Ts={key:0,class:"w-full flex justify-between py-2 px-4"},js={key:1,class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Ls={key:2,class:"w-full flex justify-between py-2 px-4"},Rs={class:"flex justify-end mt-4"},Es=re({__name:"ChartOrders",props:{trade:{}},emits:["zoom","hoverbg"],setup(B,{emit:n}){const _=n,p=w(null),g=w(!1),u=w(!1);return(f,s)=>{const c=gt,$=Ve,E=Ue;return a(),d(A,null,[l($,{variant:"ghost",color:"gray",class:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 text-xs border-b border-gray-100 dark:border-gray-800 rounded-none p-2",onClick:s[1]||(s[1]=b=>u.value=!r(u)),onMouseover:s[2]||(s[2]=b=>_("hoverbg",f.trade.orders[0].id))},{default:L(()=>[t("div",{class:Z(["w-2 transition-all duration-300",[r(u)?"rotate-90":"rotate-0"]])},s[5]||(s[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})],-1)]),2),t("div",rs,y(r(te).roundPrice(f.trade.entry_price)),1),s[6]||(s[6]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",{class:Z(["w-16 overflow-hidden",f.trade.type.toLowerCase()==="long"?"text-green-500":"text-red-500"])},y(r(fe).round(f.trade.qty,2)),3),s[7]||(s[7]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",{class:Z([[f.trade.PNL_percentage>0?"text-green-500":"text-red-500"],"w-16 overflow-hidden text-xs"])},y(r(fe).round(f.trade.PNL_percentage,2))+"% ",3),s[8]||(s[8]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",ls,[l($,{color:"gray",size:"xs",onClick:s[0]||(s[0]=ze(b=>_("zoom",f.trade.orders[0].id),["stop"]))},{default:L(()=>[l(c,{name:"i-heroicons-arrow-right"})]),_:1})])]),_:1}),r(u)?(a(),d("div",as,[s[13]||(s[13]=Ge('<div class="flex justify-between items-center border-b-2 border-gray-200 dark:border-gray-700 px-1 py-2 text-xs"><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PRICE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-12 overflow-hidden italic font-bold uppercase text-center">TYPE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">SIDE</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(a(!0),d(A,null,se(f.trade.orders,(b,C)=>(a(),d("div",{key:C,class:"w-full flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-900 text-xs py-2 border-b border-gray-200 cursor-pointer dark:border-gray-700 px-1",onClick:m=>{p.value=b,g.value=!0}},[t("div",is,y(r(te).roundPrice(b.price)),1),s[9]||(s[9]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",{class:Z(["w-10 overflow-hidden text-center",b.side==="buy"?"text-green-500":"text-red-500"])},y(r(fe).round(b.qty,2)),3),s[10]||(s[10]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",ds,y(b.type),1),s[11]||(s[11]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",{class:Z([[b.side==="buy"?"text-green-500":"text-red-500"],"w-10 overflow-hidden text-center"])},y(b.side.toUpperCase()),3),s[12]||(s[12]=t("div",{class:"w-1 opacity-20"},"|",-1)),t("div",us,[l($,{color:"gray",size:"xs",onClick:ze(m=>_("zoom",b.id),["stop"])},{default:L(()=>[l(c,{name:"i-heroicons-arrow-right"})]),_:2},1032,["onClick"])])],8,ns))),128))])):k("",!0),l(E,{modelValue:r(g),"onUpdate:modelValue":s[4]||(s[4]=b=>ie(g)?g.value=b:null)},{default:L(()=>{var b,C,m,v,T,J,q,N,R,x,G;return[t("div",cs,[t("div",fs,[t("div",ms,[s[29]||(s[29]=t("h2",{class:"text-lg mb-2 font-bold italic dark:text-white text-center"}," Trade ",-1)),t("div",gs,[t("div",ps,[s[14]||(s[14]=t("div",{class:"font-bold"},"Entry Price",-1)),t("div",null,y(r(te).roundPrice(f.trade.entry_price)),1)]),t("div",vs,[s[15]||(s[15]=t("div",{class:"font-bold"},"Exit Price",-1)),t("div",null,y(r(te).roundPrice(f.trade.exit_price)),1)]),t("div",ys,[s[16]||(s[16]=t("div",{class:"font-bold"},"Qty",-1)),t("div",null,y(f.trade.qty),1)]),t("div",bs,[s[17]||(s[17]=t("div",{class:"font-bold"},"Size",-1)),t("div",null,y(r(te).roundPrice(f.trade.size)),1)]),t("div",hs,[s[18]||(s[18]=t("div",{class:"font-bold"},"PNL",-1)),t("div",{class:Z([f.trade.PNL>0?"text-green-500":"text-red-500"])},y(r(fe).round(f.trade.PNL,2))+" ("+y(r(fe).round(f.trade.PNL_percentage,2))+"%) ",3)]),t("div",ws,[s[19]||(s[19]=t("div",{class:"font-bold"},"Fee",-1)),t("div",null,y(r(fe).round(f.trade.fee,2)),1)]),t("div",ks,[s[20]||(s[20]=t("div",{class:"font-bold"},"Holding Period",-1)),t("div",null,y(r(te).secondsToHumanReadable(f.trade.holding_period)),1)]),t("div",xs,[s[21]||(s[21]=t("div",{class:"font-bold"},"Opened At",-1)),t("div",null,y(new Date(f.trade.opened_at).toLocaleString()),1)]),t("div",_s,[s[22]||(s[22]=t("div",{class:"font-bold"},"Closed At",-1)),t("div",null,y(new Date(f.trade.closed_at).toLocaleString()),1)])]),s[30]||(s[30]=t("h2",{class:"text-lg font-bold italic dark:text-white mt-6 mb-2 text-center"}," Order ",-1)),t("div",$s,[t("div",Cs,[s[23]||(s[23]=t("div",{class:"font-bold"},"Side",-1)),t("div",{class:Z([((b=r(p))==null?void 0:b.side)==="buy"?"text-green-500":"text-red-500"])},y((m=(C=r(p))==null?void 0:C.side)==null?void 0:m.toUpperCase()),3)]),t("div",Vs,[s[24]||(s[24]=t("div",{class:"font-bold"},"Type",-1)),t("div",null,y((v=r(p))==null?void 0:v.type),1)]),t("div",Ss,[s[25]||(s[25]=t("div",{class:"font-bold"},"Qty",-1)),t("div",null,y((T=r(p))==null?void 0:T.qty),1)]),(J=r(p))!=null&&J.created_at?(a(),d("div",Ts,[s[26]||(s[26]=t("div",{class:"font-bold"},"Created At",-1)),t("div",null,y(new Date((q=r(p))==null?void 0:q.created_at).toLocaleString()),1)])):k("",!0),(N=r(p))!=null&&N.executed_at?(a(),d("div",js,[s[27]||(s[27]=t("div",{class:"font-bold"},"Executed At",-1)),t("div",null,y(new Date((R=r(p))==null?void 0:R.executed_at).toLocaleString()),1)])):k("",!0),(x=r(p))!=null&&x.canceled_at?(a(),d("div",Ls,[s[28]||(s[28]=t("div",{class:"font-bold"},"Canceled At",-1)),t("div",null,y(new Date((G=r(p))==null?void 0:G.canceled_at).toLocaleString()),1)])):k("",!0)])]),t("div",Rs,[l($,{color:"gray",block:"",onClick:s[3]||(s[3]=le=>g.value=!1)},{default:L(()=>s[31]||(s[31]=[pe(" Close ")])),_:1})])])])]}),_:1},8,["modelValue"])],64)}}}),Us={class:"w-0 sidebar whitespace-nowrap relative transition-all duration-300"},Ms={key:1,class:"h-full flex justify-center items-center text-xs text-gray-500"},Os=re({__name:"ChartSidebar",props:$e({items:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:$e(["zoom","hoverbg"],["update:modelValue"]),setup(B,{emit:n}){const _=Se(B,"modelValue"),p=n;return(g,u)=>{const f=Es;return a(),d("div",Us,[t("div",{class:Z([_.value?"w-96 p-2":"w-0 p-0","absolute h-full overflow-y-auto border-r-2 dark:border-gray-800 transition-all duration-300 z-0"])},[g.items.length>0?(a(),d(A,{key:0},[u[2]||(u[2]=Ge('<div class="flex justify-between items-center border-b-2 p-2 text-xs dark:border-gray-800"><div class="w-2"></div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">ENTRY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PNL</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(a(!0),d(A,null,se(g.items,(s,c)=>(a(),d("div",{key:c,class:"w-full"},[l(f,{trade:s,onZoom:u[0]||(u[0]=$=>p("zoom",$)),onHoverbg:u[1]||(u[1]=$=>p("hoverbg",$))},null,8,["trade"])]))),128))],64)):(a(),d("div",Ms," No trades were executed "))],2)])}}}),Is={class:"w-full h-full flex justify-between border-2 border-gray-200 dark:border-gray-800 rounded-lg"},Bs={class:"w-full flex flex-col h-full border dark:border-gray-800"},Ns={key:0},Ps=re({__name:"BacktestCandlesChart",props:$e({form:{},results:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const n=Je(),_=w(2),p=Se(B,"modelValue"),g=B,u=w(),f=w([]);let s=null,c=null;const $=[],E=[],b=M(()=>Ye().params.id),C=M(()=>ee.extraChartLines[b.value].find(h=>h.symbol===g.results.selectedRoute.symbol)),m=M(()=>n.value),v=M(()=>X());W(m,h=>{x(h)}),W(()=>g.results.selectedRoute.symbol,()=>{R(),setTimeout(async()=>{await T()},100)}),Me(async()=>{setTimeout(async()=>{await T()},200)}),W(p,()=>{setTimeout(()=>{J()},300)});async function T(){var de,ue,ce,H;_e.width=u.value.clientWidth,_e.height=u.value.clientHeight-Object.keys(C.value.charts).length*150,s=De(u.value,_e),s.applyOptions({rightPriceScale:{borderColor:m.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${g.results.selectedRoute.symbol} • ${g.results.selectedRoute.timeframe}`}}),c=s.addCandlestickSeries();const h=ee.candles[b.value].find(j=>j.symbol===g.results.selectedRoute.symbol).candles;c.setData(h),c.setMarkers(ee.orders[b.value].find(j=>j.symbol===g.results.selectedRoute.symbol).orders);const V=String(h[0].open).indexOf("."),S=V===-1?0:String(h[h.length-1].open).length-V-1;_.value!==S&&(_.value=S,(_.value<0||_.value>100)&&(_.value=0),c.applyOptions({priceFormat:{type:"price",precision:_.value,minMove:Math.pow(10,-_.value).toFixed(_.value)}}));const O=(ue=(de=ee.lines[b.value])==null?void 0:de.find(j=>j.symbol===g.results.selectedRoute.symbol))==null?void 0:ue.lines;if(O)for(const j of Object.keys(O)){const I=O[j];s.addLineSeries({lineWidth:1,title:j}).setData(I.data)}const P=(H=(ce=ee.horizontalLines[b.value])==null?void 0:ce.find(j=>j.symbol===g.results.selectedRoute.symbol))==null?void 0:H.lines;if(P)for(const j of Object.keys(P)){const Y=P[j];c.createPriceLine(Y)}s.timeScale().fitContent();const ae=new Set;Object.keys(C.value.charts).forEach((j,I)=>{const Y={..._e};Y.width=f.value[I].clientWidth,Y.height=150;const z=De(f.value[I],Y);$.push(z),Object.keys(C.value.charts[j]).forEach(D=>{var we,ye;const oe=z.addLineSeries({lineWidth:1,title:D}),ve=(ye=(we=ee.horizontalExtraLines[b.value])==null?void 0:we.find(be=>be.symbol===g.results.selectedRoute.symbol))==null?void 0:ye.lines[j];if(ve&&!ae.has(j)){for(const be of Object.keys(ve)){const Te=ve[be];oe.createPriceLine(Te)}ae.add(j)}oe.setData(C.value.charts[j][D].data),E.push(oe)}),z.applyOptions({rightPriceScale:{borderColor:m.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:j}}),z.timeScale().subscribeVisibleLogicalRangeChange(D=>{s.timeScale().setVisibleLogicalRange(D)}),I!==Object.keys(C.value.charts).length-1&&z.timeScale().applyOptions({visible:!1})}),s.subscribeCrosshairMove(j=>{const I=q(c,j);Object.keys(C.value.charts).forEach((Y,z)=>{N($[z],E[z],I)})}),Object.keys(C.value.charts).forEach((j,I)=>{$[I].subscribeCrosshairMove(Y=>{const z=q(E[I],Y);N(s,c,z),$.forEach((D,oe)=>{oe!==I&&N(D,E[oe],z)})})}),s.timeScale().subscribeVisibleLogicalRangeChange(j=>{$.forEach(I=>{I.timeScale().setVisibleLogicalRange(j)})}),x(m.value),$.length>0&&s.timeScale().applyOptions({visible:!1})}function J(){var h;s!==null&&(s.applyOptions({width:(h=u.value)==null?void 0:h.clientWidth}),$.forEach(V=>{var S;V.applyOptions({width:(S=u.value)==null?void 0:S.clientWidth})}))}pt(()=>{R()});function q(h,V){return V.time&&V.seriesData.get(h)||null}function N(h,V,S){if(S){h.setCrosshairPosition(S.value,S.time,V);return}h.clearCrosshairPosition()}function R(){s!==null&&(s.remove(),s=null),c!==null&&(c=null),$.length>0&&($.forEach(h=>{h.remove()}),$.length=0),E.length>0&&(E.length=0)}function x(h){s!==null&&(s.applyOptions(h==="light"?Fe.chart:Ae.chart),$.forEach(V=>{V.applyOptions(h==="light"?Fe.chart:Ae.chart)}))}function G(h){const V=ee.orders[b.value].find(O=>O.symbol===g.results.selectedRoute.symbol).orders,S=V.find(O=>O.order_id===h);if(S&&s){const O=(typeof S.time=="number",S.time),P=s.timeScale(),ae=V[1].time-V[0].time,de=O-ae*5,ue=O+ae*5,ce=S.color;c==null||c.setMarkers(V.map(H=>H.order_id===h?{...H,color:"#FFA500"}:H)),P.setVisibleRange({from:de,to:ue}),setTimeout(()=>{c==null||c.setMarkers(V.map(H=>H.order_id===h?{...H,color:ce}:H))},2e3)}}function le(h){const V=ee.orders[b.value].find(O=>O.symbol===g.results.selectedRoute.symbol).orders,S=V.find(O=>O.order_id===h);if(S&&s){const O=S.color;c==null||c.setMarkers(V.map(P=>P.order_id===h?{...P,color:"#FFA500"}:P)),setTimeout(()=>{c==null||c.setMarkers(V.map(P=>P.order_id===h?{...P,color:O}:P))},2e3)}}function X(){return g.results.trades.filter(h=>h.symbol===g.results.selectedRoute.symbol)}return(h,V)=>(a(),d("div",Is,[l(Os,{modelValue:p.value,"onUpdate:modelValue":V[0]||(V[0]=S=>p.value=S),items:r(v),onHoverbg:V[1]||(V[1]=S=>le(S)),onZoom:V[2]||(V[2]=S=>G(S))},null,8,["modelValue","items"]),t("div",{class:Z([[p.value?"w-[calc(100%-384px)]":"w-full"],"h-full transition-all duration-300"])},[t("div",Bs,[t("div",{ref_key:"chartContainer",ref:u,class:"rounded overflow-hidden flex-grow"},null,512),r(C)&&Object.keys(r(C).charts).length?(a(),d("div",Ns,[(a(!0),d(A,null,se(Object.keys(r(C).charts),S=>(a(),d("div",{key:S,ref_for:!0,ref_key:"extraChartsRef",ref:f,class:"relative border-t-[1.5px] dark:border-gray-800"}))),128))])):k("",!0)])],2)]))}}),zs={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},Ds=["textContent"],Fs={class:"mt-8"},As={class:"mt-8 flex flex-col gap-4"},qs={key:0,class:"mt-4"},Hs={key:1,class:"mx-auto container mt-8"},Ws={key:0},Js={class:"mb-4 mt-4"},Gs={class:"flex items-center select-none flex-1 my-4"},Ys={class:"grid grid-cols-1 gap-6 mt-8"},Qs={key:1,class:"w-full mx-auto"},Zs={class:"space-y-12"},Xs={key:0},Ks={key:1,class:"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden"},eo={key:2,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},to={class:"flex justify-start"},so={key:0,class:"flex h-[800px] border border-gray-200 dark:border-gray-800 rounded overflow-hidden"},oo={class:"w-[460px] flex-shrink-0 border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900"},ro={class:"flex items-center border-b border-gray-200 dark:border-gray-800 px-6 py-3 bg-gray-50 dark:bg-gray-900"},lo={class:"flex gap-16"},ao={class:"overflow-auto"},no={class:"flex gap-12 flex-1"},io={class:"flex-1 bg-white dark:bg-gray-900"},uo={key:0},co={key:0},fo=["href"],mo=["href"],go=["href"],po={key:5,class:"my-4"},vo={key:6,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},yo={class:"px-6 py-4 space-y-3"},bo={class:"font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"},ho={class:"font-semibold text-gray-900 dark:text-gray-100 truncate ml-4"},wo={key:7,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},ko={class:"px-6 py-4 space-y-4"},xo={class:"text-sm font-bold text-gray-900 dark:text-gray-100 truncate pr-2"},_o={class:"text-sm text-gray-500 dark:text-gray-400 truncate text-center px-2"},$o={class:"flex justify-end ml-auto"},Co={key:8,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},Vo={class:"px-6 py-4 space-y-3"},So={class:"font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap"},To={class:"font-semibold text-gray-900 dark:text-gray-100 truncate ml-4"},jo={key:9,class:"mt-8 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg overflow-hidden select-none"},Lo={class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50 flex justify-between items-center"},Ro={class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},Eo={class:"px-6 py-4"},Uo={key:0,class:"text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Mo={key:1,class:"text-sm text-gray-400 dark:text-gray-500 italic text-center py-2"},Oo={key:1},Io=re({__name:"BacktestTab",props:{form:{},results:{}},setup(B){const n=B,_=M(()=>n.results.generalInfo.title?`${n.results.generalInfo.title} - Backtest - Jesse`:"Backtest - Jesse");Ze({title:_});const p=w(!1),g=w(!1),u=w(!0),f=w(!1),s=w([]),c=w([]),$=w(!1),E=w(!1),b=Ee().authToken,C=w(vt().public.apiBaseUrl),m=w(!1),v=w(!1),T=w(!1),J=w(null),q=w(null),N=w(null),R=M(()=>Ye().params.id),x=Qe(),G=Ee(),le=yt(),X=w([]),h=M(()=>G.jesseSupportedTimeframes.map(e=>({label:e,value:e}))),V=M(()=>n.form.routes.map(e=>({label:`${e.strategy} • ${e.symbol}`,value:e})));n.results.selectedRoute=n.form.routes[0],Me(async()=>{setTimeout(async()=>{await G.initiate(),!n.form.exchange&&G.backtestingExchangeNames.length&&(n.form.exchange=G.backtestingExchangeNames[0]),(!n.results.showResults&&n.form.exchange||!X.value.length)&&await S()},50)});async function S(){if(n.form.exchange)try{X.value=await G.getExchangeSupportedSymbols(n.form.exchange);for(let e=0;e<n.form.routes.length;e++)X.value.includes(n.form.routes[e].symbol)||(n.form.routes[e].symbol=X.value[0]);if(n.form.data_routes.length>0)for(let e=0;e<n.form.data_routes.length;e++)X.value.includes(n.form.data_routes[e].symbol)||(n.form.data_routes[e].symbol=X.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}W(()=>n.form.exchange,async(e,o)=>{e!==o&&await S()}),W(v,async e=>{if(e){const o=await x.getSessionData(R.value);o&&(J.value=o.title||null,q.value=o.description||null,N.value=o.strategy_codes||null)}});function O(e){n.results.generalInfo.title=e.title||null,n.results.generalInfo.description=e.description||null}W(T,async e=>{if(e){const o=await x.getStrategyCode(R.value);o&&(N.value=o)}});const P=bt(()=>{n.results.executing||x.saveStateDraft(R.value)},1e3);W(()=>n.form,()=>{P()},{deep:!0});const{cancel:ae,newBacktest:de,retry:ue}=x;function ce(e){if(c.value.length){for(let o=0;o<c.value.length;o++)Q("error",c.value[o]);return}s.value=[],x.start(e)}function H(e){s.value=[],x.rerun(e)}const j=e=>{if(c.value.length){for(let o=0;o<c.value.length;o++)Q("error",c.value[o]);return}s.value=[],x.startInNewTab(e)},I=M(()=>{let e=`/download/backtest/tradingview/${n.results.generalInfo.session_id}?token=${b}`;return C.value!=="/"&&(e=C.value+e),e});M(()=>{let e=`/download/backtest/full-reports/${n.results.generalInfo.session_id}?token=${b}`;return C.value!=="/"&&(e=C.value+e),e});const Y=M(()=>{let e=`/download/backtest/csv/${n.results.generalInfo.session_id}?token=${b}`;return C.value!=="/"&&(e=C.value+e),e}),z=M(()=>{let e=`/download/backtest/json/${n.results.generalInfo.session_id}?token=${b}`;return C.value!=="/"&&(e=C.value+e),e}),D=M(()=>x.formattedMetrics(R.value).length>0),oe=M(()=>te.remainingTimeText(n.results.progressbar.estimated_remaining_seconds));function ve(){try{s.value.length>1e6&&Q("success","Copying large log file, please wait..."),setTimeout(()=>{navigator.clipboard.writeText(s.value.join(`
`)),Q("success","Logs copied successfully"),E.value=!0,setTimeout(()=>{E.value=!1},3e3)},0)}catch{Q("error","Failed to copy logs")}}async function we(){const e=x.missingCandlesErrors[R.value];e&&(le.forms.push({id:te.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}}),await Ce("/candles/"),await le.start(le.forms[le.forms.length-1].id))}async function ye(){s.value.length===0?await be():f.value=!0}async function be(){p.value=!0;try{const{data:e,error:o}=await Vt(`/backtest/logs/${R.value}?token=${b}`,!1);if(o.value){Q("error",o.value.message),p.value=!1;return}const je=e.value;setTimeout(()=>{const Re=te.decompressData(je.content).split(`
`).map(ke=>{const U=ke.match(/\[INFO \| (.*?)\] (.*)/);return U?`[${U[1]}] ${U[2]}`:ke});s.value=Re,p.value=!1,f.value=!0},0)}catch{Q("error","Failed to fetch logs"),p.value=!1}}async function Oe(){let e=`/backtest/download-log/${R.value}?token=${b}`;C.value!=="/"&&(e=C.value+e),window.open(e,"_blank")}async function Te(){if(m.value=!0,!ee.candles[R.value]){g.value=!0;const e=await x.loadChartData(R.value);if(g.value=!1,!e){Q("error","Failed to load chart data"),m.value=!1;return}}}return(e,o)=>{const je=Jt,Le=We,Re=kt,ke=jt,U=Ve,Xe=Rt,Ie=Et,xe=xt,Be=Ut,Ke=Mt,Ne=_t,ne=$t,et=Ot,tt=Ct,K=It,st=Yt,ot=Bt,rt=Nt,lt=Pt,at=os;return a(),d(A,null,[l(Re,{modelValue:r(f),"onUpdate:modelValue":o[0]||(o[0]=i=>ie(f)?f.value=i:null),title:"Logs"},{default:L(()=>[l(je,{logs:r(s)},null,8,["logs"])]),buttons:L(()=>[l(Le,{text:"Copy",class:"inline-block",popper:{arrow:!0}},{default:L(()=>[t("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:ve},[r(E)?(a(),F(r(ht),{key:0,class:"h-6 w-6","aria-hidden":"true"})):k("",!0),!r(E)&&r(s).length!=0?(a(),F(r(Lt),{key:1,class:"h-6 w-6","aria-hidden":"true"})):k("",!0)])]),_:1}),l(Le,{text:"Download",class:"inline-block ml-2",popper:{arrow:!0}},{default:L(()=>[t("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:Oe},[r(s).length!=0?(a(),F(r(wt),{key:0,class:"h-6 w-6","aria-hidden":"true"})):k("",!0)])]),_:1})]),_:1},8,["modelValue"]),e.results.executing&&!e.results.showResults?(a(),d("div",zs,[t("div",null,[l(ke,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?k("",!0):(a(),d("h3",{key:0,class:"mt-8 animate-pulse",textContent:y(r(oe))},null,8,Ds)),t("div",Fs,[t("div",As,[e.results.exception.error?(a(),F(U,{key:0,color:"primary",class:"w-64 flex justify-center",icon:"i-heroicons-arrow-path",variant:"solid",label:"Retry",trailing:!1,onClick:o[1]||(o[1]=i=>r(ue)((e._.provides[me]||e.$route).params.id))})):k("",!0),l(U,{color:"gray",ui:{color:{gray:{soft:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",variant:"soft",label:"Cancel",trailing:!1,onClick:o[2]||(o[2]=i=>r(ae)((e._.provides[me]||e.$route).params.id))})]),e.form.debug_mode&&e.results.exception.error?(a(),d("div",qs,[l(U,{icon:"i-heroicons-clipboard-document-list",label:"Debugging Logs",color:"gray",variant:"solid",trailing:!1,class:"w-64 flex justify-center",onClick:ye})])):k("",!0)]),e.results.exception.error&&e.results.executing?(a(),d("div",Hs,[l(Xe,{modelValue:r($),"onUpdate:modelValue":o[3]||(o[3]=i=>ie($)?$.value=i:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):k("",!0)])):k("",!0),l(rt,null,{left:L(()=>[!e.results.executing&&!e.results.showResults?(a(),d("div",Ws,[r(x).missingCandlesErrors[r(R)]?(a(),F(Ie,{key:0,icon:"i-heroicons-exclamation-triangle",color:"rose",variant:"soft",class:"mb-4"},{title:L(()=>o[29]||(o[29]=[t("h3",{class:"text-lg font-semibold"},"Missing Required Warmup Candles",-1)])),description:L(()=>[t("p",Js,[o[30]||(o[30]=pe(" Your strategy requires ")),o[31]||(o[31]=t("strong",{class:"font-bold"},"warmup candles",-1)),pe(' for "'+y(r(x).missingCandlesErrors[r(R)].symbol)+'" on "'+y(r(x).missingCandlesErrors[r(R)].exchange)+'" starting from "'+y(r(x).missingCandlesErrors[r(R)].start_date)+'". These candles are needed for proper strategy initialization. ',1)]),l(U,{label:"Import Required Candles",icon:"i-heroicons-arrow-down-tray",onClick:we})]),_:1})):k("",!0),l(xe,{class:"mb-4",title:"Exchange"}),l(Be,{modelValue:e.form.exchange,"onUpdate:modelValue":o[4]||(o[4]=i=>e.form.exchange=i),placeholder:"Select an exchange...",searchable:"",options:r(Ee)().backtestingExchangeNames,class:"mt-2 mb-16"},null,8,["modelValue","options"]),l(Ke,{"total-routes-error":r(c),timeframes:r(h),form:e.form,results:e.results,symbols:r(X),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),l(xe,{class:"mt-16",title:"Duration"}),t("div",Gs,[l(Ne,{modelValue:e.form.start_date,"onUpdate:modelValue":o[5]||(o[5]=i=>e.form.start_date=i),type:"date",variant:"outline",class:"w-full mr-2"},null,8,["modelValue"]),l(Ne,{modelValue:e.form.finish_date,"onUpdate:modelValue":o[6]||(o[6]=i=>e.form.finish_date=i),type:"date",variant:"outline",class:"w-full ml-2"},null,8,["modelValue"])]),l(xe,{class:"mt-16",title:"Options"}),t("div",Ys,[l(ne,{modelValue:e.form.debug_mode,"onUpdate:modelValue":o[7]||(o[7]=i=>e.form.debug_mode=i),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),l(ne,{modelValue:e.form.export_chart,"onUpdate:modelValue":o[8]||(o[8]=i=>e.form.export_chart=i),title:"Generate Interactive Charts",description:"Generate interactive charts for backtest results with details."},null,8,["modelValue"]),l(ne,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":o[9]||(o[9]=i=>e.form.export_tradingview=i),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),l(ne,{modelValue:e.form.export_csv,"onUpdate:modelValue":o[10]||(o[10]=i=>e.form.export_csv=i),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),l(ne,{modelValue:e.form.export_json,"onUpdate:modelValue":o[11]||(o[11]=i=>e.form.export_json=i),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),l(ne,{modelValue:e.form.fast_mode,"onUpdate:modelValue":o[12]||(o[12]=i=>e.form.fast_mode=i),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),l(ne,{modelValue:e.form.benchmark,"onUpdate:modelValue":o[13]||(o[13]=i=>e.form.benchmark=i),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):k("",!0),e.results.showResults?(a(),d("div",Qs,[t("div",Zs,[r(D)?(a(),d("div",Xs,[l(xe,{class:"mb-4",title:"Equity Curve"}),l(et,{data:e.results.charts.equity_curve},null,8,["data"])])):k("",!0),r(D)?(a(),d("div",Ks,[o[32]||(o[32]=t("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[t("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Performance")],-1)),l(tt,{data:r(x).formattedMetrics(r(R)),"no-container":""},null,8,["data"])])):k("",!0),r(D)?k("",!0):(a(),d("div",eo," No trades were executed via this strategy! "))]),l(st,{modelValue:r(m),"onUpdate:modelValue":o[17]||(o[17]=i=>ie(m)?m.value=i:null)},{title:L(()=>[t("div",to,[l(Be,{modelValue:e.results.selectedRoute,"onUpdate:modelValue":o[14]||(o[14]=i=>e.results.selectedRoute=i),"value-attribute":"value",options:r(V)},null,8,["modelValue","options"]),l(U,{class:"ml-2",color:"gray",label:r(u)?"Hide Trades":"Show Trades",onClick:o[15]||(o[15]=i=>u.value=!r(u))},null,8,["label"])])]),default:L(()=>[r(g)?(a(),d("div",so,[t("div",oo,[t("div",ro,[t("div",lo,[l(K,{class:"h-4 w-12"}),l(K,{class:"h-4 w-12"}),l(K,{class:"h-4 w-12"})])]),t("div",ao,[(a(),d(A,null,se(14,i=>t("div",{key:i,class:"flex items-center px-4 py-3.5 border-b border-gray-200 dark:border-gray-800"},[l(K,{class:"h-4 w-4 mr-4"}),t("div",no,[l(K,{class:"h-4 w-14"}),l(K,{class:"h-4 w-10"}),l(K,{class:"h-4 w-14"})]),l(K,{class:"h-7 w-7 rounded"})])),64))])]),t("div",io,[l(K,{class:"w-full h-full"})])])):(a(),F(Ps,{key:1,modelValue:r(u),"onUpdate:modelValue":o[16]||(o[16]=i=>ie(u)?u.value=i:null),results:e.results,form:e.form},null,8,["modelValue","results","form"]))]),_:1},8,["modelValue"])])):k("",!0)]),right:L(()=>[e.results.executing?k("",!0):(a(),d("div",uo,[e.results.showResults?(a(),d("div",co,[l(U,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",variant:"solid",label:"Rerun",trailing:!1,onClick:o[18]||(o[18]=i=>H((e._.provides[me]||e.$route).params.id))}),l(U,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",variant:"soft",label:"New session",trailing:!1,onClick:o[19]||(o[19]=i=>r(de)((e._.provides[me]||e.$route).params.id))}),l(U,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-code-bracket",variant:"soft",label:"View Strategy Snapshot",trailing:!1,onClick:o[20]||(o[20]=i=>T.value=!0)}),e.form.debug_mode?(a(),F(U,{key:0,class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-clipboard-document-list",variant:"soft",label:"Debugging Logs",loading:r(p),trailing:!1,onClick:o[21]||(o[21]=i=>ye())},null,8,["loading"])):k("",!0),e.form.export_chart?(a(),F(U,{key:1,class:"mt-4 flex justify-center items-center btn-secondary text-center",color:"gray",icon:"i-heroicons-chart-bar",block:"",variant:"soft",label:"View charts",trailing:!1,onClick:o[22]||(o[22]=i=>Te())})):k("",!0),e.form.export_csv&&r(D)?(a(),d("a",{key:2,href:r(Y),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[l(U,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",variant:"soft",label:"CSV",trailing:!1})],8,fo)):k("",!0),e.form.export_json&&r(D)?(a(),d("a",{key:3,href:r(z),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[l(U,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",variant:"soft",label:"JSON",trailing:!1})],8,mo)):k("",!0),e.form.export_tradingview&&r(D)?(a(),d("a",{key:4,href:r(I),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[l(U,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",variant:"soft",label:"TradingView Pine Editor",trailing:!1})],8,go)):k("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(a(),d("div",po,[l(Ie,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:o[23]||(o[23]=i=>e.results.alert.message="")},null,8,["title"])])):k("",!0),e.results.info&&e.results.info.length?(a(),d("div",vo,[o[33]||(o[33]=t("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[t("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"General Info")],-1)),t("dl",yo,[(a(!0),d(A,null,se(e.results.info,(i,he)=>(a(),d("div",{key:he,class:"flex justify-between items-center text-sm"},[t("dt",bo,y(i[0])+":",1),t("dd",ho,y(i[1]),1)]))),128))])])):k("",!0),e.results.routes_info&&e.results.routes_info.length?(a(),d("div",wo,[o[34]||(o[34]=t("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[t("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Routes")],-1)),t("div",ko,[(a(!0),d(A,null,se(e.results.routes_info,(i,he)=>(a(),d("div",{key:he,class:"grid grid-cols-3 items-center"},[t("div",xo,y(i[2].value),1),t("div",_o,y(i[0].value),1),t("div",$o,[l(ot,{color:"gray",variant:"soft",size:"xs"},{default:L(()=>[pe(y(i[1].value),1)]),_:2},1024)])]))),128))])])):k("",!0),e.results.hyperparameters&&e.results.hyperparameters.length?(a(),d("div",Co,[o[35]||(o[35]=t("div",{class:"px-6 py-4 border-b dark:border-gray-700 bg-gray-100 dark:bg-gray-700/50"},[t("h3",{class:"text-xs font-bold text-gray-900 dark:text-gray-100 uppercase tracking-wider"},"Hyperparameters")],-1)),t("dl",Vo,[(a(!0),d(A,null,se(e.results.hyperparameters,(i,he)=>(a(),d("div",{key:he,class:"flex justify-between items-center text-sm"},[t("dt",So,y(i[0])+":",1),t("dd",To,y(i[1]),1)]))),128))])])):k("",!0),e.results.showResults?(a(),d("div",jo,[t("div",Lo,[t("h3",Ro,y(e.results.generalInfo.title||"Session Notes"),1),l(U,{variant:"link",color:"gray",icon:"i-heroicons-pencil-square",onClick:o[24]||(o[24]=i=>v.value=!0)})]),t("div",Eo,[e.results.generalInfo.description?(a(),d("div",Uo,y(e.results.generalInfo.description),1)):(a(),d("div",Mo," No notes yet. Click the edit button to add notes. "))])])):k("",!0)])):(a(),d("div",Oo,[l(U,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",variant:"solid",label:"Start",trailing:!1,onClick:o[25]||(o[25]=i=>ce((e._.provides[me]||e.$route).params.id))}),l(U,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",variant:"soft",label:"Start in a new tab",trailing:!1,onClick:o[26]||(o[26]=i=>j((e._.provides[me]||e.$route).params.id))})]))]))]),_:1}),l(lt,{modelValue:r(v),"onUpdate:modelValue":o[27]||(o[27]=i=>ie(v)?v.value=i:null),"session-id":r(R),"initial-title":r(J),"initial-description":r(q),onSaved:O},null,8,["modelValue","session-id","initial-title","initial-description"]),l(at,{modelValue:r(T),"onUpdate:modelValue":o[28]||(o[28]=i=>ie(T)?T.value=i:null),routes:n.form.routes,exchange:n.form.exchange,"strategy-codes":r(N)},null,8,["modelValue","routes","exchange","strategy-codes"])],64)}}}),Bo={class:"w-full"},or=re({__name:"[id]",setup(B){Ze({title:"Backtest - Jesse"});const n=Qe(),_=St(),p=M(()=>n.tabs),g=M(()=>_.params.id),u=M(()=>p.value[g.value]);return Tt(()=>{const f=g.value;if(!f||u.value||!n.recentlyClosedTabIds.includes(f))return;const s=n.recentlyClosedRedirectTargets[f]||n.tabIds[0];s&&Ce(`/backtest/${s}`)}),n.tabIds.length===0&&n.addTab(),Me(()=>{setTimeout(async()=>{!u.value&&g.value&&(await n.loadSession(g.value)||(n.tabIds.length>0?await Ce(`/backtest/${n.tabIds[0]}`):await n.addTab()))},20)}),Dt({w:()=>{u.value&&n.closeTab(u.value.id,_.path)},ArrowLeft:()=>n.goToPrevTab(g.value),ArrowRight:()=>n.goToNextTab(g.value)}),(f,s)=>{const c=nt,$=Io;return a(),d(A,null,[t("div",Bo,[l(c,{"current-tab":u.value?u.value.id:null,tabs:p.value,onClose:s[0]||(s[0]=E=>r(n).closeTab(E,r(_).path)),onCancel:r(n).cancel},null,8,["current-tab","tabs","onCancel"])]),u.value?(a(),F($,{key:0,form:u.value.form,results:u.value.results},null,8,["form","results"])):k("",!0)],64)}}});export{or as default};
