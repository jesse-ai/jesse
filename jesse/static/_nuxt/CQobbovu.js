import{z as v,g as a,j as l,d as G,r as $,al as Te,i as r,I as Z,J as ue,f as w,W as n,X as H,a5 as Q,P as X,s as F,a1 as Be,as as Ce,e as S,am as le,Z as ie,L as D,an as ae,ao as ye,a0 as pe,t as de,a3 as Ne,c as C,$ as z,q as Ve,au as ze,a2 as Le,k as De,bl as Fe,V as qe,a as He,b6 as We,w as Y,H as Se,n as Ye,o as Ze,bf as be,G as T,bu as K,bc as Qe,be as he,a6 as Ge,a8 as Je}from"./BZBcjETW.js";import{r as _e,a as ke}from"./CA3QkJiz.js";import{_ as Pe,a as Ke,r as xe}from"./Brb7I5l6.js";import{_ as Xe}from"./CyMeHnuq.js";import{_ as et}from"./BuV2pFfZ.js";import{_ as tt}from"./B-Uq0ZUV.js";import{_ as st}from"./BAhmbuaU.js";import{_ as ot}from"./bNiC0h8c.js";import{_ as rt}from"./BfP20kJa.js";import{T as nt}from"./xgbdnDAz.js";import{l as lt,d as at,s as $e,_ as it,u as ut}from"./CuQxZd7W.js";import{_ as dt,a as ct}from"./CNlI_mjZ.js";import{u as mt}from"./D-92rLZE.js";import"./B-2SFkko.js";function we(B,o){return a(),v("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})])}function ft(B,o){return a(),v("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122"})])}const pt={class:"mb-4"},gt={class:"hidden sm:block"},vt={class:"relative rounded-lg shadow flex divide-x divide-gray-200 dark:divide-gray-700","aria-label":"Tabs"},yt=["to","onClick"],bt=["onClick"],ht=["onClick"],_t={class:"absolute right-[1em] focus:outline-none"},kt={class:"sm:hidden"},xt={class:"bg-white dark:bg-gray-800 shadow"},$t={class:"overflow-x-auto scrollbar-hide"},wt={class:"flex min-w-max"},Tt=["onClick"],Ct={class:"flex items-center gap-2"},Vt={class:"truncate max-w-[150px]"},Lt=["onClick"],St=["onClick"],Pt={class:"border-t border-gray-200 dark:border-gray-700 flex"},It=G({__name:"LiveTabs",props:{currentTab:{},tabs:{}},emits:["close","cancel"],setup(B,{emit:o}){const V=Te(),k=$(V.params.id),h=$(!1),s=$(!1),L=$(null),b=$(null),p=o;function u(i){if(Object.keys(Q().tabs).length>=X().planLimits.live_trading_tabs){F("error",`You have reached the limit of "${X().planLimits.live_trading_tabs}" tabs for your "${X().plan}" plan. Please upgrade your plan to add more tabs.`);return}Q().addTab(i)}function x(i){Ne().push(`/live/${i}`)}function I(i){if(!i.form.routes.length)return"New Tab";if(i.results.exception.error&&i.results.monitoring)return"ðŸ”´ Error";const m=i.form.routes[0];let y="";const U=i.form.exchange;return U&&(y+=`${U} â€¢ `),m.strategy&&(y+=`${m.strategy} â€¢ `),m.symbol&&(y+=`${m.symbol} â€¢ `),m.timeframe&&(y+=`${m.timeframe}`),y=y.endsWith(" â€¢ ")?y.slice(0,-3):y,i.results.monitoring&&!i.results.finished?`ðŸŸ¢ ${y}`:i.results.exception.error&&i.results.monitoring?`ðŸ”´ ${y}`:i.results.showResults?`${y} | Results`:y}function M(i){L.value=i.id,i.results.exception.error||i.results.finished||i.results.booting?h.value=!0:p("close",L.value)}return(i,m)=>{const y=Be,U=de,q=Ce;return a(),v("div",pt,[l("div",gt,[l("nav",vt,[(a(!0),v(Z,null,ue(i.tabs,f=>(a(),S(y,{key:f.id,class:"relative group min-w-0 flex-1 overflow-hidden text-center flex items-center",text:I(f),"open-delay":700,onMouseup:pe(N=>M(f),["middle"])},{default:w(()=>[l("div",{to:`/live/${f.id}`,class:ie([f.id===n(k)?"text-gray-900 dark:text-gray-100 font-bold ":"text-gray-500 dark:text-gray-300 hover:text-gray-700 font-medium ","whitespace-nowrap py-3 px-4 inline-block select-none cursor-pointer focus:outline-none w-full text-xs bg-gray-50 dark:bg-backdrop-dark"]),onClick:N=>x(f.id)},[l("span",null,D(I(f)),1),l("span",{"aria-hidden":"true",class:ie([f.id===n(k)&&Object.keys(i.tabs).length>1?"bg-indigo-400":"bg-transparent dark:bg-gray-600","absolute inset-x-0 bottom-0 h-0.5"])},null,2)],10,yt),(f.results.booting||f.results.monitoring)&&!f.results.finished?le((a(),v("button",{key:0,class:"absolute right-[0.5em] focus:outline-none",onClick:N=>{s.value=!0,b.value=f.id}},[r(n(ke),{class:"h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-200 bg-gray-100 dark:bg-gray-700 rounded-full","aria-hidden":"true"})],8,bt)),[[ae,Object.keys(i.tabs).length>1]]):le((a(),v("button",{key:1,class:"hidden md:block absolute right-[0.5em] focus:outline-none",onClick:N=>M(f)},[r(n(ye),{class:"h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-200 bg-gray-100 dark:bg-gray-700 rounded-full","aria-hidden":"true"})],8,ht)),[[ae,Object.keys(i.tabs).length>1]])]),_:2},1032,["text","onMouseup"]))),128)),r(y,{text:"New Tab",popper:{arrow:!0}},{default:w(()=>[l("div",{class:"select-none cursor-pointer text-gray-400 dark:text-gray-100 hover:text-gray-600 focus:outline-none group relative w-14 overflow-hidden bg-gray-50 dark:bg-backdrop-dark py-3 px-4 font-medium hover:bg-gray-50 dark:hover:bg-gray-800 flex items-center justify-center",onClick:m[0]||(m[0]=f=>u(i.currentTab))},[l("button",_t,[r(n(_e),{class:"h-6 w-6 rounded-full","aria-hidden":"true"})]),m[6]||(m[6]=l("span",{"aria-hidden":"true",class:"absolute inset-x-0 bottom-0 h-0.5 bg-transparent dark:bg-gray-600"},null,-1))])]),_:1})])]),l("div",kt,[l("div",xt,[l("div",$t,[l("div",wt,[(a(!0),v(Z,null,ue(i.tabs,f=>(a(),v("div",{key:f.id,class:ie([f.id===n(k)?"text-gray-900 dark:text-white font-semibold border-b-2 border-indigo-400":"text-gray-500 dark:text-gray-400","flex-shrink-0 py-3 px-4 text-sm relative cursor-pointer"]),onClick:N=>x(f.id)},[l("div",Ct,[l("span",Vt,D(I(f)),1),(f.results.booting||f.results.monitoring)&&!f.results.finished?le((a(),v("button",{key:0,class:"flex-shrink-0",onClick:pe(N=>{s.value=!0,b.value=f.id},["stop"])},[r(n(ke),{class:"h-4 w-4 text-gray-400"})],8,Lt)),[[ae,Object.keys(i.tabs).length>1]]):le((a(),v("button",{key:1,class:"flex-shrink-0",onClick:pe(N=>M(f),["stop"])},[r(n(ye),{class:"h-4 w-4 text-gray-400"})],8,St)),[[ae,Object.keys(i.tabs).length>1]])])],10,Tt))),128))])]),l("div",Pt,[l("button",{class:"flex-1 py-3 px-4 text-gray-500 dark:text-gray-400 text-center flex flex-col items-center gap-1",onClick:m[1]||(m[1]=f=>u(i.currentTab))},[r(n(_e),{class:"h-5 w-5"}),m[7]||(m[7]=l("span",{class:"text-xs"},"New Tab",-1))])])])]),r(q,{modelValue:n(s),"onUpdate:modelValue":m[3]||(m[3]=f=>H(s)?s.value=f:null),title:"Termination Confirm",description:"Are you sure you want to terminate this session?",type:"info"},{default:w(()=>[r(U,{variant:"solid",color:"red",class:"flex justify-center",label:"Terminate",onClick:m[2]||(m[2]=f=>{p("cancel",n(b)),s.value=!1})})]),_:1},8,["modelValue"]),r(q,{modelValue:n(h),"onUpdate:modelValue":m[5]||(m[5]=f=>H(h)?h.value=f:null),title:"Close Live Tab Confirm",description:"Are you sure you want to close this tab?","cancel-btn-content":"cancel",type:"info"},{default:w(()=>[r(U,{variant:"solid",color:"red",class:"flex justify-center",label:"Close",onClick:m[4]||(m[4]=f=>{p("close",n(L)),h.value=!1})})]),_:1},8,["modelValue"])])}}}),Et=G({__name:"LiveOrders",props:{orders:{}},setup(B){const o=B,V=C(()=>{if(!o.orders.length)return[];const k=[];for(let h=o.orders.length-1;h>=0;h--){const s=o.orders[h];k.push([{value:s.id.slice(-12),style:"text-xs",tooltip:s.id,tag:"code"},{value:z.timestampToTimeOnly(s.created_at),style:"text-xs",tooltip:z.timestampToTime(s.created_at)},{value:s.symbol,style:"text-xs"},{value:s.type,style:"text-xs"},{value:s.side,style:z.colorBasedOnSide(s.side)},{value:s.price,style:"text-xs"},{value:s.qty,style:z.colorBasedOnSide(s.side)},{value:s.status,style:"text-xs"}])}return k});return(k,h)=>{const s=Pe,L=Xe;return n(V).length?(a(),S(s,{key:0,data:n(V),"header-items":["ID","Created","Symbol","Type","Side","Price","QTY","Status"],header:""},null,8,["data"])):(a(),S(L,{key:1}))}}}),jt={class:"flex justify-end item-center"},Ut={class:"flex justify-end"},Mt=G({__name:"ReportLiveSession",props:{session:{}},emits:["close"],setup(B,{emit:o}){const V=o,k=$(!1),h=B,s=$({description:"",email:""}),L=()=>{V("close")},b=async()=>{if(k.value=!0,!s.value.description){F("error","Please enter a description."),k.value=!1;return}const{data:p,error:u}=await qe("/system/report-exception",{description:s.value.description,email:s.value.email,traceback:"manual report",mode:"live",attach_logs:!0,session_id:h.session},!0);if(k.value=!1,u.value&&u.value.statusCode!==200){F("error",`[${u.value.statusCode}]: ${u.value.statusText}`);return}const x=p.value;x.status==="success"?(s.value.description="",s.value.email="",F("success",x.message),L()):x.status==="error"&&F("error",x.message)};return(p,u)=>{const x=De,I=Le,M=Fe,i=de,m=ze;return a(),v(Z,null,[u[5]||(u[5]=l("p",null," If you think something is wrong with your running live session, you can submit a report. By submitting this form, the logs of this session will be sent to Jesse's developers so we can see what's going on. ",-1)),u[6]||(u[6]=l("br",null,null,-1)),u[7]||(u[7]=l("p",null,[Ve("Your exchange API keys and strategies are safe and "),l("b",null,"are never sent to us.")],-1)),u[8]||(u[8]=l("br",null,null,-1)),r(m,{state:n(s),class:"space-y-4",onSubmit:b},{default:w(()=>[r(I,{label:"Email (optional)",help:"Enter your email address for us to know who sent the email and possibly reply back to you."},{default:w(()=>[r(x,{modelValue:n(s).email,"onUpdate:modelValue":u[0]||(u[0]=y=>n(s).email=y),placeholder:"Email address...",type:"email"},null,8,["modelValue"])]),_:1}),u[3]||(u[3]=l("br",null,null,-1)),r(I,{label:"Description:",name:"Description"},{default:w(()=>[r(M,{modelValue:n(s).description,"onUpdate:modelValue":u[1]||(u[1]=y=>n(s).description=y),rows:10,placeholder:"Describe what you think is wrong in this session..."},null,8,["modelValue"])]),_:1}),u[4]||(u[4]=l("br",null,null,-1)),l("div",jt,[l("div",Ut,[r(i,{color:"gray",variant:"link",class:"mr-8",label:"Cancel",onClick:u[2]||(u[2]=y=>L())}),r(i,{type:"submit",class:"w-48 flex justify-center",label:"Submit",loading:n(k),disabled:n(k)},null,8,["loading","disabled"])])])]),_:1},8,["state"])],64)}}}),Rt={class:"mb-16"},At={key:0,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600 p-4"},Ot={key:1},Bt=G({__name:"CandlesChart",props:{form:{},results:{}},setup(B){const o=He(),V=C(()=>We().params.id),k=$(!0),h=$(2),s=B,L=$();let b=null,p=null;const u={orderEntries:{},positionEntry:null};let x=null,I=null;const M=C(()=>o.value),i=s.form.exchange,m=C(()=>`${i}-${s.results.selectedRoute.symbol}-${s.results.selectedRoute.timeframe}`),y=C(()=>s.results.currentCandles),U=C(()=>{const d=s.results.positions.find(g=>g[0].value===s.results.selectedRoute.symbol);return d===void 0?[]:d}),q=C(()=>U.value[2].value),f=C(()=>Number(U.value[1].value)>0?"long":Number(U.value[1].value)<0?"short":"close");Y(M,d=>{re(d)}),Y(q,(d,g)=>{p!==null&&d!==g&&te()}),Y(()=>s.results.orders,()=>{p!==null&&se()},{deep:!0}),Y(y,(d,g)=>{p!==null&&oe(d[m.value],d[m.value])}),Se(async()=>{I=setTimeout(async()=>{await N()},200)});async function N(){k.value=!0,await Q().fetchCandles(V.value),k.value=!1,await Ye();const d=L.value;if(!d)return;$e.width=d.clientWidth,b=nt(d,$e),b.applyOptions({watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${s.results.selectedRoute.symbol} â€¢ ${s.results.selectedRoute.timeframe}`}}),p=b.addCandlestickSeries();const g=(s.results.candles||[]).map(_=>{const A=ne(_==null?void 0:_.time);return A===null?null:{..._,time:A}}).filter(Boolean);if(p.setData(g),g.length>0){const _=g[g.length-1];x=_==null?void 0:_.time}else x=null;b.timeScale().fitContent(),p.applyOptions({priceFormat:{type:"price",precision:h.value,minMove:.01}}),oe(s.results.candles[0],s.results.candles[1]),te(),se(),re(M.value)}Ze(()=>{ee(),I&&(clearTimeout(I),I=null)});function ee(){b!==null&&(b.remove(),b=null),p&&(p=null),x=null}function te(){const d=f.value==="long"?"#00AB5C":"#FF497D";if(u.positionEntry&&p.removePriceLine(u.positionEntry),Number(q.value)>0){const g={price:Number(q.value),color:d,lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:"Entry Price"};u.positionEntry=p.createPriceLine(g)}}function se(){const d=U.value[0].value;for(const g in u.orderEntries)p.removePriceLine(u.orderEntries[g]),delete u.orderEntries[g];s.results.orders.forEach(g=>{const _=g.side==="buy"?"#00AB5C":"#FF497D",A=be.startCase(be.lowerCase(`${g.side} ${g.type}`));if((g.status==="ACTIVE"||g.status==="QUEUED")&&g.symbol===d){const R={price:Number(g.price),color:_,lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:A};u.orderEntries[g.id]=p.createPriceLine(R)}})}function oe(d,g){if(d===void 0)throw new TypeError("candle is undefined!");if(s.results.candles.length===0)return;const _=String(d.open).indexOf("."),A=_===-1?0:String(d.open).length-_-1,R=String(g.open).indexOf("."),e=R===-1?0:String(g.open).length-R-1,t=A>e?A:e;h.value=t,(h.value<0||h.value>100)&&(h.value=0),p.applyOptions({priceFormat:{type:"price",precision:h.value,minMove:Math.pow(10,-t).toFixed(t)}});const E=s.results.currentCandles[m.value];if(!E)return;const P=ne(E.time);if(P===null||x!==null&&P<x)return;const W={...E,time:P};p.update(W),x=P}function re(d){b!==null&&b.applyOptions(d==="light"?lt.chart:at.chart)}function ce(d){s.results.selectedRoute=d,ee(),N()}function ne(d){if(typeof d=="number")return d;if(d&&typeof d=="object"){if("year"in d&&"month"in d&&"day"in d){const{year:g,month:_,day:A}=d;return Math.floor(Date.UTC(g,_-1,A)/1e3)}if(d instanceof Date)return Math.floor(d.getTime()/1e3)}return null}return(d,g)=>{const _=rt,A=de;return a(),v("div",Rt,[n(k)?(a(),v("div",At,[r(_,{class:"h-4 w-full mb-4"}),r(_,{class:"h-4 w-2/3 mb-4"}),r(_,{class:"h-4 w-1/2 mb-4"}),r(_,{class:"h-4 w-full mb-4"}),r(_,{class:"h-4 w-full mb-4"}),r(_,{class:"h-4 w-2/3 mb-4"}),r(_,{class:"h-4 w-full mb-4"}),r(_,{class:"h-4 w-full"})])):T("",!0),l("div",{ref_key:"chartContainer",ref:L,class:ie({"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600":!n(k)})},null,2),s.form.routes.length>1?(a(),v("div",Ot,[(a(!0),v(Z,null,ue(s.form.routes,R=>(a(),S(A,{key:R.symbol,variant:"soft",color:"gray",disabled:d.results.selectedRoute.symbol===R.symbol&&d.results.selectedRoute.timeframe===R.timeframe,class:"mt-2 mr-2",onClick:e=>ce(R)},{default:w(()=>[Ve(D(R.symbol)+" â€¢ "+D(R.timeframe),1)]),_:2},1032,["disabled","onClick"]))),128))])):T("",!0)])}}}),Nt={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},zt=["textContent"],Dt={class:"mt-8"},Ft={key:1,class:"mx-auto container mt-8"},qt={key:0,"data-cy":"live-page-content"},Ht={class:"flex justify-between items-center"},Wt={class:"grid grid-cols-1 gap-6"},Yt={class:"flex justify-between items-center"},Zt={key:1},Qt={key:0,class:"mb-8"},Gt={key:0},Jt={key:0,class:"mt-8 lg:mt-0"},Kt={key:1,"data-cy":"live-action-button"},Xt={key:1,class:"my-8 border-2 dark:border-gray-600 rounded-full"},es={key:2,class:"bg-white dark:bg-gray-700 grid grid-cols-1 gap-6 border dark:border-gray-600 rounded py-4 px-6 select-none"},ts={class:"text-sm font-medium text-gray-500 dark:text-gray-400 truncate"},ss={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},os={class:"flex justify-between items-center"},rs={class:"flex justify-start items-center"},ns={class:"focus:outline-none flex justify-start items-center"},ls={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},as={class:"flex justify-between items-center"},is={class:"flex justify-start items-center"},us={class:"focus:outline-none flex justify-start items-center"},ds={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},cs={key:3},ms=G({__name:"LiveTab",props:{form:{},results:{},session:{},tabs:{}},setup(B){const o=B,V=$([]),k=$(!1),h=$(!1),s=$(!1),L=$(!1),b=$(!1),p=$(!1),u=$(!1),x=$(!1),I=$(!1),M=$(!1),i=X(),m=Q(),y=$([]);async function U(){if(!(o.results.monitoring||o.results.booting)){if(!o.form.paper_mode){const e=i.exchangeApiKeys.find(t=>t.id===o.form.exchange_api_key_id);e&&(o.form.exchange=e.exchange)}try{y.value=await X().getExchangeSupportedSymbols(o.form.exchange);for(let e=0;e<o.form.routes.length;e++)y.value.includes(o.form.routes[e].symbol)||(o.form.routes[e].symbol=y.value[0]);if(o.form.data_routes.length>0)for(let e=0;e<o.form.data_routes.length;e++)y.value.includes(o.form.data_routes[e].symbol)||(o.form.data_routes[e].symbol=y.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}}Se(async()=>{setTimeout(async()=>{o.form.exchange&&(!o.results.monitoring&&!o.results.booting||!y.value.length)&&await U()},200)}),Y(()=>o.form.exchange,async(e,t)=>{e!==t&&await U()}),Y(()=>o.results.monitoring,async e=>{e==!1&&await U()},{deep:!0}),Y(()=>o.form.exchange_api_key_id,async(e,t)=>{e!==t&&await U()});const q=C(()=>{const e=[{label:"Exchange",value:o.results.generalInfo.exchange},{label:"Current Time",value:z.timestampToTime(o.results.generalInfo.current_time)},{label:"Debug Mode",value:o.results.generalInfo.debug_mode},{label:"Paper Trade",value:o.results.generalInfo.paper_mode},{label:"PNL",value:`${o.results.generalInfo.pnl} (${o.results.generalInfo.pnl_perc}%)`},{label:"Started",value:z.timestampToTime(o.results.generalInfo.started_at)},{label:"Started/Current Balance",value:`${o.results.generalInfo.started_balance} / ${o.results.generalInfo.current_balance}`},{label:"Trades",value:`${o.results.generalInfo.count_trades}`}];return o.results.generalInfo.leverage_type!=="spot"&&(e.push({label:"Available Margin",value:`${o.results.generalInfo.available_margin}`}),e.push({label:"Leverage",value:`${o.results.generalInfo.leverage}x (${o.results.generalInfo.leverage_type})`})),e}),f=C(()=>i.notificationApiKeys.map(e=>({label:`${e.name} - ${e.driver}`,value:e.id}))),N=C(()=>Math.round(o.results.progressbar.estimated_remaining_seconds)===0?"Please wait...":`${Math.round(o.results.progressbar.estimated_remaining_seconds)} seconds remaining...`),ee=C(()=>{if(!o.results.orders)return[];const e=[],t=5,E=o.results.orders.length,P=E-t>=0?E-t:0;for(let W=E-1;W>=P;W--){const j=o.results.orders[W],O=j.status==="PARTIALLY FILLED"?`${j.filled_qty}/${j.qty}`:j.qty;e.push([{value:z.timestampToTimeOnly(j.created_at),style:"text-xs",tooltip:z.timestampToTime(j.created_at)},{value:j.symbol,style:"text-xs"},{value:j.type,style:"text-xs"},{value:j.side,style:z.colorBasedOnSide(j.side)},{value:j.price,style:"text-xs"},{value:O,style:z.colorBasedOnSide(j.side)},{value:j.status,style:"text-xs"}])}return e}),te=C(()=>{let e=[];const t=i.jesseSupportedTimeframes;return i.settings.live.generate_candles_from_1m||!o.form.exchange?e=t.map(E=>i.planLimits.timeframes.includes(E)?{label:E,value:E,disabled:!1}:{label:`${E} (Upgrade required)`,value:E,disabled:!0}):e=i.exchangeInfo[o.form.exchange].supported_timeframes.map(P=>i.planLimits.timeframes.includes(P)?{label:P,value:P,disabled:!1}:{label:`${P} (Upgrade required)`,value:P,disabled:!0}),e}),se=C(()=>i.liveTradingExchangeNames.map(e=>i.planLimits.exchanges.includes(e)?{label:e,value:e,disabled:!1}:{label:`${e} (Upgrade required)`,value:e,disabled:!0})),oe=C(()=>i.exchangeApiKeys.map(e=>i.planLimits.exchanges.includes(e.exchange)?{label:`${e.exchange} - ${e.name}`,value:e.id,disabled:!1}:{label:`${e.exchange} - ${e.name} (Upgrade required)`,value:e.id,disabled:!0})),re=m.cancel,ce=m.newLive;function ne(e){if(V.value.length){for(let t=0;t<V.value.length;t++)F("error",V.value[t]);return}if(o.form.paper_mode&&!o.form.exchange||!o.form.paper_mode&&o.form.exchange_api_key_id===""){F("error","Please select an exchange");return}m.start(e)}function d(e){m.closeTab(e)}function g(e){M.value=!1,m.stop(e)}function _(){h.value=!0,navigator.clipboard.writeText(o.results.infoLogs),F("success","Logs copied successfully"),L.value=!0,setTimeout(()=>{L.value=!1},3e3)}function A(){s.value=!0,navigator.clipboard.writeText(o.results.errorLogs),F("success","Logs copied successfully"),b.value=!0,setTimeout(()=>{b.value=!1},3e3)}const R=C(()=>["basic","pro","enterprise","basic-lifetime","pro-lifetime","enterprise-lifetime","lifetime"].includes(i.plan));return(e,t)=>{const E=Et,P=Qe,W=Mt,j=et,O=de,Ie=Ce,Ee=tt,ge=Ke,J=Ge,me=st,je=ot,ve=Je,Ue=Le,Me=Bt,fe=Pe,Re=ct,Ae=it,Oe=dt;return a(),v(Z,null,[r(P,{modelValue:n(p),"onUpdate:modelValue":t[0]||(t[0]=c=>H(p)?p.value=c:null),size:"ultra",title:"Orders"},{default:w(()=>[r(E,{orders:e.results.orders},null,8,["orders"])]),_:1},8,["modelValue"]),r(P,{modelValue:n(u),"onUpdate:modelValue":t[2]||(t[2]=c=>H(u)?u.value=c:null),size:"small",title:"Report An Issue"},{default:w(()=>[r(W,{session:e.session,onClose:t[1]||(t[1]=c=>u.value=!1)},null,8,["session"])]),_:1},8,["modelValue"]),r(P,{modelValue:n(x),"onUpdate:modelValue":t[3]||(t[3]=c=>H(x)?x.value=c:null),title:"Info Logs"},{default:w(()=>[r(j,{logs:e.results.infoLogs},null,8,["logs"])]),buttons:w(()=>[l("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:_},[n(L)?(a(),S(n(he),{key:0,class:"h-6 w-6","aria-hidden":"true"})):T("",!0),!n(L)&&e.results.infoLogs.length!=0?(a(),S(n(xe),{key:1,class:"h-6 w-6","aria-hidden":"true"})):T("",!0)])]),_:1},8,["modelValue"]),r(P,{modelValue:n(I),"onUpdate:modelValue":t[4]||(t[4]=c=>H(I)?I.value=c:null),title:"Error Logs"},{default:w(()=>[r(j,{logs:e.results.errorLogs},null,8,["logs"])]),buttons:w(()=>[l("button",{class:"ml-2 p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:A},[n(b)?(a(),S(n(he),{key:0,class:"h-6 w-6","aria-hidden":"true"})):T("",!0),!n(b)&&e.results.errorLogs.length!=0?(a(),S(n(xe),{key:1,class:"h-6 w-6","aria-hidden":"true"})):T("",!0)])]),_:1},8,["modelValue"]),r(Ie,{modelValue:n(M),"onUpdate:modelValue":t[6]||(t[6]=c=>H(M)?M.value=c:null),title:"Termination Confirm",description:"Are you sure you want to terminate this session?",type:"info"},{default:w(()=>[r(O,{variant:"solid",color:"red",class:"flex justify-center",label:"Terminate",onClick:t[5]||(t[5]=c=>g((e._.provides[K]||e.$route).params.id))})]),_:1},8,["modelValue"]),e.results.booting?(a(),v("div",Nt,[l("div",null,[r(Ee,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?T("",!0):(a(),v("h3",{key:0,class:"mt-8 animate-pulse",textContent:D(n(N))},null,8,zt)),l("div",Dt,[e.form.debug_mode?(a(),S(O,{key:0,icon:"i-heroicons-clipboard-document-list",variant:"solid",label:"View Logs",size:"xl",class:"flex justify-center w-64",onClick:t[7]||(t[7]=c=>x.value=!0)})):T("",!0),r(O,{color:"gray",class:"w-64 flex justify-center mt-4",size:"xl",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},icon:"i-heroicons-no-symbol",variant:"solid",label:"Cancel",trailing:!1,onClick:t[8]||(t[8]=c=>n(re)((e._.provides[K]||e.$route).params.id))})]),e.results.exception.error?(a(),v("div",Ft,[r(ge,{modelValue:n(k),"onUpdate:modelValue":t[9]||(t[9]=c=>H(k)?k.value=c:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"live","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):T("",!0)])):(a(),S(Oe,{key:1},{left:w(()=>[!e.results.booting&&!e.results.monitoring&&!e.results.showResults?(a(),v("div",qt,[r(J,{class:"mb-4",title:"Exchange"}),e.form.paper_mode?(a(),S(me,{key:0,modelValue:e.form.exchange,"onUpdate:modelValue":t[10]||(t[10]=c=>e.form.exchange=c),placeholder:"Select an exchange...",searchable:"",options:n(se),"value-attribute":"value",size:"lg",class:"mt-2 mb-16"},null,8,["modelValue","options"])):(a(),S(me,{key:1,modelValue:e.form.exchange_api_key_id,"onUpdate:modelValue":t[11]||(t[11]=c=>e.form.exchange_api_key_id=c),placeholder:"Select an exchange...",searchable:"",options:n(oe),"value-attribute":"value",size:"lg",class:"mt-2 mb-16"},{empty:w(()=>[l("div",Ht,[t[23]||(t[23]=l("span",null," No exchange API keys found. Please add at least one: ",-1)),r(O,{to:"/exchange-api-keys",icon:"i-heroicons-plus",type:"link",variant:"solid",size:"sm",label:"Add Exchange API Key"})])]),_:1},8,["modelValue","options"])),r(je,{"total-routes-error":n(V),form:e.form,results:e.results,mode:"live",symbols:n(y),timeframes:n(te)},null,8,["total-routes-error","form","results","symbols","timeframes"]),r(J,{class:"mt-16 mb-4",title:"Options"}),l("div",Wt,[r(ve,{modelValue:e.form.debug_mode,"onUpdate:modelValue":t[12]||(t[12]=c=>e.form.debug_mode=c),title:"Debug Mode",description:"Logs more details, helpful for debugging."},null,8,["modelValue"]),r(ve,{modelValue:e.form.paper_mode,"onUpdate:modelValue":t[13]||(t[13]=c=>e.form.paper_mode=c),title:"Paper Trade",disabled:!n(R),"disabled-guide":n(R)?"":"Premium plan required",description:"Trade in real-time using actual exchange data with PAPER money."},null,8,["modelValue","disabled","disabled-guide"]),r(Ue,{label:"Notifications:",help:"Select a notification driver to receive notifications"},{default:w(()=>[r(me,{modelValue:e.form.notification_api_key_id,"onUpdate:modelValue":t[14]||(t[14]=c=>e.form.notification_api_key_id=c),placeholder:"Select a notification driver",size:"lg",options:n(f),"value-attribute":"value"},{empty:w(()=>[l("div",Yt,[t[24]||(t[24]=l("span",null," No notification API keys found. Please add at least one: ",-1)),r(O,{to:"/notification-api-keys",icon:"i-heroicons-plus",type:"link",variant:"solid",size:"sm",label:"Add Notification API Key"})])]),_:1},8,["modelValue","options"])]),_:1})])])):T("",!0),e.results.monitoring?(a(),v("div",Zt,[e.results.exception.error?(a(),v("div",Qt,[r(ge,{title:e.results.exception.error,content:e.results.exception.traceback,mode:"live","debug-mode":e.form.debug_mode},null,8,["title","content","debug-mode"])])):T("",!0),e.results.displayTab&&e.results.monitoring&&!e.results.finished&&!e.results.exception.error?(a(),S(Me,{key:1,results:e.results,form:e.form,exchange:e.form.exchange},null,8,["results","form","exchange"])):T("",!0),r(J,{class:"mb-4",title:"Routes"}),r(fe,{data:e.results.routes,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),r(J,{class:"mt-12 mb-4",title:"Positions"}),r(fe,{data:e.results.positions,"header-items":["Symbol","QTY","Entry","Price","Liq Price","PNL"],header:""},null,8,["data"]),r(Re,{class:"mt-12 mb-4",title:"Orders"},{default:w(()=>[l("button",{type:"button",class:"inline-flex items-center shadow-sm px-4 py-1.5 border border-gray-300 dark:border-gray-900 text-sm leading-5 font-medium rounded-full text-gray-700 dark:text-gray-100 bg-white dark:bg-backdrop-dark hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none",onClick:t[15]||(t[15]=c=>p.value=!0)},[r(n(ft),{class:"-ml-1.5 mr-1 h-5 w-5 text-gray-400","aria-hidden":"true"}),t[25]||(t[25]=l("span",null,"More",-1))])]),_:1}),r(fe,{data:n(ee),"header-items":["Created","Symbol","Type","Side","Price","QTY","Status"],header:""},null,8,["data"])])):T("",!0)]),right:w(()=>[e.results.booting?T("",!0):(a(),v("div",Gt,[e.results.monitoring?(a(),v("div",Jt,[e.results.finished?(a(),S(O,{key:0,class:"w-full flex justify-center",variant:"solid",icon:"i-heroicons-plus",size:"xl",label:"New session",onClick:t[16]||(t[16]=c=>n(ce)((e._.provides[K]||e.$route).params.id))})):(a(),S(O,{key:1,class:"w-full flex justify-center",variant:"solid",color:"gray",icon:"i-heroicons-no-symbol",size:"xl",label:e.results.terminating?"Terminating...":"Terminate",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},onClick:t[17]||(t[17]=c=>M.value=!0)},null,8,["label"])),e.results.monitoring||e.results.finished?(a(),S(O,{key:2,class:"w-full flex justify-center mt-4",variant:"solid",color:"gray",icon:"i-heroicons-flag",size:"xl",label:"Report",onClick:t[18]||(t[18]=c=>u.value=!0)})):T("",!0)])):(a(),v("div",Kt,[r(O,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:t[19]||(t[19]=c=>ne((e._.provides[K]||e.$route).params.id))}),Object.keys(e.tabs).length>1?(a(),S(O,{key:0,class:"w-full md:hidden flex justify-center mt-2",icon:"i-heroicons-x-mark",size:"xl",variant:"solid",color:"gray",label:"Close Tab",trailing:!1,onClick:t[20]||(t[20]=c=>d((e._.provides[K]||e.$route).params.id))})):T("",!0)]))])),e.results.monitoring?(a(),v("hr",Xt)):T("",!0),e.results.monitoring?(a(),v("dl",es,[(a(!0),v(Z,null,ue(n(q),c=>(a(),v("div",{key:c.label,class:"flex justify-between items-center"},[l("div",ts,D(c.label)+":",1),l("div",ss,D(c.value),1)]))),128)),l("div",os,[l("div",rs,[l("button",{class:"text-sm font-medium text-gray-500 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300 truncate flex items-center hover:underline cursor-pointer focus:outline-none",onClick:t[21]||(t[21]=c=>x.value=!0)},[t[26]||(t[26]=l("span",null,"Info Logs:",-1)),l("span",ns,[r(n(we),{class:"w-6 h-6 ml-2"})])])]),l("div",ls,D(e.results.generalInfo.count_info_logs),1)]),l("div",as,[l("div",is,[l("button",{class:"text-sm font-medium text-gray-500 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300 truncate flex items-center hover:underline cursor-pointer focus:outline-none",onClick:t[22]||(t[22]=c=>I.value=!0)},[t[27]||(t[27]=l("span",null,"Error Logs:",-1)),l("span",us,[r(n(we),{class:"w-6 h-6 ml-2 cursor-pointer"})])])]),l("div",ds,D(e.results.generalInfo.count_error_logs),1)])])):T("",!0),e.results.monitoring&&Object.keys(e.results.watchlist).length?(a(),v("div",cs,[r(J,{class:"mt-8 mb-4",title:"Watch List"}),r(Ae,{data:e.results.watchlist[`${o.form.exchange}-${e.results.selectedRoute.symbol}-${e.results.selectedRoute.timeframe}`]||[]},null,8,["data"])])):T("",!0)]),_:1}))],64)}}}),fs={class:"w-full"},Ls=G({__name:"[id]",setup(B){mt({title:"Live/Paper trading - Jesse"});const o=Q(),V=C(()=>o.tabs),k=Te(),h=C(()=>k.params.id),s=C(()=>V.value[h.value]);(!Object.keys(s.value).includes("selectedRoute")||Object.keys(s.value.results.selectedRoute).length==0||L(s.value.results.selectedRoute,s.value.form.routes[0]))&&(s.value.results.selectedRoute=s.value.form.routes[0]),s.value.form.exchange==""&&(s.value.form.exchange=s.value.results.generalInfo.exchange),Object.keys(V.value).length===0&&Q().addTab();function L(b,p){return!b||!p?!1:b.symbol===p.symbol&&b.timeframe===p.timeframe&&b.strategy===p.strategy}return ut({w:()=>{const b=k.params.id;b&&o.closeTab(b)},ArrowLeft:()=>o.goToPrevTab(h.value),ArrowRight:()=>o.goToNextTab(h.value)}),(b,p)=>{const u=It,x=ms;return a(),v(Z,null,[l("div",fs,[r(u,{"current-tab":s.value?s.value.id:null,tabs:V.value,onClose:n(o).closeTab,onCancel:n(o).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),s.value?(a(),S(x,{key:0,form:s.value.form,results:s.value.results,session:h.value,tabs:V.value},null,8,["form","results","session","tabs"])):T("",!0)],64)}}});export{Ls as default};
