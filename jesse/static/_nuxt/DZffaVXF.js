import{d as Fe,x as Ee,r as c,H as Oe,w as A,U as qe,V as M,h as b,z as f,j as e,G as P,i as l,e as Ie,W as n,I as be,J as ke,f as g,X as U,t as Ge,k as Je,Y as We,_ as Qe,g as v,L as r,$ as Ce,a0 as C,a1 as Xe,q as Se,a2 as Ye,Q as Ke,s as L}from"./BZBcjETW.js";import{_ as Ze}from"./BfP20kJa.js";import{_ as et}from"./DMf59DGq.js";import{_ as tt}from"./G2FkG6uT.js";import{u as st}from"./D-92rLZE.js";import"./CBtiHpmx.js";const lt={class:"mt-4 md:mt-8 p-3 md:p-4"},at={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},ot={class:"flex items-center gap-3"},nt={class:"flex flex-col gap-3 sm:flex-row sm:items-center"},it={key:0,class:"space-y-4"},rt={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},dt={class:"divide-y divide-gray-200 dark:divide-gray-700"},ct={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},ut={class:"col-span-3"},mt={class:"col-span-2"},vt={class:"col-span-2 text-center"},_t={class:"col-span-2 text-center"},ft={class:"col-span-2"},gt={class:"col-span-1 flex justify-end gap-2"},pt={class:"md:hidden space-y-3"},ht={class:"flex items-start justify-between"},xt={class:"flex-1"},yt={class:"flex items-center justify-between"},wt={class:"flex items-center justify-between"},bt={class:"flex gap-1"},kt={key:1,class:"space-y-4"},Ct={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},St={class:"divide-y divide-gray-200 dark:divide-gray-700"},Vt=["onClick"],Mt={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},Ut={class:"col-span-3"},$t={class:"text-sm font-medium text-gray-900 dark:text-white"},zt={class:"text-xs text-gray-500 dark:text-gray-400"},Nt={class:"col-span-2"},Tt={class:"text-sm text-gray-700 dark:text-gray-300"},jt={class:"text-xs text-gray-500 dark:text-gray-400"},Dt={class:"col-span-1 text-center"},Rt={class:"text-lg"},At={class:"col-span-1 text-center"},Pt={class:"text-sm"},Lt={class:"col-span-1 text-center"},Bt={class:"col-span-3 text-sm text-center text-gray-500 dark:text-gray-400"},Ht={class:"col-span-1 flex justify-end gap-2"},Ft={class:"md:hidden space-y-3"},Et={class:"flex items-start justify-between"},Ot={class:"flex-1 min-w-0"},qt={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},It={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Gt={class:"flex justify-end"},Jt={class:"text-sm text-gray-500 dark:text-gray-400"},Wt={class:"flex items-center justify-between text-sm"},Qt={class:"flex items-center gap-3"},Xt={class:"text-gray-700 dark:text-gray-300 font-medium"},Yt={class:"text-gray-500 dark:text-gray-400 text-xs ml-1"},Kt={class:"text-lg"},Zt={class:"flex items-center justify-between"},es={class:"text-xs text-gray-500 dark:text-gray-400"},ts={class:"flex gap-1"},ss={key:0,class:"flex justify-center"},ls={key:2,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center"},as={class:"p-4"},os={class:"flex justify-end gap-3"},ns={class:"p-6"},is={class:"mb-6"},rs={class:"flex justify-end gap-3"},$=50,gs=Fe({__name:"history",setup(ds){st({title:"Monte Carlo History - Jesse"});const Ve=Ee(),u=c([]),p=c(!1),h=c(null),S=c(!1),z=c(!1),N=c(!0),_=c(0),V=c(!1),m=c(null),x=c(!1),T=c(!1),y=c(30),d=c({title:"",status:"all",dateRange:"all_time"}),Me=[{label:"All Statuses",value:"all"},{label:"Running",value:"running"},{label:"Finished",value:"finished"},{label:"Stopped",value:"stopped"},{label:"Terminated",value:"terminated"}],Ue=[{label:"All Time",value:"all_time"},{label:"Last 7 Days",value:"7_days"},{label:"Last 30 Days",value:"30_days"},{label:"Last 90 Days",value:"90_days"}],$e=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"3 months",value:90},{label:"6 months",value:180},{label:"1 year",value:365},{label:"2 years",value:730},{label:"All existing sessions",value:-1}];Oe(()=>{setTimeout(()=>{k()},20)});const ze=qe(()=>{_.value=0,k()},300);A(()=>d.value.title,()=>{ze()}),A(()=>d.value.status,()=>{_.value=0,k()}),A(()=>d.value.dateRange,()=>{_.value=0,k()});async function k(){var a;S.value=!0;try{const o=(await M("/monte-carlo/sessions",{limit:$,offset:0,title_search:d.value.title||null,status_filter:d.value.status||null,date_filter:d.value.dateRange||null},!0)).data.value;u.value=(o==null?void 0:o.sessions)||[],_.value=u.value.length,N.value=((a=o==null?void 0:o.sessions)==null?void 0:a.length)===$}catch(t){b(t)}finally{S.value=!1}}async function Ne(){z.value=!0;try{const t=(await M("/monte-carlo/sessions",{limit:$,offset:_.value,title_search:d.value.title||null,status_filter:d.value.status||null,date_filter:d.value.dateRange||null},!0)).data.value,o=(t==null?void 0:t.sessions)||[];u.value=[...u.value,...o],_.value+=o.length,N.value=o.length===$}catch(a){b(a)}finally{z.value=!1}}function B(a){switch(a.toLowerCase()){case"running":return"blue";case"finished":return"green";case"stopped":return"red";case"terminated":return"yellow";default:return"gray"}}async function j(a){await Ke(`/monte-carlo/${a}`)}function H(a){h.value=a,p.value=!0}async function Te(){h.value&&(await De(h.value),u.value=u.value.filter(a=>a.id!==h.value),_.value-=1),p.value=!1,h.value=null}function je(){p.value=!1,h.value=null}async function De(a){if(a===Ve.form.id){L("error","Cannot delete the current session.");return}try{const t=await M(`/monte-carlo/sessions/${a}/remove`,{},!0);if(t.error.value){b(t.error.value);return}L("success","Session deleted successfully")}catch(t){b(t)}}function F(a){m.value=a,V.value=!0}async function Re(){T.value=!0;try{const a=await M("/monte-carlo/purge-sessions",{days_old:y.value===-1?null:y.value},!0);if(a.error.value){b(a.error.value);return}const t=a.data.value;L("success",`Successfully purged ${t.deleted_count} session(s)`),x.value=!1,_.value=0,await k()}catch(a){b(a)}finally{T.value=!1}}function Ae(){x.value=!1,y.value=30}function Pe(a){if(m.value){const t=u.value.find(o=>o.id===m.value.id);t&&(t.title=a.title,t.description=a.description,m.value.title=a.title,m.value.description=a.description)}}return(a,t)=>{const o=Ge,Le=Je,D=We,i=Ze,E=et,R=Xe,O=Qe,Be=tt,He=Ye;return v(),f("div",null,[e("div",lt,[e("div",at,[e("div",ot,[t[9]||(t[9]=e("h1",{class:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white"}," Monte Carlo History ",-1)),l(o,{icon:"i-heroicons-trash",color:"red",variant:"soft",size:"sm",label:"Purge",onClick:t[0]||(t[0]=s=>x.value=!0)})]),e("div",nt,[l(Le,{modelValue:n(d).title,"onUpdate:modelValue":t[1]||(t[1]=s=>n(d).title=s),placeholder:"Search by title...",icon:"i-heroicons-magnifying-glass",size:"sm",class:"w-full sm:w-64"},null,8,["modelValue"]),l(D,{modelValue:n(d).status,"onUpdate:modelValue":t[2]||(t[2]=s=>n(d).status=s),options:Me,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),l(D,{modelValue:n(d).dateRange,"onUpdate:modelValue":t[3]||(t[3]=s=>n(d).dateRange=s),options:Ue,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"])])]),n(S)?(v(),f("div",it,[e("div",rt,[e("div",dt,[(v(),f(be,null,ke(5,s=>e("div",{key:s,class:"p-4"},[e("div",ct,[e("div",ut,[l(i,{class:"h-4 w-full mb-2"}),l(i,{class:"h-3 w-2/3"})]),e("div",mt,[l(i,{class:"h-4 w-full mb-2"}),l(i,{class:"h-3 w-2/3"})]),e("div",vt,[l(i,{class:"h-4 w-16 mx-auto"})]),e("div",_t,[l(i,{class:"h-6 w-20 mx-auto"})]),e("div",ft,[l(i,{class:"h-4 w-full"})]),e("div",gt,[l(i,{class:"h-8 w-8"}),l(i,{class:"h-8 w-8"}),l(i,{class:"h-8 w-8"})])]),e("div",pt,[e("div",ht,[e("div",xt,[l(i,{class:"h-4 w-3/4 mb-2"}),l(i,{class:"h-3 w-1/2"})]),l(i,{class:"h-6 w-16 ml-2"})]),e("div",yt,[l(i,{class:"h-4 w-24"}),l(i,{class:"h-4 w-16"})]),e("div",wt,[l(i,{class:"h-3 w-32"}),e("div",bt,[l(i,{class:"h-8 w-8"}),l(i,{class:"h-8 w-8"}),l(i,{class:"h-8 w-8"})])])])])),64))])])])):n(u).length?(v(),f("div",kt,[e("div",Ct,[e("div",St,[(v(!0),f(be,null,ke(n(u),s=>{var q,I,G,J,W,Q,X,Y,K,Z,ee,te,se,le,ae,oe,ne,ie,re,de,ce,ue,me,ve,_e,fe,ge,pe,he,xe,ye,we;return v(),f("div",{key:s.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer",onClick:w=>j(s.id)},[e("div",Mt,[e("div",Ut,[e("div",$t,r(s.title||((J=(G=(I=(q=s.state)==null?void 0:q.form)==null?void 0:I.routes)==null?void 0:G[0])==null?void 0:J.strategy)||"Unknown Strategy"),1),e("div",zt,r(((Q=(W=s.state)==null?void 0:W.form)==null?void 0:Q.exchange)||"Unknown Exchange"),1)]),e("div",Nt,[e("div",Tt,r(((Z=(K=(Y=(X=s.state)==null?void 0:X.form)==null?void 0:Y.routes)==null?void 0:K[0])==null?void 0:Z.symbol)||"N/A"),1),e("div",jt,r(((le=(se=(te=(ee=s.state)==null?void 0:ee.form)==null?void 0:te.routes)==null?void 0:se[0])==null?void 0:le.timeframe)||"N/A"),1)]),e("div",Dt,[e("span",Rt,r(s.has_trades?"ðŸ”€":"")+" "+r(s.has_candles?"ðŸ“ˆ":""),1)]),e("div",At,[e("span",Pt,r((oe=(ae=s.state)==null?void 0:ae.form)==null?void 0:oe.num_scenarios),1)]),e("div",Lt,[l(E,{color:B(s.status),label:s.status,variant:"soft",size:"sm"},null,8,["color","label"])]),e("div",Bt,r(n(Ce).timestampToReadableDateTime(s.updated_at)),1),e("div",Ht,[l(R,{text:"Add Note",popper:{arrow:!0}},{default:g(()=>[l(o,{icon:"i-heroicons-pencil-square",variant:"ghost",size:"sm",color:"gray",onClick:C(w=>F(s),["stop"])},null,8,["onClick"])]),_:2},1024),l(R,{text:"Load Session",popper:{arrow:!0}},{default:g(()=>[l(o,{icon:"i-heroicons-arrow-right",variant:"ghost",size:"sm",color:"gray",onClick:w=>j(s.id)},null,8,["onClick"])]),_:2},1024),l(R,{text:"Delete",popper:{arrow:!0}},{default:g(()=>[l(o,{icon:"i-heroicons-trash",variant:"ghost",size:"sm",color:"red",onClick:C(w=>H(s.id),["stop"])},null,8,["onClick"])]),_:2},1024)])]),e("div",Ft,[e("div",Et,[e("div",Ot,[e("div",qt,r(s.title||((de=(re=(ie=(ne=s.state)==null?void 0:ne.form)==null?void 0:ie.routes)==null?void 0:re[0])==null?void 0:de.strategy)||"Unknown Strategy"),1),e("div",It,r(((ue=(ce=s.state)==null?void 0:ce.form)==null?void 0:ue.exchange)||"Unknown Exchange"),1)]),e("div",Gt,[e("span",Jt,r((ve=(me=s.state)==null?void 0:me.form)==null?void 0:ve.num_scenarios)+" - ",1),l(E,{color:B(s.status),label:s.status,variant:"soft",size:"sm",class:"ml-2 flex-shrink-0"},null,8,["color","label"])])]),e("div",Wt,[e("div",Qt,[e("div",null,[e("span",Xt,r(((pe=(ge=(fe=(_e=s.state)==null?void 0:_e.form)==null?void 0:fe.routes)==null?void 0:ge[0])==null?void 0:pe.symbol)||"N/A"),1),e("span",Yt,r(((we=(ye=(xe=(he=s.state)==null?void 0:he.form)==null?void 0:xe.routes)==null?void 0:ye[0])==null?void 0:we.timeframe)||"N/A"),1)])]),e("span",Kt,r(s.has_trades?"ðŸ”€":"")+" "+r(s.has_candles?"ðŸ“ˆ":""),1)]),e("div",Zt,[e("div",es,r(n(Ce).timestampToReadableDateTime(s.updated_at)),1),e("div",ts,[l(o,{icon:"i-heroicons-pencil-square",variant:"ghost",size:"sm",color:"gray",onClick:C(w=>F(s),["stop"])},null,8,["onClick"]),l(o,{icon:"i-heroicons-arrow-right",variant:"ghost",size:"sm",color:"gray",onClick:C(w=>j(s.id),["stop"])},null,8,["onClick"]),l(o,{icon:"i-heroicons-trash",variant:"ghost",size:"sm",color:"red",onClick:C(w=>H(s.id),["stop"])},null,8,["onClick"])])])])],8,Vt)}),128))])]),n(N)?(v(),f("div",ss,[l(o,{label:"Load More",variant:"soft",color:"gray",loading:n(z),onClick:Ne},null,8,["loading"])])):P("",!0)])):!n(S)&&n(u).length===0?(v(),f("div",ls,t[10]||(t[10]=[e("div",{class:"text-gray-400 dark:text-gray-500"},[e("i",{class:"i-heroicons-clock h-12 w-12 mx-auto mb-4"}),e("p",{class:"text-lg"},"No Monte Carlo history found"),e("p",{class:"text-sm mt-2"},"Run a Monte Carlo simulation or change filters to see items in your history")],-1)]))):P("",!0),l(O,{modelValue:n(p),"onUpdate:modelValue":t[4]||(t[4]=s=>U(p)?p.value=s:null)},{default:g(()=>[e("div",as,[t[13]||(t[13]=e("h3",{class:"text-lg font-medium leading-6 text-gray-900 dark:text-white mb-4"}," Confirm Deletion ",-1)),t[14]||(t[14]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6"}," Are you sure you want to delete this Monte Carlo session? This action cannot be undone. ",-1)),e("div",os,[l(o,{color:"gray",variant:"ghost",onClick:je},{default:g(()=>t[11]||(t[11]=[Se(" Cancel ")])),_:1}),l(o,{color:"red",onClick:Te},{default:g(()=>t[12]||(t[12]=[Se(" Delete ")])),_:1})])])]),_:1},8,["modelValue"]),n(m)?(v(),Ie(Be,{key:3,modelValue:n(V),"onUpdate:modelValue":t[5]||(t[5]=s=>U(V)?V.value=s:null),"session-id":n(m).id,"initial-title":n(m).title,"initial-description":n(m).description,"initial-strategy-codes":n(m).strategy_codes,onSaved:t[6]||(t[6]=s=>Pe({title:"",description:""}))},null,8,["modelValue","session-id","initial-title","initial-description","initial-strategy-codes"])):P("",!0),l(O,{modelValue:n(x),"onUpdate:modelValue":t[8]||(t[8]=s=>U(x)?x.value=s:null)},{default:g(()=>[e("div",ns,[t[17]||(t[17]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Purge Monte Carlo Sessions ",-1)),e("div",is,[t[15]||(t[15]=e("div",{class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4"},[e("div",{class:"flex items-start gap-3"},[e("i",{class:"i-heroicons-exclamation-triangle text-red-600 dark:text-red-400 text-xl flex-shrink-0 mt-0.5"}),e("div",{class:"text-sm text-red-800 dark:text-red-200"},[e("p",{class:"font-semibold mb-1"}," Warning: This action is permanent! "),e("p",null,"Deleted sessions cannot be recovered. Please select carefully.")])])],-1)),l(He,{label:"Delete sessions older than:",class:"mb-4"},{default:g(()=>[l(D,{modelValue:n(y),"onUpdate:modelValue":t[7]||(t[7]=s=>U(y)?y.value=s:null),options:$e,size:"md"},null,8,["modelValue"])]),_:1}),t[16]||(t[16]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," This will permanently delete all Monte Carlo sessions that match your criteria. ",-1))]),e("div",rs,[l(o,{color:"gray",variant:"ghost",label:"Cancel",onClick:Ae}),l(o,{color:"red",label:"Purge Sessions",loading:n(T),onClick:Re},null,8,["loading"])])])]),_:1},8,["modelValue"])])])}}});export{gs as default};
