import{d as L,r as m,c as j,J as ie,C as b,i as s,f as _,x as n,D as S,g as v,j as t,v as re,t as I,G as C,a6 as de,a4 as ue,S as ce,B as me,w as F,a7 as _e,h as O,e as pe,E as R,F as ve,O as fe,k as ye,a9 as ge,aa as xe,_ as he,ab as be,a8 as we,s as A,I as ke}from"./CtRP3raE.js";import{_ as Se}from"./DummNIKF.js";import{_ as ze}from"./8f4YHL2u.js";import{_ as $e}from"./qiyS4XnV.js";import{_ as Ve}from"./B16Tb-Zj.js";import{u as Ce}from"./B71Uh9Gv.js";import"./BtsPTqgu.js";import"./MwrR5ziO.js";const Ue={class:"bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-sm"},De={class:"flex flex-col"},Te={class:"font-medium text-gray-900 dark:text-white truncate"},Oe={class:"text-sm text-gray-500 dark:text-gray-400"},Me={class:"flex flex-col items-center"},Ne={class:"text-sm font-medium text-gray-900 dark:text-white"},je={class:"flex justify-center"},qe={class:"flex justify-center"},Be={key:0,class:"text-sm font-medium text-gray-900 dark:text-white"},Fe={key:1,class:"text-sm text-gray-400 dark:text-gray-500"},Pe={class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"flex items-center justify-end gap-1"},Ae=L({__name:"OptimizationSessionsTable",props:{sessions:{}},emits:["notes","load","delete"],setup(P){const w=P,z=m({column:"updated_at",direction:"desc"}),D=[{key:"strategy",label:"Strategy"},{key:"progress",label:"Progress",class:"text-center"},{key:"status",label:"Status",class:"text-center"},{key:"best_score",label:"Best Score",class:"text-center"},{key:"updated_at",label:"Date",sortable:!0},{key:"actions",label:"",class:"w-32 text-right"}],d=j(()=>w.sessions.map(o=>{var p,k,c,u,f,l;return{id:o.id,title:o.title,strategy:((u=(c=(k=(p=o.state)==null?void 0:p.form)==null?void 0:k.routes)==null?void 0:c[0])==null?void 0:u.strategy)||"N/A",exchange:((l=(f=o.state)==null?void 0:f.form)==null?void 0:l.exchange)||"N/A",completed_trials:o.completed_trials||0,total_trials:o.total_trials||0,status:o.status,best_score:o.best_score,updated_at:ie.timestampToReadableDateTime(o.updated_at),rawSession:o}}));function $(o){switch(o){case"finished":return"green";case"running":return"blue";case"stopped":return"red";case"terminated":return"yellow";default:return"gray"}}return(o,p)=>{const k=ze,c=I,u=re,f=$e;return v(),b("div",Ue,[s(f,{sort:n(z),"onUpdate:sort":p[0]||(p[0]=l=>S(z)?z.value=l:null),rows:n(d),columns:D,class:"w-full",ui:{td:{base:"whitespace-nowrap"},th:{base:"whitespace-nowrap"}}},{"strategy-data":_(({row:l})=>[t("div",De,[t("span",Te,C(l.title||l.strategy||"Untitled"),1),t("span",Oe,C(l.exchange),1)])]),"progress-data":_(({row:l})=>[t("div",Me,[t("span",Ne,C(l.completed_trials)+" / "+C(l.total_trials),1),p[1]||(p[1]=t("span",{class:"text-xs text-gray-500 dark:text-gray-400"}," trials ",-1))])]),"status-data":_(({row:l})=>[t("div",je,[s(k,{color:$(l.status),label:l.status,variant:"soft",size:"xs"},null,8,["color","label"])])]),"best_score-data":_(({row:l})=>[t("div",qe,[l.best_score!==null&&l.best_score!==void 0?(v(),b("span",Be,C(typeof l.best_score=="number"?l.best_score.toFixed(2):l.best_score),1)):(v(),b("span",Fe," N/A "))])]),"updated_at-data":_(({row:l})=>[t("span",Pe,C(l.updated_at),1)]),"actions-data":_(({row:l})=>[t("div",Re,[s(u,{text:"Add Note"},{default:_(()=>[s(c,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-pencil-square",onClick:y=>o.$emit("notes",l.rawSession)},null,8,["onClick"])]),_:2},1024),s(u,{text:"Load Session"},{default:_(()=>[s(c,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-arrow-right",onClick:y=>o.$emit("load",l.id)},null,8,["onClick"])]),_:2},1024),s(u,{text:"Delete"},{default:_(()=>[s(c,{size:"xs",variant:"ghost",color:"red",icon:"i-heroicons-trash",onClick:y=>o.$emit("delete",l.id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["sort","rows"])])}}}),Le={class:"container mx-auto px-4 pt-16 pb-6 max-w-7xl"},Ie={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},He={class:"flex items-center gap-3"},Ee={class:"flex flex-col gap-3 sm:flex-row sm:items-center"},Ge={key:0,class:"space-y-4"},Je={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},We={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ke={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},Qe={class:"col-span-3"},Xe={class:"col-span-2 text-center"},Ye={class:"col-span-2 text-center"},Ze={class:"col-span-2 text-center"},et={class:"col-span-2"},tt={class:"col-span-1 flex justify-end gap-2"},st={class:"md:hidden space-y-3"},lt={class:"flex items-start justify-between"},at={class:"flex-1"},ot={class:"flex items-center justify-between"},nt={class:"flex items-center justify-between"},it={class:"flex gap-1"},rt={key:1,class:"space-y-4"},dt={key:0,class:"flex justify-center"},ut={key:2,class:"text-center py-12"},ct={class:"text-gray-400 dark:text-gray-500 text-sm"},mt={class:"p-6"},_t={class:"mb-6"},pt={class:"flex justify-end gap-3"},M=50,kt=L({__name:"history",setup(P){Ce({title:"Optimization History - Jesse"});const w=de(),z=ue(),D=ce(),d=m([]),$=m(!1),o=m(null),p=m(!1),k=m(!1),c=m(!0),u=m(0),f=m(!1),l=m(null),y=m(!1),q=m(!1),U=m(30),V=j({get:()=>w.query.title||"",set:a=>{const e={...w.query};a?e.title=a:delete e.title,z.push({query:e})}}),g=j({get:()=>w.query.status||"all",set:a=>{const e={...w.query};a==="all"?delete e.status:e.status=a,z.push({query:e})}}),x=j({get:()=>w.query.dateRange||"all_time",set:a=>{const e={...w.query};a==="all_time"?delete e.dateRange:e.dateRange=a,z.push({query:e})}}),H=[{label:"All Statuses",value:"all"},{label:"Running",value:"running"},{label:"Finished",value:"finished"},{label:"Terminated",value:"terminated"},{label:"Stopped",value:"stopped"}],E=[{label:"All Time",value:"all_time"},{label:"Last 7 Days",value:"7_days"},{label:"Last 30 Days",value:"30_days"},{label:"Last 90 Days",value:"90_days"}],G=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"3 months",value:90},{label:"6 months",value:180},{label:"1 year",value:365},{label:"2 years",value:730},{label:"All existing sessions",value:-1}];me(()=>{setTimeout(()=>{T()},20)});const J=_e(()=>{u.value=0,d.value=[],c.value=!0,T()},300);F(V,()=>{J()}),F(g,()=>{u.value=0,d.value=[],c.value=!0,T()}),F(x,()=>{u.value=0,d.value=[],c.value=!0,T()});async function T(){p.value=!0;try{const a=await D.getSessions(M,u.value,{title_search:V.value||void 0,status_filter:g.value==="all"?void 0:g.value,date_filter:x.value==="all_time"?void 0:x.value});u.value===0?d.value=a:d.value.push(...a),c.value=a.length===M}catch(a){O(a)}finally{p.value=!1}}async function W(){k.value=!0,u.value+=M;try{const a=await D.getSessions(M,u.value,{title_search:V.value||void 0,status_filter:g.value==="all"?void 0:g.value,date_filter:x.value==="all_time"?void 0:x.value});d.value.push(...a),c.value=a.length===M}catch(a){O(a)}finally{k.value=!1}}function K(a){o.value=a,$.value=!0}async function Q(){if(o.value)try{const{data:a,error:e}=await we(`/optimization/sessions/${o.value}/remove`,{},!0);if(e.value){O(e.value);return}d.value=d.value.filter(h=>h.id!==o.value),A("success","Session deleted successfully"),$.value=!1,o.value=null}catch(a){O(a)}}async function X(a){await ke(`/optimization/${a}`)}function Y(a){l.value=a,f.value=!0}async function Z(a){if(l.value){l.value.title=a.title,l.value.description=a.description;const e=d.value.findIndex(h=>{var N;return h.id===((N=l.value)==null?void 0:N.id)});e!==-1&&(d.value[e]={...l.value})}}async function ee(){q.value=!0;try{const a=U.value===-1?null:U.value,e=await D.purgeOptimizationSessions(a);e.success&&(A("success",`Successfully purged ${e.deleted_count} session(s)`),y.value=!1,u.value=0,d.value=[],c.value=!0,await T())}catch(a){O(a)}finally{q.value=!1}}function te(){y.value=!1,U.value=30}return(a,e)=>{const h=I,N=ye,B=ge,i=Se,se=Ae,le=xe,ae=Ve,oe=be,ne=he;return v(),b("div",null,[e[13]||(e[13]=t("div",{class:"w-full"},null,-1)),t("div",Le,[t("div",Ie,[t("div",He,[e[8]||(e[8]=t("h1",{class:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white"}," Optimization History ",-1)),s(h,{icon:"i-heroicons-trash",color:"red",variant:"soft",size:"sm",label:"Purge",onClick:e[0]||(e[0]=r=>y.value=!0)})]),t("div",Ee,[s(N,{modelValue:n(V),"onUpdate:modelValue":e[1]||(e[1]=r=>S(V)?V.value=r:null),placeholder:"Search by title...",icon:"i-heroicons-magnifying-glass",size:"sm",class:"w-full sm:w-64"},null,8,["modelValue"]),s(B,{modelValue:n(g),"onUpdate:modelValue":e[2]||(e[2]=r=>S(g)?g.value=r:null),options:H,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),s(B,{modelValue:n(x),"onUpdate:modelValue":e[3]||(e[3]=r=>S(x)?x.value=r:null),options:E,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"])])]),n(p)?(v(),b("div",Ge,[t("div",Je,[t("div",We,[(v(),b(ve,null,fe(5,r=>t("div",{key:r,class:"p-4"},[t("div",Ke,[t("div",Qe,[s(i,{class:"h-4 w-full mb-2"}),s(i,{class:"h-3 w-2/3"})]),t("div",Xe,[s(i,{class:"h-4 w-full mb-2"}),s(i,{class:"h-3 w-2/3 mx-auto"})]),t("div",Ye,[s(i,{class:"h-6 w-20 mx-auto"})]),t("div",Ze,[s(i,{class:"h-4 w-16 mx-auto"})]),t("div",et,[s(i,{class:"h-4 w-full"})]),t("div",tt,[s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"})])]),t("div",st,[t("div",lt,[t("div",at,[s(i,{class:"h-4 w-3/4 mb-2"}),s(i,{class:"h-3 w-1/2"})]),s(i,{class:"h-6 w-16 ml-2"})]),t("div",ot,[s(i,{class:"h-4 w-24"}),s(i,{class:"h-4 w-16"})]),t("div",nt,[s(i,{class:"h-3 w-32"}),t("div",it,[s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"})])])])])),64))])])])):n(d).length>0?(v(),b("div",rt,[s(se,{sessions:n(d),onNotes:Y,onLoad:X,onDelete:K},null,8,["sessions"]),n(c)?(v(),b("div",dt,[s(h,{label:"Load More",icon:"i-heroicons-arrow-down",color:"gray",variant:"soft",size:"lg",loading:n(k),onClick:W},null,8,["loading"])])):R("",!0)])):(v(),b("div",ut,[e[9]||(e[9]=t("div",{class:"text-gray-400 dark:text-gray-500 text-lg mb-2"}," No optimization sessions found ",-1)),t("div",ct,C(n(V)||n(g)!=="all"||n(x)!=="all_time"?"Try adjusting your filters":"Start an optimization to see results here"),1)])),s(le,{modelValue:n($),"onUpdate:modelValue":e[4]||(e[4]=r=>S($)?$.value=r:null),title:"Delete Optimization Session",description:"Are you sure you want to delete this optimization session? This action cannot be undone.",type:"info"},{default:_(()=>[s(h,{variant:"solid",color:"red",block:"",class:"sm:w-auto",label:"Delete",onClick:Q})]),_:1},8,["modelValue"]),n(l)?(v(),pe(ae,{key:3,modelValue:n(f),"onUpdate:modelValue":e[5]||(e[5]=r=>S(f)?f.value=r:null),"session-id":n(l).id,"initial-title":n(l).title,"initial-description":n(l).description,onSaved:Z},null,8,["modelValue","session-id","initial-title","initial-description"])):R("",!0),s(ne,{modelValue:n(y),"onUpdate:modelValue":e[7]||(e[7]=r=>S(y)?y.value=r:null)},{default:_(()=>[t("div",mt,[t("div",_t,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold mb-2"},"Purge Optimization Sessions",-1)),e[11]||(e[11]=t("div",{class:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4"},[t("div",{class:"flex"},[t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),t("div",{class:"ml-3"},[t("h3",{class:"text-sm font-medium text-yellow-800 dark:text-yellow-200"},"Warning"),t("p",{class:"mt-1 text-sm text-yellow-700 dark:text-yellow-300"}," This action will permanently delete optimization sessions and cannot be undone. "),t("p",null,"Deleted sessions cannot be recovered. Please select carefully.")])])],-1)),s(oe,{label:"Delete sessions older than:",class:"mb-4"},{default:_(()=>[s(B,{modelValue:n(U),"onUpdate:modelValue":e[6]||(e[6]=r=>S(U)?U.value=r:null),options:G,size:"md"},null,8,["modelValue"])]),_:1}),e[12]||(e[12]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," This will permanently delete all optimization sessions that match your criteria. ",-1))]),t("div",pt,[s(h,{color:"gray",variant:"ghost",label:"Cancel",onClick:te}),s(h,{color:"red",label:"Purge Sessions",loading:n(q),onClick:ee},null,8,["loading"])])])]),_:1},8,["modelValue"])])])}}});export{kt as default};
