import{_ as H}from"./BBSocZrR.js";import{d as T,r as A,c as b,C as c,i,f as n,x as f,D as U,g as o,j as a,F as v,e as p,E as x,v as P,t as L,q as V,G as l,H as h,I as D}from"./B4BPTRlB.js";import{_ as w}from"./C0-a_pR3.js";const E={class:"bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-sm"},F={key:0,class:"flex justify-center"},R={key:1,class:"flex items-center gap-2"},q={class:"text-xs font-medium capitalize"},I={class:"flex flex-col"},G={class:"font-semibold text-gray-900 dark:text-gray-100"},M={class:"text-xs text-gray-500 dark:text-gray-400"},J={key:0,class:"flex flex-col"},K={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},O={class:"text-xs text-gray-500 dark:text-gray-400"},Q={key:1,class:"text-sm text-gray-700 dark:text-gray-300"},W={class:"flex justify-center"},X={class:"text-sm text-gray-500 dark:text-gray-400"},Y={key:0,class:"flex flex-col items-center"},Z={key:1,class:"flex justify-center"},ee={key:0,class:"flex flex-col items-center text-sm"},te={class:"text-gray-900 dark:text-gray-100 font-medium"},se={key:1,class:"flex justify-center"},ne={class:"flex justify-center"},ae={class:"text-sm font-medium"},oe={class:"flex justify-center"},re={key:1,class:"text-gray-400"},ie={class:"flex items-center justify-end gap-1"},ue=T({__name:"LiveSessionsTable",props:{sessions:{},showHistoryActions:{type:Boolean}},emits:["start","stop","close","delete","notes","load"],setup(C){const _=C,m=A({column:"pnl_perc",direction:"desc"}),S=b(()=>_.showHistoryActions?[{key:"strategy",label:"Strategy"},{key:"session",label:"Session"},{key:"mode",label:"Mode",class:"text-center"},{key:"status",label:"Status",class:"text-center"},{key:"updated_at",label:"Date"},{key:"actions",label:"",class:"w-32 text-right"}]:[{key:"status",label:"Status"},{key:"session",label:"Session"},{key:"strategy",label:"Strategy"},{key:"pnl_perc",label:"PNL",sortable:!0,class:"text-center"},{key:"balance",label:"Balance",class:"text-center"},{key:"count_trades",label:"Trades",sortable:!0,class:"text-center"},{key:"open_positions",label:"Pos",sortable:!0,class:"text-center"},{key:"actions",label:"",class:"w-24 text-right"}]);function y(t,s=0){const r=typeof t=="number"?t:Number(t);return Number.isFinite(r)?r:s}const $=b(()=>_.showHistoryActions?_.sessions.map(t=>{var r,d,u;const s=((u=(d=(r=t.state)==null?void 0:r.form)==null?void 0:d.routes)==null?void 0:u[0])||{};return{id:t.id,title:t.title,strategy:s.strategy,exchange:t.exchange,symbol:s.symbol,timeframe:s.timeframe,mode:t.session_mode,status:t.status,updated_at:t.updated_at,rawSession:t}}):_.sessions.map(t=>{const s=t.results.generalInfo||{},r=t.form.routes[0]||{};return{id:t.id,phase:t.results.phase,exchange:t.form.exchange,symbol:r.symbol,timeframe:r.timeframe,strategy:r.strategy,pnl:y(s.pnl),pnl_perc:y(s.pnl_perc),current_balance:s.current_balance,started_balance:s.started_balance,count_trades:y(s.count_trades),open_positions:y(s.open_positions),hasPnl:s.pnl!==void 0&&s.pnl!==null}}));function z(t){return t==="running"?"bg-green-500":t==="starting"?"bg-yellow-500":t==="editing"?"bg-gray-400":t==="error"?"bg-red-500":t==="ended"?"bg-blue-500":t==="stopping"?"bg-orange-500":"bg-gray-400"}function k(t){const s=Number(t);return s===0||isNaN(s)?"text-gray-900 dark:text-gray-100":s>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}function N(t){switch(t==null?void 0:t.toLowerCase()){case"running":return"blue";case"stopped":return"red";case"terminated":return"gray";default:return"gray"}}function j(t){D(`/live/${t}`)}return(t,s)=>{const r=H,d=L,u=P,B=w;return o(),c("div",E,[i(B,{sort:f(m),"onUpdate:sort":s[0]||(s[0]=e=>U(m)?m.value=e:null),rows:f($),columns:f(S),class:"w-full",ui:{td:{base:"whitespace-nowrap"},th:{base:"whitespace-nowrap"}}},{"status-data":n(({row:e})=>[_.showHistoryActions?(o(),c("div",F,[i(r,{color:N(e.status),label:e.status,variant:"soft",size:"xs"},null,8,["color","label"])])):(o(),c("div",R,[a("div",{class:h(["w-2.5 h-2.5 rounded-full",z(e.phase)])},null,2),a("span",q,l(e.phase),1)]))]),"session-data":n(({row:e})=>[a("div",I,[a("span",G,l(e.exchange||"-"),1),a("span",M,l(e.symbol)+" â€¢ "+l(e.timeframe),1)])]),"strategy-data":n(({row:e})=>[_.showHistoryActions?(o(),c("div",J,[a("span",K,l(e.title||e.strategy||"Unknown Strategy"),1),a("span",O,l(e.exchange||"Unknown Exchange"),1)])):(o(),c("span",Q,l(e.strategy),1))]),"mode-data":n(({row:e})=>[a("div",W,[i(r,{color:e.mode==="livetrade"?"red":"orange",label:e.mode==="livetrade"?"Live":"Paper",variant:"soft",size:"xs"},null,8,["color","label"])])]),"updated_at-data":n(({row:e})=>[a("span",X,l(e.updated_at),1)]),"pnl_perc-data":n(({row:e})=>[e.phase==="running"||e.hasPnl?(o(),c("div",Y,[a("span",{class:h(["font-bold",k(e.pnl)])},l(e.pnl),3),a("span",{class:h(["text-xs",k(e.pnl)])}," ("+l(e.pnl_perc)+"%) ",3)])):(o(),c("div",Z,s[1]||(s[1]=[a("span",{class:"text-gray-400"},"-",-1)])))]),"balance-data":n(({row:e})=>[e.current_balance?(o(),c("div",ee,[a("span",te,l(e.current_balance),1)])):(o(),c("div",se,s[2]||(s[2]=[a("span",{class:"text-gray-400"},"-",-1)])))]),"count_trades-data":n(({row:e})=>[a("div",ne,[a("span",ae,l(e.count_trades??0),1)])]),"open_positions-data":n(({row:e})=>[a("div",oe,[e.open_positions>0?(o(),p(r,{key:0,size:"xs",color:"gray",variant:"solid"},{default:n(()=>[V(l(e.open_positions),1)]),_:2},1024)):(o(),c("span",re,"0"))])]),"actions-data":n(({row:e})=>[a("div",ie,[_.showHistoryActions?(o(),c(v,{key:0},[i(u,{text:"Add Note"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-pencil-square",onClick:g=>t.$emit("notes",e)},null,8,["onClick"])]),_:2},1024),i(u,{text:"Load Session"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-arrow-right",onClick:g=>t.$emit("load",e.id)},null,8,["onClick"])]),_:2},1024),e.status!=="running"?(o(),p(u,{key:0,text:"Delete"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",color:"red",icon:"i-heroicons-trash",onClick:g=>t.$emit("delete",e.id)},null,8,["onClick"])]),_:2},1024)):x("",!0)],64)):(o(),c(v,{key:1},[i(u,{text:"View Session"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-eye",onClick:g=>j(e.id)},null,8,["onClick"])]),_:2},1024),["editing","ended","error"].includes(e.phase)?(o(),p(u,{key:0,text:"Start Session"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",icon:"i-heroicons-play",onClick:g=>t.$emit("start",e.id)},null,8,["onClick"])]),_:2},1024)):x("",!0),["starting","running"].includes(e.phase)?(o(),p(u,{key:1,text:"Stop Session"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",color:"red",icon:"i-heroicons-stop",onClick:g=>t.$emit("stop",e.id)},null,8,["onClick"])]),_:2},1024)):x("",!0),["editing","ended","error"].includes(e.phase)?(o(),p(u,{key:2,text:"Close Tab"},{default:n(()=>[i(d,{size:"xs",variant:"ghost",color:"red",icon:"i-heroicons-x-mark",onClick:g=>t.$emit("close",e.id)},null,8,["onClick"])]),_:2},1024)):x("",!0)],64))])]),_:1},8,["sort","rows","columns"])])}}});export{ue as _};
