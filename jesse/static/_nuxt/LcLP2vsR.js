import{_ as J}from"./CtZWZQl3.js";import{c,o as d,b as r,g as z,L as q,z as I,r as $,l as F,D as o,t as j,m as w,d as l,F as S,p as V,T as U,Q as L,h as A,G as m,i as N,w as x,q as E,S as Q,e as O,k as R}from"./CgNmNnAO.js";import{u as H}from"./BX4arLqM.js";import{r as T}from"./DajuEEhJ.js";function D(k,t){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}const K={class:"relative"},P=["onClick"],W={class:"w-full text-sm text-left"},X={key:0},Y=z({__name:"MultipleSelect",props:q({options:{type:Array,required:!0},animate:{type:Boolean,default:!1}},{modelValue:{type:Array,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const t=I(k,"modelValue"),B=k,s=$(!1);function C(p){return t.value.some(u=>u.key===p.key)}function g(p){const u=t.value.findIndex(y=>y.key===p.key);u===-1?t.value.push(p):t.value.splice(u,1)}return(p,u)=>(d(),c("div",K,[o(s)?(d(),c("div",{key:0,class:"fixed inset-0 w-screen z-10",onClick:u[0]||(u[0]=y=>s.value=!o(s))})):F("",!0),r("button",{class:w(["relative min-w-40 xl:min-w-52 w-full bg-white dark:bg-gray-800 flex justify-between items-center px-2 py-0.5 rounded-md border-[2px] border-gray-300 dark:border-gray-900",o(s)?"z-20":""]),onClick:u[1]||(u[1]=y=>s.value=!o(s))},[r("div",null,j(t.value.length)+" selected ",1),r("div",{class:w(["transition-all duration-200",o(s)?"-rotate-180":"rotate-0"])},[l(o(D),{class:"h-3 w-3 text-gray-400 dark:text-gray-600"})],2)],2),r("div",{class:w(["absolute w-full max-h-60 overflow-y-scroll top-9 bg-white dark:bg-gray-800 right-0 rounded-md border-[2px] border-gray-300 dark:border-gray-900 z-20 p-0.5",k.animate?o(s)?"transition-all h-60 opacity-100":"transition-all h-0 opacity-0 pointer-events-none":o(s)?"h-60":"h-0 opacity-0"])},[(d(!0),c(S,null,V(B.options,y=>(d(),c("button",{key:y.key,class:"w-full flex justify-between items-center hover:bg-gray-100 hover:dark:bg-gray-800 p-1 rounded-md",onClick:M=>g(y)},[r("div",W,j(y.label),1),C(y)?(d(),c("div",X,[l(o(U),{class:"h-4 w-4 text-gray-600 dark:text-gray-400"})])):F("",!0)],8,P))),128))],2)]))}}),Z={class:"relative"},ee=["onClick"],te={class:"w-full text-sm text-left"},re={key:0},oe=z({__name:"SingleSelect",props:q({options:{type:Array,required:!0},animate:{type:Boolean,default:!1}},{modelValue:{type:Object,default:{}},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const t=I(k,"modelValue"),B=k,s=$(!1);function C(g){t.value=g}return(g,p)=>(d(),c("div",Z,[o(s)?(d(),c("div",{key:0,class:"fixed inset-0 w-screen z-10",onClick:p[0]||(p[0]=u=>s.value=!o(s))})):F("",!0),r("button",{class:w(["relative min-w-40 xl:min-w-52 w-full bg-white dark:bg-gray-800 flex justify-between items-center px-2 py-0.5 rounded-md border-[2px] border-gray-300 dark:border-gray-900",o(s)?"z-20":""]),onClick:p[1]||(p[1]=u=>s.value=!o(s))},[r("div",null,j(t.value.label),1),r("div",{class:w(["transition-all duration-200",o(s)?"-rotate-180":"rotate-0"])},[l(o(D),{class:"h-3 w-3 text-gray-400 dark:text-gray-600"})],2)],2),r("div",{class:w(["absolute w-full max-h-60 overflow-y-scroll top-9 bg-white dark:bg-gray-800 right-0 rounded-md border-[2px] border-gray-300 dark:border-gray-900 z-20 p-0.5",k.animate?o(s)?"transition-all h-60 opacity-100":"transition-all h-0 opacity-0 pointer-events-none":o(s)?"h-60":"h-0 opacity-0"])},[(d(!0),c(S,null,V(B.options,u=>(d(),c("button",{key:u.key,class:"w-full flex justify-between items-center hover:bg-gray-100 hover:dark:bg-gray-800 p-1 rounded-md",onClick:y=>C(u)},[r("div",te,j(u.label),1),u.key==t.value.key?(d(),c("div",re,[l(o(U),{class:"h-4 w-4 text-gray-600 dark:text-gray-400"})])):F("",!0)],8,ee))),128))],2)]))}}),ae={class:"w-full"},ne={class:"mt-8 p-4"},se={class:"lg:flex justify-center items-center mb-4"},le={class:"md:flex justify-center items-center mb-4 lg:mb-0"},ie={class:"flex justify-center items-center mb-4 md:mb-0"},de={class:"flex justify-center items-center md:ml-4"},ue={class:"flex justify-center items-center lg:ml-4"},ce={class:"flex"},pe={class:"flex flex-col border-r-2 dark:border-gray-900 font-bold"},me={class:"flex overflow-x-auto"},ge={class:"px-4 flex items-center justify-center border-b border-t-2 dark:border-gray-900 h-20 bg-white dark:bg-backdrop-dark"},ye={class:"text-gray-700 dark:text-gray-300 truncate"},_e=z({__name:"benchmark",setup(k){H({title:"Benchmark"});const t=L(),B=A(()=>t.tabs),s=$(t.benchmarkColumns),C=$(t.benchmarkSorts);t.benchmarkFilters.length===0&&t.setBenchmarkFilters(s.value);const g=$(JSON.parse(JSON.stringify(t.benchmarkFilters)));Object.keys(t.benchmarkSelectedSort).length==0&&t.setBenchmarkSort(C.value[0]);const p=$(t.benchmarkSelectedSort),u=A(()=>{var f,_,h;const v=t.tabs,a=[];for(const b in v){const i=v[b],e={id:i.id,strategy:((f=i.form.routes[0])==null?void 0:f.strategy)??"",start_date:i.form.start_date,finish_date:i.form.finish_date,fast_mode:i.form.fast_mode,exchange:i.form.exchange,symbol:((_=i.form.routes[0])==null?void 0:_.symbol)??"",timeframe:((h=i.form.routes[0])==null?void 0:h.timeframe)??""},n=i.results.metrics;Object.keys(n).length>0&&(e.total_closed_trades=n.total,e.net_profit=m.round(n.net_profit,1),e.net_profit_percentage=`${m.round(n.net_profit_percentage,1)} %`,e.total_paid_fees=m.round(n.fee,1),e.max_drawdown=`${m.round(n.max_drawdown,1)} %`,e.annual_return=`${m.round(n.annual_return,1)} %`,e.expectancy=`${m.round(n.expectancy_percentage,1)} %`,e.ratio_avg_win_loss=m.round(n.ratio_avg_win_loss,1),e.win_rate=`${m.round(n.win_rate*100,1)} %`,e.longs_percentage=`${m.round(n.longs_percentage,1)} %`,e.shorts_percentage=`${m.round(n.shorts_percentage,1)} %`,e.average_holding_hours=m.round(n.average_holding_period/3600,1),e.sharpe_ratio=m.round(n.sharpe_ratio,1),e.sortino_ratio=m.round(n.sortino_ratio,1),e.calmar_ratio=m.round(n.calmar_ratio,1),e.omega_ratio=m.round(n.omega_ratio,1)),i.results.executing&&!i.results.exception.error?(e.progress=`${i.results.progressbar.current}%`,e.status="running"):i.results.exception.error&&i.results.executing?(e.progress="❌",e.status="error"):Object.keys(n).length===0?e.status="":(e.progress="✅",e.status="finished"),a.push(e)}return a}),y=A(()=>p.value.key==="none"?u.value:[...u.value].sort((v,a)=>{const f=p.value.key,_=parseFloat(v[f])||null,h=parseFloat(a[f])||null;return _===null&&h===null?0:_===null?1:h===null||_>h?-1:_<h?1:0}));function M(){g.value.sort((v,a)=>s.value.findIndex(f=>f.key===v.key)-s.value.findIndex(f=>f.key===a.key)),t.setBenchmarkFilters(g.value)}return N(g,M,{deep:!0}),N(p,v=>{t.setBenchmarkSort(v)},{deep:!0}),(v,a)=>{const f=J,_=Y,h=oe,b=E,i=Q;return d(),c(S,null,[r("div",ae,[l(f,{"current-tab":null,tabs:B.value,mode:"backtest",onClose:o(t).closeTab},null,8,["tabs","onClose"])]),r("div",ne,[r("div",se,[r("div",le,[r("div",ie,[a[3]||(a[3]=r("div",{class:"font-bold whitespace-nowrap mr-4"},"Filter by:",-1)),l(_,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),options:s.value},null,8,["modelValue","options"])]),r("div",de,[a[4]||(a[4]=r("div",{class:"font-bold whitespace-nowrap mr-4"},"Sort by:",-1)),l(h,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),options:C.value},null,8,["modelValue","options"])])]),r("div",ue,[a[8]||(a[8]=r("div",{class:"font-bold mr-4"},"Actions:",-1)),l(b,{icon:"i-heroicons-arrow-path",onClick:o(t).rerunAll},{default:x(()=>a[5]||(a[5]=[O("Rerun All")])),_:1},8,["onClick"]),l(b,{icon:"i-heroicons-arrow-path",class:"ml-4",color:"rose",onClick:o(t).rerunFailed},{default:x(()=>a[6]||(a[6]=[O(" Rerun Failed Only ")])),_:1},8,["onClick"]),l(b,{icon:"i-heroicons-stop",class:"ml-4",color:"gray",onClick:o(t).cancelAllRunning},{default:x(()=>a[7]||(a[7]=[O(" Cancel All ")])),_:1},8,["onClick"])])]),r("div",null,[r("div",ce,[r("div",pe,[a[9]||(a[9]=r("div",{class:"border-b-2 dark:border-gray-900 h-20"},null,-1)),(d(!0),c(S,null,V(g.value,(e,n)=>(d(),c("div",{key:e.key,class:w(["text-sm uppercase border-b border-l dark:border-gray-900 min-w-[13rem] min-h-[4rem] flex items-center justify-center",n%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-backdrop-dark"])},[r("span",null,j(e.label),1)],2))),128))]),r("div",me,[(d(!0),c(S,null,V(y.value,e=>(d(),c("div",{key:e.id,class:"flex flex-col border-r dark:border-gray-900"},[r("div",ge,[l(i,{text:"Rerun","open-delay":500,popper:{arrow:!0}},{default:x(()=>[l(b,{class:"mr-2",variant:"ghost",icon:"i-heroicons-arrow-path",disabled:e.status==="running",onClick:n=>o(t).rerun(e.id)},null,8,["disabled","onClick"])]),_:2},1024),l(i,{text:"Go to backtest page","open-delay":500,popper:{arrow:!0}},{default:x(()=>[l(b,{to:`/backtest/${e.id}`,class:"mr-2",variant:"ghost",color:"gray",icon:"i-heroicons-arrow-top-right-on-square"},null,8,["to"])]),_:2},1024),l(i,{text:"Duplicate","open-delay":500,popper:{arrow:!0}},{default:x(()=>[l(b,{class:"mr-2",variant:"ghost",icon:"i-heroicons-document-duplicate",color:"blue",onClick:n=>o(t).duplicateTab(e.id)},null,8,["onClick"])]),_:2},1024),e.status==="running"?(d(),R(i,{key:0,text:"Cancel","open-delay":500,popper:{arrow:!0}},{default:x(()=>[l(b,{variant:"ghost",icon:"i-heroicons-stop",color:"gray",onClick:n=>o(t).cancel(e.id)},null,8,["onClick"])]),_:2},1024)):(d(),R(i,{key:1,text:"Close tab","open-delay":500,popper:{arrow:!0}},{default:x(()=>[l(b,{variant:"ghost",icon:"i-heroicons-trash",color:"red",disabled:Object.keys(y.value).length==1,onClick:n=>o(t).closeTab(e.id)},null,8,["disabled","onClick"])]),_:2},1024))]),(d(!0),c(S,null,V(g.value,(n,G)=>(d(),c("div",{key:n.key,class:w(["border-b dark:border-gray-900 min-w-[6rem] text-center min-h-[4rem] w-[13em]",e.status==="running"?"animate-pulse":""])},[r("div",{class:w(["px-4 py-4 w-full h-full truncate flex items-center justify-center",G%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-backdrop-dark"])},[r("span",ye,j(e[n.key]||"-"),1)],2)],2))),128))]))),128)),l(i,{text:"Add New Tab","open-delay":500,popper:{arrow:!0}},{default:x(()=>[r("button",{class:"w-20 h-full px-4 flex flex-col justify-between items-center border-dashed border-2 dark:border-gray-900 bg-white hover:bg-gray-50 dark:bg-backdrop-dark hover:dark:bg-gray-800 py-10",onClick:a[2]||(a[2]=e=>o(t).addTab())},[l(o(T),{class:"h-6 w-6 text-gray-400 dark:text-gray-100"}),l(o(T),{class:"h-6 w-6 text-gray-400 dark:text-gray-100"}),l(o(T),{class:"h-6 w-6 text-gray-400 dark:text-gray-100"})])]),_:1})])])])])],64)}}});export{_e as default};
