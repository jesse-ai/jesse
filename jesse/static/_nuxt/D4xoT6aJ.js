import{d as N,r as g,c as v,C as k,i as o,f as r,x as B,D as K,g as m,j as l,e as w,t as F,v as q,G as b,a5 as H,a0 as J,B as O,E as P,k as Q,aa as W,ad as E,ae as L,s as y}from"./B4BPTRlB.js";import{_ as X}from"./DVdeiVNj.js";import{_ as Y}from"./C0-a_pR3.js";import"./BPE2cDSt.js";const Z={class:"bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-sm"},ee={class:"flex flex-col items-center justify-center py-12 gap-4"},ae={key:0},te={class:"flex flex-col items-center gap-2"},se={key:1},ne={class:"text-sm text-gray-900 dark:text-gray-100 font-medium"},oe={class:"text-sm text-gray-700 dark:text-gray-300"},le={class:"text-sm text-gray-500 dark:text-gray-400"},ie={class:"text-sm text-gray-500 dark:text-gray-400"},re={class:"flex items-center justify-end gap-1"},ce=N({__name:"CandlesTable",props:{candles:{},loading:{type:Boolean}},emits:["refresh","update","delete"],setup($){const d=$,x=g({column:"exchange",direction:"asc"}),p=[{key:"exchange",label:"Exchange",sortable:!0},{key:"symbol",label:"Symbol",sortable:!0},{key:"start_date",label:"Start Date"},{key:"end_date",label:"End Date"},{key:"actions",label:"",class:"w-24 text-right"}],f=v(()=>d.candles);return(c,s)=>{const i=F,n=q,C=Y;return m(),k("div",Z,[o(C,{sort:B(x),"onUpdate:sort":s[1]||(s[1]=a=>K(x)?x.value=a:null),rows:B(f),columns:p,loading:c.loading,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading candles..."},progress:{color:"primary",animation:"carousel"},class:"w-full",ui:{td:{base:"whitespace-nowrap"},th:{base:"whitespace-nowrap"}}},{"empty-state":r(()=>[l("div",ee,[c.candles.length===0?(m(),k("div",ae,[s[3]||(s[3]=l("span",{class:"text-gray-500 dark:text-gray-400 mb-4 block"}," Click the button below to fetch existing candles from the database ",-1)),l("div",te,[o(i,{icon:"i-heroicons-arrow-path",label:"Fetch Candles",onClick:s[0]||(s[0]=a=>c.$emit("refresh"))}),s[2]||(s[2]=l("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"}," Note: This process might take a few minutes depending on the database size ",-1))])])):(m(),k("div",se,s[4]||(s[4]=[l("span",{class:"text-gray-500 dark:text-gray-400"}," No candles found matching your filters ",-1)])))])]),"exchange-data":r(({row:a})=>[l("span",ne,b(a.exchange),1)]),"symbol-data":r(({row:a})=>[l("span",oe,b(a.symbol),1)]),"start_date-data":r(({row:a})=>[l("span",le,b(a.start_date),1)]),"end_date-data":r(({row:a})=>[l("span",ie,b(a.end_date),1)]),"actions-data":r(({row:a})=>[l("div",re,[a.isSupported?(m(),w(i,{key:1,color:"teal",variant:"ghost",icon:"i-heroicons-arrow-path",size:"xs",label:"Update",loading:a.isUpdating,onClick:_=>c.$emit("update",a)},null,8,["loading","onClick"])):(m(),w(n,{key:0,text:"This exchange doesn't support backtesting"},{default:r(()=>[o(i,{color:"teal",variant:"ghost",icon:"i-heroicons-arrow-path",size:"xs",label:"Update",loading:a.isUpdating,disabled:!a.isSupported,onClick:_=>c.$emit("update",a)},null,8,["loading","disabled","onClick"])]),_:2},1024)),o(n,{text:"Delete"},{default:r(()=>[o(i,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",label:"Delete",loading:a.isDeleting,onClick:_=>c.$emit("delete",a)},null,8,["loading","onClick"])]),_:2},1024)])]),_:1},8,["sort","rows","loading"])])}}}),de={class:"container mx-auto px-4 pt-16 pb-6 max-w-7xl"},ue={class:"flex justify-between items-center mb-6"},ge={class:"flex gap-4 mb-6"},ye=N({__name:"manage",setup($){const d=H(),x=J(),p=g(!1),f=g(!1),c=g(new Set),s=g(!1),i=g(null),n=g({exchange:"",symbol:""}),C=v(()=>{let e=d.existingCandles;return n.value.exchange&&(e=e.filter(t=>t.exchange.toLowerCase().includes(n.value.exchange.toLowerCase()))),n.value.symbol&&(e=e.filter(t=>t.symbol.toLowerCase().includes(n.value.symbol.toLowerCase()))),e}),a=v(()=>C.value.map(e=>({...e,isSupported:I(e.exchange),isUpdating:d.isSymbolUpdating(e.exchange,e.symbol),isDeleting:c.value.has(D(e))}))),_=v(()=>p.value||f.value),D=e=>`${e.exchange}-${e.symbol}`;async function U(){y("success","Fetching latest candle details. This process might take from a few seconds up to a few minutes depending on the database size."),f.value=!0;try{await d.fetchExistingCandles()}finally{f.value=!1,y("success","Candles information updated successfully")}}function R(e){i.value=e,s.value=!0}async function z(){if(!i.value)return;const e=i.value,t=D(e);c.value.add(t);try{await d.deleteCandles(e.exchange,e.symbol),y("success","Candles deleted successfully")}catch{y("error","Failed to delete candles")}finally{c.value.delete(t),s.value=!1,i.value=null}}async function j(e){try{await d.updateCandles(e.exchange,e.symbol,e.start_date),y("success",`Started updating candles for ${e.symbol} on ${e.exchange}`)}catch{y("error","Failed to start candle update")}}const I=e=>x.backtestingExchangeNames.includes(e);return O(async()=>{if(!d.existingCandles.length){p.value=!0;try{await d.fetchExistingCandles()}finally{p.value=!1}}}),(e,t)=>{var V,T;const h=F,S=Q,M=X,A=ce,G=W;return m(),k("div",de,[l("div",ue,[o(h,{icon:"i-heroicons-arrow-left",variant:"outline",to:"/candles",label:"Back"}),o(h,{icon:"i-heroicons-arrow-path",loading:f.value,label:"Refresh",onClick:U},null,8,["loading"])]),l("div",ge,[o(S,{modelValue:n.value.exchange,"onUpdate:modelValue":t[1]||(t[1]=u=>n.value.exchange=u),class:"w-64",icon:"i-heroicons-magnifying-glass",placeholder:"Filter by Exchange",ui:{icon:{trailing:{pointer:""}}}},{trailing:r(()=>[E(o(h,{color:"gray",variant:"link",icon:"i-heroicons-x-mark-20-solid",padded:!1,onClick:t[0]||(t[0]=u=>n.value.exchange="")},null,512),[[L,n.value.exchange!==""]])]),_:1},8,["modelValue"]),o(S,{modelValue:n.value.symbol,"onUpdate:modelValue":t[3]||(t[3]=u=>n.value.symbol=u),icon:"i-heroicons-magnifying-glass",placeholder:"Filter by Symbol",class:"w-64",ui:{icon:{trailing:{pointer:""}}}},{trailing:r(()=>[E(o(h,{color:"gray",variant:"link",icon:"i-heroicons-x-mark-20-solid",padded:!1,onClick:t[2]||(t[2]=u=>n.value.symbol="")},null,512),[[L,n.value.symbol!==""]])]),_:1},8,["modelValue"])]),p.value?(m(),w(M,{key:0,icon:"i-heroicons-information-circle",color:"gray",title:"Loading candles...",description:"This process might take from a few seconds up to a few minutes.",class:"mb-6"})):P("",!0),o(A,{candles:a.value,loading:_.value,onRefresh:U,onUpdate:j,onDelete:R},null,8,["candles","loading"]),o(G,{modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=u=>s.value=u),title:"Delete Candles",description:`Are you sure you want to delete all candles for "${(V=i.value)==null?void 0:V.symbol}" on "${(T=i.value)==null?void 0:T.exchange}"?`,type:"info"},{default:r(()=>[o(h,{variant:"solid",color:"red",block:"",class:"sm:w-auto",label:"Delete",onClick:z})]),_:1},8,["modelValue","description"])])}}});export{ye as default};
