import{d as G,r as u,c as B,J as ce,C as x,i as s,f as m,x as n,D as $,g as y,j as t,v as de,t as J,G as T,E as N,a6 as ue,a4 as me,P as _e,B as pe,w as O,a7 as fe,a8 as F,h as D,e as ve,F as ye,O as he,k as ge,a9 as xe,aa as be,_ as we,ab as ke,I as Se,s as E}from"./DqOwpkBS.js";import{_ as Ce}from"./BQa5vPmZ.js";import{_ as $e}from"./n_Em2vSK.js";import{_ as Me}from"./D4lpbEFL.js";import{_ as Ve}from"./Cc8Wj8OF.js";import{u as Ue}from"./B8dasSS2.js";import"./Mj9S6aN0.js";import"./B9gej7JI.js";const Te={class:"bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-sm"},De={class:"flex flex-col"},Ne={class:"text-sm font-medium text-gray-900 dark:text-white"},je={class:"text-xs text-gray-500 dark:text-gray-400"},Re={class:"flex flex-col"},qe={class:"text-sm text-gray-700 dark:text-gray-300"},ze={class:"text-xs text-gray-500 dark:text-gray-400"},Pe={class:"flex justify-center gap-1 text-lg"},Fe={key:0},Ae={key:1},Be={key:2,class:"text-gray-400 text-sm"},Le={class:"flex justify-center"},He={class:"text-sm"},Oe={class:"flex justify-center"},Ee={class:"text-sm text-gray-500 dark:text-gray-400"},Ie={class:"flex items-center justify-end gap-1"},Ge=G({__name:"MonteCarloSessionsTable",props:{sessions:{}},emits:["notes","load","delete"],setup(I){const S=I,M=u({column:"updated_at",direction:"desc"}),L=[{key:"strategy",label:"Strategy"},{key:"session",label:"Session"},{key:"simulation_types",label:"Types",class:"text-center"},{key:"num_scenarios",label:"Scenarios",class:"text-center"},{key:"status",label:"Status",class:"text-center"},{key:"updated_at",label:"Date",sortable:!0},{key:"actions",label:"",class:"w-32 text-right"}],_=B(()=>S.sessions.map(o=>{var h,C,g,d,b,a,p,U,w,k,f,v,R,q,z,P;return{id:o.id,title:o.title,strategy:(d=(g=(C=(h=o.state)==null?void 0:h.form)==null?void 0:C.routes)==null?void 0:g[0])==null?void 0:d.strategy,exchange:(a=(b=o.state)==null?void 0:b.form)==null?void 0:a.exchange,symbol:(k=(w=(U=(p=o.state)==null?void 0:p.form)==null?void 0:U.routes)==null?void 0:w[0])==null?void 0:k.symbol,timeframe:(q=(R=(v=(f=o.state)==null?void 0:f.form)==null?void 0:v.routes)==null?void 0:R[0])==null?void 0:q.timeframe,has_trades:o.has_trades,has_candles:o.has_candles,num_scenarios:(P=(z=o.state)==null?void 0:z.form)==null?void 0:P.num_scenarios,status:o.status,updated_at:ce.timestampToReadableDateTime(o.updated_at),rawSession:o}}));function V(o){switch(o==null?void 0:o.toLowerCase()){case"running":return"blue";case"finished":return"green";case"stopped":return"red";case"terminated":return"yellow";default:return"gray"}}return(o,h)=>{const C=$e,g=J,d=de,b=Me;return y(),x("div",Te,[s(b,{sort:n(M),"onUpdate:sort":h[0]||(h[0]=a=>$(M)?M.value=a:null),rows:n(_),columns:L,class:"w-full",ui:{td:{base:"whitespace-nowrap"},th:{base:"whitespace-nowrap"}}},{"strategy-data":m(({row:a})=>[t("div",De,[t("span",Ne,T(a.title||a.strategy||"Unknown Strategy"),1),t("span",je,T(a.exchange||"Unknown Exchange"),1)])]),"session-data":m(({row:a})=>[t("div",Re,[t("span",qe,T(a.symbol||"N/A"),1),t("span",ze,T(a.timeframe||"N/A"),1)])]),"simulation_types-data":m(({row:a})=>[t("div",Pe,[a.has_trades?(y(),x("span",Fe,"ðŸ”€")):N("",!0),a.has_candles?(y(),x("span",Ae,"ðŸ“ˆ")):N("",!0),!a.has_trades&&!a.has_candles?(y(),x("span",Be,"-")):N("",!0)])]),"num_scenarios-data":m(({row:a})=>[t("div",Le,[t("span",He,T(a.num_scenarios),1)])]),"status-data":m(({row:a})=>[t("div",Oe,[s(C,{color:V(a.status),label:a.status,variant:"soft",size:"xs"},null,8,["color","label"])])]),"updated_at-data":m(({row:a})=>[t("span",Ee,T(a.updated_at),1)]),"actions-data":m(({row:a})=>[t("div",Ie,[s(d,{text:"Add Note"},{default:m(()=>[s(g,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-pencil-square",onClick:p=>o.$emit("notes",a.rawSession)},null,8,["onClick"])]),_:2},1024),s(d,{text:"Load Session"},{default:m(()=>[s(g,{size:"xs",variant:"ghost",color:"gray",icon:"i-heroicons-arrow-right",onClick:p=>o.$emit("load",a.id)},null,8,["onClick"])]),_:2},1024),s(d,{text:"Delete"},{default:m(()=>[s(g,{size:"xs",variant:"ghost",color:"red",icon:"i-heroicons-trash",onClick:p=>o.$emit("delete",a.id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["sort","rows"])])}}}),Je={class:"container mx-auto px-4 pt-16 pb-6 max-w-7xl"},We={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},Ke={class:"flex items-center gap-3"},Qe={class:"flex flex-col gap-3 sm:flex-row sm:items-center"},Xe={key:0,class:"space-y-4"},Ye={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Ze={class:"divide-y divide-gray-200 dark:divide-gray-700"},et={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},tt={class:"col-span-3"},st={class:"col-span-2"},at={class:"col-span-2 text-center"},lt={class:"col-span-2 text-center"},ot={class:"col-span-2"},nt={class:"col-span-1 flex justify-end gap-2"},it={class:"md:hidden space-y-3"},rt={class:"flex items-start justify-between"},ct={class:"flex-1"},dt={class:"flex items-center justify-between"},ut={class:"flex items-center justify-between"},mt={class:"flex gap-1"},_t={key:1,class:"space-y-4"},pt={key:0,class:"flex justify-center"},ft={key:2,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center"},vt={class:"p-6"},yt={class:"mb-6"},ht={class:"flex justify-end gap-3"},A=50,Mt=G({__name:"history",setup(I){Ue({title:"Monte Carlo History - Jesse"});const S=ue(),M=me(),L=_e(),_=u([]),V=u(!1),o=u(null),h=u(!1),C=u(!1),g=u(!0),d=u(0),b=u(!1),a=u(null),p=u(!1),U=u(!1),w=u(30),k=B({get:()=>S.query.title||"",set:l=>{const e={...S.query};l?e.title=l:delete e.title,M.push({query:e})}}),f=B({get:()=>S.query.status||"all",set:l=>{const e={...S.query};l==="all"?delete e.status:e.status=l,M.push({query:e})}}),v=B({get:()=>S.query.dateRange||"all_time",set:l=>{const e={...S.query};l==="all_time"?delete e.dateRange:e.dateRange=l,M.push({query:e})}}),R=[{label:"All Statuses",value:"all"},{label:"Running",value:"running"},{label:"Finished",value:"finished"},{label:"Stopped",value:"stopped"},{label:"Terminated",value:"terminated"}],q=[{label:"All Time",value:"all_time"},{label:"Last 7 Days",value:"7_days"},{label:"Last 30 Days",value:"30_days"},{label:"Last 90 Days",value:"90_days"}],z=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"3 months",value:90},{label:"6 months",value:180},{label:"1 year",value:365},{label:"2 years",value:730},{label:"All existing sessions",value:-1}];pe(()=>{setTimeout(()=>{j()},20)});const P=fe(()=>{d.value=0,j()},300);O(k,()=>{P()}),O(f,()=>{d.value=0,j()}),O(v,()=>{d.value=0,j()});async function j(){var l;h.value=!0;try{const r=(await F("/monte-carlo/sessions",{limit:A,offset:0,title_search:k.value||null,status_filter:f.value==="all"?null:f.value,date_filter:v.value==="all_time"?null:v.value},!0)).data.value;_.value=(r==null?void 0:r.sessions)||[],d.value=_.value.length,g.value=((l=r==null?void 0:r.sessions)==null?void 0:l.length)===A}catch(e){D(e)}finally{h.value=!1}}async function W(){C.value=!0;try{const e=(await F("/monte-carlo/sessions",{limit:A,offset:d.value,title_search:k.value||null,status_filter:f.value==="all"?null:f.value,date_filter:v.value==="all_time"?null:v.value},!0)).data.value,r=(e==null?void 0:e.sessions)||[];_.value=[..._.value,...r],d.value+=r.length,g.value=r.length===A}catch(l){D(l)}finally{C.value=!1}}async function K(l){await Se(`/monte-carlo/${l}`)}function Q(l){o.value=l,V.value=!0}async function X(){o.value&&(await Y(o.value),_.value=_.value.filter(l=>l.id!==o.value),d.value-=1),V.value=!1,o.value=null}async function Y(l){if(l===L.form.id){E("error","Cannot delete the current session.");return}try{const e=await F(`/monte-carlo/sessions/${l}/remove`,{},!0);if(e.error.value){D(e.error.value);return}E("success","Session deleted successfully")}catch(e){D(e)}}function Z(l){a.value=l,b.value=!0}async function ee(){U.value=!0;try{const l=await F("/monte-carlo/purge-sessions",{days_old:w.value===-1?null:w.value},!0);if(l.error.value){D(l.error.value);return}const e=l.data.value;E("success",`Successfully purged ${e.deleted_count} session(s)`),p.value=!1,d.value=0,await j()}catch(l){D(l)}finally{U.value=!1}}function te(){p.value=!1,w.value=30}function se(l){if(a.value){const e=_.value.find(r=>r.id===a.value.id);e&&(e.title=l.title,e.description=l.description,a.value.title=l.title,a.value.description=l.description)}}return(l,e)=>{const r=J,ae=ge,H=xe,i=Ce,le=Ge,oe=be,ne=Ve,ie=ke,re=we;return y(),x("div",null,[t("div",Je,[t("div",We,[t("div",Ke,[e[9]||(e[9]=t("h1",{class:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white"}," Monte Carlo History ",-1)),s(r,{icon:"i-heroicons-trash",color:"red",variant:"soft",size:"sm",label:"Purge",onClick:e[0]||(e[0]=c=>p.value=!0)})]),t("div",Qe,[s(ae,{modelValue:n(k),"onUpdate:modelValue":e[1]||(e[1]=c=>$(k)?k.value=c:null),placeholder:"Search by title...",icon:"i-heroicons-magnifying-glass",size:"sm",class:"w-full sm:w-64"},null,8,["modelValue"]),s(H,{modelValue:n(f),"onUpdate:modelValue":e[2]||(e[2]=c=>$(f)?f.value=c:null),options:R,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),s(H,{modelValue:n(v),"onUpdate:modelValue":e[3]||(e[3]=c=>$(v)?v.value=c:null),options:q,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"])])]),n(h)?(y(),x("div",Xe,[t("div",Ye,[t("div",Ze,[(y(),x(ye,null,he(5,c=>t("div",{key:c,class:"p-4"},[t("div",et,[t("div",tt,[s(i,{class:"h-4 w-full mb-2"}),s(i,{class:"h-3 w-2/3"})]),t("div",st,[s(i,{class:"h-4 w-full mb-2"}),s(i,{class:"h-3 w-2/3"})]),t("div",at,[s(i,{class:"h-4 w-16 mx-auto"})]),t("div",lt,[s(i,{class:"h-6 w-20 mx-auto"})]),t("div",ot,[s(i,{class:"h-4 w-full"})]),t("div",nt,[s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"})])]),t("div",it,[t("div",rt,[t("div",ct,[s(i,{class:"h-4 w-3/4 mb-2"}),s(i,{class:"h-3 w-1/2"})]),s(i,{class:"h-6 w-16 ml-2"})]),t("div",dt,[s(i,{class:"h-4 w-24"}),s(i,{class:"h-4 w-16"})]),t("div",ut,[s(i,{class:"h-3 w-32"}),t("div",mt,[s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"}),s(i,{class:"h-8 w-8"})])])])])),64))])])])):n(_).length?(y(),x("div",_t,[s(le,{sessions:n(_),onNotes:Z,onLoad:K,onDelete:Q},null,8,["sessions"]),n(g)?(y(),x("div",pt,[s(r,{label:"Load More",variant:"soft",color:"gray",loading:n(C),onClick:W},null,8,["loading"])])):N("",!0)])):!n(h)&&n(_).length===0?(y(),x("div",ft,e[10]||(e[10]=[t("div",{class:"text-gray-400 dark:text-gray-500"},[t("i",{class:"i-heroicons-clock h-12 w-12 mx-auto mb-4"}),t("p",{class:"text-lg"},"No Monte Carlo history found"),t("p",{class:"text-sm mt-2"},"Run a Monte Carlo simulation or change filters to see items in your history")],-1)]))):N("",!0),s(oe,{modelValue:n(V),"onUpdate:modelValue":e[4]||(e[4]=c=>$(V)?V.value=c:null),title:"Delete Monte Carlo Session",description:"Are you sure you want to delete this Monte Carlo session? This action cannot be undone.",type:"info"},{default:m(()=>[s(r,{variant:"solid",color:"red",block:"",class:"sm:w-auto",label:"Delete",onClick:X})]),_:1},8,["modelValue"]),n(a)?(y(),ve(ne,{key:3,modelValue:n(b),"onUpdate:modelValue":e[5]||(e[5]=c=>$(b)?b.value=c:null),"session-id":n(a).id,"initial-title":n(a).title,"initial-description":n(a).description,"initial-strategy-codes":n(a).strategy_codes,onSaved:e[6]||(e[6]=c=>se({title:"",description:""}))},null,8,["modelValue","session-id","initial-title","initial-description","initial-strategy-codes"])):N("",!0),s(re,{modelValue:n(p),"onUpdate:modelValue":e[8]||(e[8]=c=>$(p)?p.value=c:null)},{default:m(()=>[t("div",vt,[e[13]||(e[13]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Purge Monte Carlo Sessions ",-1)),t("div",yt,[e[11]||(e[11]=t("div",{class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4"},[t("div",{class:"flex items-start gap-3"},[t("i",{class:"i-heroicons-exclamation-triangle text-red-600 dark:text-red-400 text-xl flex-shrink-0 mt-0.5"}),t("div",{class:"text-sm text-red-800 dark:text-red-200"},[t("p",{class:"font-semibold mb-1"}," Warning: This action is permanent! "),t("p",null,"Deleted sessions cannot be recovered. Please select carefully.")])])],-1)),s(ie,{label:"Delete sessions older than:",class:"mb-4"},{default:m(()=>[s(H,{modelValue:n(w),"onUpdate:modelValue":e[7]||(e[7]=c=>$(w)?w.value=c:null),options:z,size:"md"},null,8,["modelValue"])]),_:1}),e[12]||(e[12]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," This will permanently delete all Monte Carlo sessions that match your criteria. ",-1))]),t("div",ht,[s(r,{color:"gray",variant:"ghost",label:"Cancel",onClick:te}),s(r,{color:"red",label:"Purge Sessions",loading:n(U),onClick:ee},null,8,["loading"])])])]),_:1},8,["modelValue"])])])}}});export{Mt as default};
